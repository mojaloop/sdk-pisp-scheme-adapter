<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1861px" preserveAspectRatio="none" style="width:2758px;height:1861px;" version="1.1" viewBox="0 0 2758 1861" width="2758px" zoomAndPan="magnify"><defs><filter height="300%" id="f1snwti9kathxa" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="133" x="1309.25" y="28.708">PISP Discovery</text><rect fill="#DDDDDD" height="1814.0938" style="stroke:#A80036;stroke-width:1.0;" width="851.5" x="451.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="787.25" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="1814.0938" style="stroke:#A80036;stroke-width:1.0;" width="73" x="1569" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="1572" y="53.02">Mojaloop</text><rect fill="#DDDDDD" height="1814.0938" style="stroke:#A80036;stroke-width:1.0;" width="463.5" x="1864" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186" x="2002.75" y="53.02">DFSP tp-scheme-adapter</text><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="1595.9688" style="stroke:#A80036;stroke-width:1.0;" width="10" x="66.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="1595.9688" style="stroke:#A80036;stroke-width:1.0;" width="10" x="517.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="163.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="838.5" y="307.1797"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="838.5" y="1150.5625"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="838.5" y="1707.3516"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1232.5" y="1092.2969"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1232.5" y="1649.0859"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="150.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1600.5" y="378.4453"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1600.5" y="1034.0313"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1600.5" y="1590.8203"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1924.5" y="500.1094"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="429.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2236.5" y="633.6406"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="377.9922" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2236.5" y="1241.9609"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="71" x2="71" y1="95.3828" y2="1816.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="522.5" x2="522.5" y1="95.3828" y2="1816.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="843" x2="843" y1="95.3828" y2="1816.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1237" x2="1237" y1="95.3828" y2="1816.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1605" x2="1605" y1="95.3828" y2="1816.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1929" x2="1929" y1="95.3828" y2="1816.75"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2241.5" x2="2241.5" y1="95.3828" y2="1816.75"/><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="15" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="22" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="15" y="1815.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="22" y="1835.7451">PISP Backend</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="455.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="462.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="455.5" y="1815.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="462.5" y="1835.7451">outbound-server</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="153" x="765" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="772" y="80.0811">PISPDiscoveryModel</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="153" x="765" y="1815.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="772" y="1835.7451">PISPDiscoveryModel</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1176" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1183" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1176" y="1815.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1183" y="1835.7451">inbound-server</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1574" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1581" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1574" y="1815.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1581" y="1835.7451">Switch</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1868" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1875" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1868" y="1815.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1875" y="1835.7451">inbound-server</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="160" x="2159.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="2166.5" y="80.0811">DFSPDiscoveryModel</text><rect fill="#FEFECE" filter="url(#f1snwti9kathxa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="160" x="2159.5" y="1815.75"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="2166.5" y="1835.7451">DFSPDiscoveryModel</text><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="1595.9688" style="stroke:#A80036;stroke-width:1.0;" width="10" x="66.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="1595.9688" style="stroke:#A80036;stroke-width:1.0;" width="10" x="517.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="163.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="838.5" y="307.1797"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="838.5" y="1150.5625"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="838.5" y="1707.3516"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1232.5" y="1092.2969"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1232.5" y="1649.0859"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="150.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1600.5" y="378.4453"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1600.5" y="1034.0313"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1600.5" y="1590.8203"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1924.5" y="500.1094"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="429.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2236.5" y="633.6406"/><rect fill="#FFFFFF" filter="url(#f1snwti9kathxa)" height="377.9922" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2236.5" y="1241.9609"/><rect fill="#EEEEEE" filter="url(#f1snwti9kathxa)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2751.5" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2751.5" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2751.5" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#f1snwti9kathxa)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="90" x="1330.75" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="1336.75" y="131.4497">Discovery</text><rect fill="#FBFB77" filter="url(#f1snwti9kathxa)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="835" x="76" y="153.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="827" x="80" y="169.5825">PISP presents thirdparty enabled DFSPs to user. User selects a dfpsa and provides a generic ID to search for associated accounts</text><polygon fill="#A80036" points="505.5,198.7813,515.5,202.7813,505.5,206.7813,509.5,202.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="76.5" x2="511.5" y1="202.7813" y2="202.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="83.5" y="197.7153">DISCOVERY-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="185.5" y="197.7153">GET /linking/accounts/dfspa/username1234</text><line style="stroke:#A80036;stroke-width:1.0;" x1="527.5" x2="569.5" y1="231.9141" y2="231.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="569.5" x2="569.5" y1="231.9141" y2="244.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="528.5" x2="569.5" y1="244.9141" y2="244.9141"/><polygon fill="#A80036" points="538.5,240.9141,528.5,244.9141,538.5,248.9141,534.5,244.9141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="534.5" y="226.8481">DISCOVERY-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="636.5" y="226.8481">const model = await create()</text><rect fill="#FBFB77" filter="url(#f1snwti9kathxa)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="79" x="532" y="257.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="536" y="273.981">state: start</text><polygon fill="#A80036" points="826.5,303.1797,836.5,307.1797,826.5,311.1797,830.5,307.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="527.5" x2="832.5" y1="307.1797" y2="307.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="534.5" y="302.1138">DISCOVERY-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="636.5" y="302.1138">model.getAccounts()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="848.5" x2="890.5" y1="336.3125" y2="336.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="890.5" x2="890.5" y1="336.3125" y2="349.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="849.5" x2="890.5" y1="349.3125" y2="349.3125"/><polygon fill="#A80036" points="859.5,345.3125,849.5,349.3125,859.5,353.3125,855.5,349.3125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="855.5" y="331.2466">DISCOVERY-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="957.5" y="331.2466">ThirdpartyRequests.getAccounts()</text><polygon fill="#A80036" points="1588.5,374.4453,1598.5,378.4453,1588.5,382.4453,1592.5,378.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="848.5" x2="1594.5" y1="378.4453" y2="378.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="855.5" y="373.3794">DISCOVERY-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="957.5" y="373.3794">GET /accounts/username1234</text><rect fill="#ADD8E6" filter="url(#f1snwti9kathxa)" height="53" style="stroke:#A80036;stroke-width:1.0;" width="200" x="853" y="391.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="857" y="407.5122">GET /accounts/username1234</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="857" y="422.645">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="857" y="437.7778">FSIOP-Destination: dfspa</text><polygon fill="#A80036" points="854.5,466.9766,844.5,470.9766,854.5,474.9766,850.5,470.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="848.5" x2="1599.5" y1="470.9766" y2="470.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="860.5" y="465.9106">DISCOVERY-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="962.5" y="465.9106">202 Accepted</text><polygon fill="#A80036" points="1912.5,496.1094,1922.5,500.1094,1912.5,504.1094,1916.5,500.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1610.5" x2="1918.5" y1="500.1094" y2="500.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1617.5" y="495.0435">DISCOVERY-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1719.5" y="495.0435">GET /accounts/username1234</text><polygon fill="#A80036" points="1616.5,525.2422,1606.5,529.2422,1616.5,533.2422,1612.5,529.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1610.5" x2="1923.5" y1="529.2422" y2="529.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1622.5" y="524.1763">DISCOVERY-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1724.5" y="524.1763">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1934.5" x2="1976.5" y1="558.375" y2="558.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1976.5" x2="1976.5" y1="558.375" y2="571.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1935.5" x2="1976.5" y1="571.375" y2="571.375"/><polygon fill="#A80036" points="1945.5,567.375,1935.5,571.375,1945.5,575.375,1941.5,571.375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1941.5" y="553.3091">DISCOVERY-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="2043.5" y="553.3091">const model = await create()</text><rect fill="#FBFB77" filter="url(#f1snwti9kathxa)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="79" x="1939" y="584.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="1943" y="600.4419">state: start</text><polygon fill="#A80036" points="2224.5,629.6406,2234.5,633.6406,2224.5,637.6406,2228.5,633.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1929.5" x2="2230.5" y1="633.6406" y2="633.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1936.5" y="628.5747">DISCOVERY-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="2047.5" y="628.5747">model.retrieveAccounts()</text><path d="M5,646.6406 L5,671.6406 L2308,671.6406 L2308,656.6406 L2298,646.6406 L5,646.6406 " fill="#FBFB77" filter="url(#f1snwti9kathxa)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2298,646.6406 L2298,656.6406 L2308,656.6406 L2298,646.6406 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311" x="994.75" y="663.7075">HAPPY_SCENARIO: DFSP returns list of accounts.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2246.5" x2="2288.5" y1="701.9063" y2="701.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2288.5" x2="2288.5" y1="701.9063" y2="714.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2247.5" x2="2288.5" y1="714.9063" y2="714.9063"/><polygon fill="#A80036" points="2257.5,710.9063,2247.5,714.9063,2257.5,718.9063,2253.5,714.9063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2253.5" y="696.8403">DISCOVERY-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="2364.5" y="696.8403">DFSPBackendRequests.getUserAccounts('username1234')</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2246.5" x2="2288.5" y1="744.0391" y2="744.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2288.5" x2="2288.5" y1="744.0391" y2="757.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2247.5" x2="2288.5" y1="757.0391" y2="757.0391"/><polygon fill="#A80036" points="2257.5,753.0391,2247.5,757.0391,2257.5,761.0391,2253.5,757.0391" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2253.5" y="738.9731">DISCOVERY-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="2364.5" y="738.9731">Accounts returned.</text><rect fill="#FBFB77" filter="url(#f1snwti9kathxa)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="167" x="2251" y="770.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="2255" y="786.106">state: accountsRetrieved</text><rect fill="#ADD8E6" filter="url(#f1snwti9kathxa)" height="204" style="stroke:#A80036;stroke-width:1.0;" width="570" x="1661" y="803.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="354" x="1665" y="819.2388">NOTE: This deviates from the original design document.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318" x="1689" y="834.3716">Which has the response as a top-level array which</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="1689" y="849.5044">is a security and expandability risk.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="1689" y="864.6372">Fixing that here.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1665" y="879.77">PUT /accounts/username1234</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1665" y="894.9028">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="1665" y="910.0356">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1665" y="925.1685">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="1673" y="940.3013">"accounts": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="507" x="1681" y="955.4341">{ accountNickname: "XXXXXXnt", id: "dfspa.username.1234", currency: "ZAR" },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="546" x="1681" y="970.5669">{ accountNickname: "SpeXXXXXXXXnt", id: "dfspa.username.5678", currency: "USD" }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="1673" y="985.6997">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1665" y="1000.8325">}</text><polygon fill="#A80036" points="1621.5,1030.0313,1611.5,1034.0313,1621.5,1038.0313,1617.5,1034.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1615.5" x2="2235.5" y1="1034.0313" y2="1034.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1627.5" y="1028.9653">DISCOVERY-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1738.5" y="1028.9653">PUT /accounts/username1234</text><polygon fill="#A80036" points="2229.5,1059.1641,2239.5,1063.1641,2229.5,1067.1641,2233.5,1063.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1610.5" x2="2235.5" y1="1063.1641" y2="1063.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1617.5" y="1058.0981">DISCOVERY-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1728.5" y="1058.0981">200 OK</text><polygon fill="#A80036" points="1253.5,1088.2969,1243.5,1092.2969,1253.5,1096.2969,1249.5,1092.2969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1247.5" x2="1599.5" y1="1092.2969" y2="1092.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1259.5" y="1087.231">DISCOVERY-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1370.5" y="1087.231">PUT /accounts/username1234</text><polygon fill="#A80036" points="1593.5,1117.4297,1603.5,1121.4297,1593.5,1125.4297,1597.5,1121.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1242.5" x2="1599.5" y1="1121.4297" y2="1121.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1249.5" y="1116.3638">DISCOVERY-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1360.5" y="1116.3638">200 OK</text><polygon fill="#A80036" points="859.5,1146.5625,849.5,1150.5625,859.5,1154.5625,855.5,1150.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="853.5" x2="1236.5" y1="1150.5625" y2="1150.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="865.5" y="1145.4966">DISCOVERY-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="976.5" y="1145.4966">Accounts response recieved</text><rect fill="#FBFB77" filter="url(#f1snwti9kathxa)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="199" x="853" y="1163.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="857" y="1179.6294">state: accountLookupSuccess</text><polygon fill="#A80036" points="538.5,1208.8281,528.5,1212.8281,538.5,1216.8281,534.5,1212.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532.5" x2="842.5" y1="1212.8281" y2="1212.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="544.5" y="1207.7622">DISCOVERY-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="655.5" y="1207.7622">return Accounts</text><polygon fill="#A80036" points="87.5,1237.9609,77.5,1241.9609,87.5,1245.9609,83.5,1241.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="81.5" x2="516.5" y1="1241.9609" y2="1241.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="93.5" y="1236.895">DISCOVERY-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="204.5" y="1236.895">200 OK Accounts</text><path d="M5,1254.9609 L5,1279.9609 L2308,1279.9609 L2308,1264.9609 L2298,1254.9609 L5,1254.9609 " fill="#FBFB77" filter="url(#f1snwti9kathxa)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2298,1254.9609 L2298,1264.9609 L2308,1264.9609 L2298,1254.9609 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="509" x="895.75" y="1272.0278">ERROR_SCENARIO: Switch receives 7202 No accounts found for generic ID error.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2246.5" x2="2288.5" y1="1310.2266" y2="1310.2266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2288.5" x2="2288.5" y1="1310.2266" y2="1323.2266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2247.5" x2="2288.5" y1="1323.2266" y2="1323.2266"/><polygon fill="#A80036" points="2257.5,1319.2266,2247.5,1323.2266,2257.5,1327.2266,2253.5,1323.2266" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2253.5" y="1305.1606">DISCOVERY-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="2364.5" y="1305.1606">DFSPBackendRequests.getUserAccounts('username1234')</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2246.5" x2="2288.5" y1="1352.3594" y2="1352.3594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2288.5" x2="2288.5" y1="1352.3594" y2="1365.3594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2247.5" x2="2288.5" y1="1365.3594" y2="1365.3594"/><polygon fill="#A80036" points="2257.5,1361.3594,2247.5,1365.3594,2257.5,1369.3594,2253.5,1365.3594" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2253.5" y="1347.2935">DISCOVERY-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="2364.5" y="1347.2935">No accounts returned.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2246.5" x2="2288.5" y1="1394.4922" y2="1394.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2288.5" x2="2288.5" y1="1394.4922" y2="1407.4922"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2247.5" x2="2288.5" y1="1407.4922" y2="1407.4922"/><polygon fill="#A80036" points="2257.5,1403.4922,2247.5,1407.4922,2257.5,1411.4922,2253.5,1407.4922" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2253.5" y="1389.4263">DISCOVERY-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="2364.5" y="1389.4263">throw MojaloopFSPIOPError</text><rect fill="#F08080" filter="url(#f1snwti9kathxa)" height="144" style="stroke:#A80036;stroke-width:1.0;" width="350" x="1881" y="1420.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1885" y="1436.5591">PUT /accounts/username1234/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1885" y="1451.6919">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="1885" y="1466.8247">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1885" y="1481.9575">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="1893" y="1497.0903">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="1901" y="1512.2231">errorCode: '7202',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="1901" y="1527.356">errorDescription: 'No accounts found for generic ID'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1893" y="1542.4888">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1885" y="1557.6216">}</text><polygon fill="#A80036" points="1621.5,1586.8203,1611.5,1590.8203,1621.5,1594.8203,1617.5,1590.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1615.5" x2="2235.5" y1="1590.8203" y2="1590.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1627.5" y="1585.7544">DISCOVERY-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1738.5" y="1585.7544">PUT /accounts/username1234/error</text><polygon fill="#A80036" points="2229.5,1615.9531,2239.5,1619.9531,2229.5,1623.9531,2233.5,1619.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1610.5" x2="2235.5" y1="1619.9531" y2="1619.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1617.5" y="1614.8872">DISCOVERY-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1728.5" y="1614.8872">200 OK</text><polygon fill="#A80036" points="1253.5,1645.0859,1243.5,1649.0859,1253.5,1653.0859,1249.5,1649.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1247.5" x2="1599.5" y1="1649.0859" y2="1649.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1259.5" y="1644.02">DISCOVERY-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1370.5" y="1644.02">PUT /accounts/username1234/error</text><polygon fill="#A80036" points="1593.5,1674.2188,1603.5,1678.2188,1593.5,1682.2188,1597.5,1678.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1242.5" x2="1599.5" y1="1678.2188" y2="1678.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1249.5" y="1673.1528">DISCOVERY-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1360.5" y="1673.1528">200 OK</text><polygon fill="#A80036" points="859.5,1703.3516,849.5,1707.3516,859.5,1711.3516,855.5,1707.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="853.5" x2="1236.5" y1="1707.3516" y2="1707.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="865.5" y="1702.2856">DISCOVERY-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="976.5" y="1702.2856">MojaloopFSPIOPError response recieved</text><polygon fill="#A80036" points="538.5,1732.4844,528.5,1736.4844,538.5,1740.4844,534.5,1736.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532.5" x2="842.5" y1="1736.4844" y2="1736.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="544.5" y="1731.4185">DISCOVERY-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="655.5" y="1731.4185">return MojaloopFSPIOPError</text><rect fill="#FBFB77" filter="url(#f1snwti9kathxa)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="96" x="848" y="1749.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="852" y="1765.5513">state: errored</text><polygon fill="#A80036" points="82.5,1794.75,72.5,1798.75,82.5,1802.75,78.5,1798.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="76.5" x2="521.5" y1="1798.75" y2="1798.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="88.5" y="1793.6841">DISCOVERY-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="199.5" y="1793.6841">500 Internal Server Error ErrorInformationObject</text><!--MD5=[42f83629af1747b2c4763bdd233bc598]
@startuml

title PISP Discovery

participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPDiscoveryModel" as PISP_DM
  participant "inbound-server" as PISP_TP_IN
end box
box "Mojaloop"
    participant Switch
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPDiscoveryModel" as DFSP_DM
end box

== Discovery ==
autonumber 1 "<b>DISCOVERY-#</b>"
rnote right of PISP
PISP presents thirdparty enabled DFSPs to user. User selects a dfpsa and provides a generic ID to search for associated accounts
end note
PISP -> PISP_TP_OUT: GET /linking/accounts/dfspa/username1234

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await create()
rnote right of PISP_TP_OUT: state: start
PISP_TP_OUT -> PISP_DM: model.getAccounts()

activate PISP_DM


PISP_DM -> PISP_DM: ThirdpartyRequests.getAccounts()
PISP_DM -> Switch: GET /accounts/username1234
rnote right of PISP_DM #LightBlue
GET /accounts/username1234
FSIOP-Source: pispa
FSIOP-Destination: dfspa
end note

activate Switch
Switch - -> PISP_DM: 202 Accepted
deactivate PISP_DM

Switch -> DFSP_TP_IN: GET /accounts/username1234
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch

DFSP_TP_IN -> DFSP_TP_IN: const model = await create()
rnote right of DFSP_TP_IN: state: start
DFSP_TP_IN -> DFSP_DM: model.retrieveAccounts()
deactivate DFSP_TP_IN

note over PISP, DFSP_DM
  HAPPY_SCENARIO: DFSP returns list of accounts.
end note

activate DFSP_DM
DFSP_DM -> DFSP_DM: DFSPBackendRequests.getUserAccounts('username1234')
DFSP_DM -> DFSP_DM: Accounts returned.
rnote right of DFSP_DM: state: accountsRetrieved

rnote left of DFSP_DM #LightBlue
NOTE: This deviates from the original design document.
      Which has the response as a top-level array which
      is a security and expandability risk.
      Fixing that here.
PUT /accounts/username1234
FSIOP-Source: dfspa
FSIOP-Destination: pispa
{
  "accounts": [
    { accountNickname: "XXXXXXnt", id: "dfspa.username.1234", currency: "ZAR" },
    { accountNickname: "SpeXXXXXXXXnt", id: "dfspa.username.5678", currency: "USD" }
  ]
}
end note

DFSP_DM -> Switch: PUT /accounts/username1234
activate Switch
Switch - -> DFSP_DM: 200 OK
deactivate DFSP_DM

Switch - -> PISP_TP_IN: PUT /accounts/username1234
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_DM: Accounts response recieved
rnote right of PISP_DM: state: accountLookupSuccess
deactivate PISP_TP_IN
activate PISP_DM
PISP_DM -> PISP_TP_OUT: return Accounts
deactivate PISP_DM
PISP_TP_OUT - -> PISP: 200 OK Accounts


note over PISP, DFSP_DM
  ERROR_SCENARIO: Switch receives 7202 No accounts found for generic ID error.
end note

activate DFSP_DM
DFSP_DM -> DFSP_DM: DFSPBackendRequests.getUserAccounts('username1234')
DFSP_DM -> DFSP_DM: No accounts returned.
DFSP_DM -> DFSP_DM: throw MojaloopFSPIOPError

rnote left of DFSP_DM #LightCoral
PUT /accounts/username1234/error
FSIOP-Source: dfspa
FSIOP-Destination: pispa
{
  errorInformation: {
    errorCode: '7202',
    errorDescription: 'No accounts found for generic ID'
  }
}
end note

DFSP_DM -> Switch: PUT /accounts/username1234/error
activate Switch
Switch - -> DFSP_DM: 200 OK
deactivate DFSP_DM

Switch - -> PISP_TP_IN: PUT /accounts/username1234/error
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_DM: MojaloopFSPIOPError response recieved
deactivate PISP_TP_IN
activate PISP_DM
PISP_DM -> PISP_TP_OUT: return MojaloopFSPIOPError
rnote right of PISP_DM: state: errored
deactivate PISP_DM
PISP_TP_OUT - -> PISP: 500 Internal Server Error ErrorInformationObject
deactivate PISP_TP_OUT
deactivate PISP

@enduml

PlantUML version 1.2021.00(Sun Jan 10 05:25:05 EST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>