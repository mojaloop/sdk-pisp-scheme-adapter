<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1428px" preserveAspectRatio="none" style="width:2789px;height:1428px;" version="1.1" viewBox="0 0 2789 1428" width="2789px" zoomAndPan="magnify"><defs><filter height="300%" id="f17a77ui4et5pp" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="133" x="1324.75" y="28.708">PISP Discovery</text><rect fill="#DDDDDD" height="1381.2344" style="stroke:#A80036;stroke-width:1.0;" width="855.5" x="513.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="851.25" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="1381.2344" style="stroke:#A80036;stroke-width:1.0;" width="73" x="1600" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="1603" y="53.02">Mojaloop</text><rect fill="#DDDDDD" height="1381.2344" style="stroke:#A80036;stroke-width:1.0;" width="463.5" x="1895" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186" x="2033.75" y="53.02">DFSP tp-scheme-adapter</text><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="1163.1094" style="stroke:#A80036;stroke-width:1.0;" width="10" x="178.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="1163.1094" style="stroke:#A80036;stroke-width:1.0;" width="10" x="579.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="163.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="955.5" y="307.1797"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="955.5" y="1150.5625"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1298.5" y="1092.2969"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="150.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1631.5" y="378.4453"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1631.5" y="1034.0313"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1955.5" y="500.1094"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="429.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2267.5" y="633.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="183" x2="183" y1="95.3828" y2="1383.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="584.5" x2="584.5" y1="95.3828" y2="1383.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="960" x2="960" y1="95.3828" y2="1383.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1303" x2="1303" y1="95.3828" y2="1383.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1636" x2="1636" y1="95.3828" y2="1383.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1960" x2="1960" y1="95.3828" y2="1383.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2272.5" x2="2272.5" y1="95.3828" y2="1383.8906"/><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="127" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="134" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="127" y="1382.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="134" y="1402.8857">PISP Backend</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="517.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="524.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="517.5" y="1382.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="524.5" y="1402.8857">outbound-server</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="153" x="882" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="889" y="80.0811">PISPDiscoveryModel</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="153" x="882" y="1382.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="889" y="1402.8857">PISPDiscoveryModel</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1242" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1249" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1242" y="1382.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1249" y="1402.8857">inbound-server</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1605" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1612" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1605" y="1382.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1612" y="1402.8857">Switch</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1899" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1906" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1899" y="1382.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1906" y="1402.8857">inbound-server</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="160" x="2190.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="2197.5" y="80.0811">DFSPDiscoveryModel</text><rect fill="#FEFECE" filter="url(#f17a77ui4et5pp)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="160" x="2190.5" y="1382.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="2197.5" y="1402.8857">DFSPDiscoveryModel</text><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="1163.1094" style="stroke:#A80036;stroke-width:1.0;" width="10" x="178.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="1163.1094" style="stroke:#A80036;stroke-width:1.0;" width="10" x="579.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="163.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="955.5" y="307.1797"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="955.5" y="1150.5625"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1298.5" y="1092.2969"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="150.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1631.5" y="378.4453"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1631.5" y="1034.0313"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1955.5" y="500.1094"/><rect fill="#FFFFFF" filter="url(#f17a77ui4et5pp)" height="429.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2267.5" y="633.6406"/><rect fill="#EEEEEE" filter="url(#f17a77ui4et5pp)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2782.5" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2782.5" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2782.5" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#f17a77ui4et5pp)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="90" x="1346.25" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="1352.25" y="131.4497">Discovery</text><rect fill="#FBFB77" filter="url(#f17a77ui4et5pp)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="835" x="188" y="153.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="827" x="192" y="169.5825">PISP presents thirdparty enabled DFSPs to user. User selects a dfpsa and provides a generic ID to search for associated accounts</text><polygon fill="#A80036" points="567.5,198.7813,577.5,202.7813,567.5,206.7813,571.5,202.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="188.5" x2="573.5" y1="202.7813" y2="202.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="195.5" y="197.7153">DISCOVERY-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="297.5" y="197.7153">GET /linking/accounts/dfspa/username1234</text><line style="stroke:#A80036;stroke-width:1.0;" x1="589.5" x2="631.5" y1="231.9141" y2="231.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="631.5" x2="631.5" y1="231.9141" y2="244.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="590.5" x2="631.5" y1="244.9141" y2="244.9141"/><polygon fill="#A80036" points="600.5,240.9141,590.5,244.9141,600.5,248.9141,596.5,244.9141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="596.5" y="226.8481">DISCOVERY-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="698.5" y="226.8481">const model = await create()</text><rect fill="#FBFB77" filter="url(#f17a77ui4et5pp)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="79" x="594" y="257.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="598" y="273.981">state: start</text><polygon fill="#A80036" points="943.5,303.1797,953.5,307.1797,943.5,311.1797,947.5,307.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="589.5" x2="949.5" y1="307.1797" y2="307.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="596.5" y="302.1138">DISCOVERY-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="698.5" y="302.1138">model.getAccounts(dfspId, username)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="965.5" x2="1007.5" y1="336.3125" y2="336.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1007.5" x2="1007.5" y1="336.3125" y2="349.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="966.5" x2="1007.5" y1="349.3125" y2="349.3125"/><polygon fill="#A80036" points="976.5,345.3125,966.5,349.3125,976.5,353.3125,972.5,349.3125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="972.5" y="331.2466">DISCOVERY-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="1074.5" y="331.2466">ThirdpartyRequests.getAccounts()</text><polygon fill="#A80036" points="1619.5,374.4453,1629.5,378.4453,1619.5,382.4453,1623.5,378.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="965.5" x2="1625.5" y1="378.4453" y2="378.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="972.5" y="373.3794">DISCOVERY-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1074.5" y="373.3794">GET /accounts/username1234</text><rect fill="#ADD8E6" filter="url(#f17a77ui4et5pp)" height="53" style="stroke:#A80036;stroke-width:1.0;" width="200" x="970" y="391.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="974" y="407.5122">GET /accounts/username1234</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="974" y="422.645">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="974" y="437.7778">FSIOP-Destination: dfspa</text><polygon fill="#A80036" points="971.5,466.9766,961.5,470.9766,971.5,474.9766,967.5,470.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="965.5" x2="1630.5" y1="470.9766" y2="470.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="977.5" y="465.9106">DISCOVERY-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1079.5" y="465.9106">202 Accepted</text><polygon fill="#A80036" points="1943.5,496.1094,1953.5,500.1094,1943.5,504.1094,1947.5,500.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1641.5" x2="1949.5" y1="500.1094" y2="500.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1648.5" y="495.0435">DISCOVERY-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1750.5" y="495.0435">GET /accounts/username1234</text><polygon fill="#A80036" points="1647.5,525.2422,1637.5,529.2422,1647.5,533.2422,1643.5,529.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1641.5" x2="1954.5" y1="529.2422" y2="529.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1653.5" y="524.1763">DISCOVERY-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1755.5" y="524.1763">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1965.5" x2="2007.5" y1="558.375" y2="558.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2007.5" x2="2007.5" y1="558.375" y2="571.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1966.5" x2="2007.5" y1="571.375" y2="571.375"/><polygon fill="#A80036" points="1976.5,567.375,1966.5,571.375,1976.5,575.375,1972.5,571.375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1972.5" y="553.3091">DISCOVERY-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="2074.5" y="553.3091">const model = await create()</text><rect fill="#FBFB77" filter="url(#f17a77ui4et5pp)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="79" x="1970" y="584.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="1974" y="600.4419">state: start</text><polygon fill="#A80036" points="2255.5,629.6406,2265.5,633.6406,2255.5,637.6406,2259.5,633.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1960.5" x2="2261.5" y1="633.6406" y2="633.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1967.5" y="628.5747">DISCOVERY-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="2078.5" y="628.5747">model.retrieveAccounts()</text><path d="M116,646.6406 L116,671.6406 L2338,671.6406 L2338,656.6406 L2328,646.6406 L116,646.6406 " fill="#FBFB77" filter="url(#f17a77ui4et5pp)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2328,646.6406 L2328,656.6406 L2338,656.6406 L2328,646.6406 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311" x="1065.25" y="663.7075">HAPPY_SCENARIO: DFSP returns list of accounts.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2277.5" x2="2319.5" y1="701.9063" y2="701.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2319.5" x2="2319.5" y1="701.9063" y2="714.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2278.5" x2="2319.5" y1="714.9063" y2="714.9063"/><polygon fill="#A80036" points="2288.5,710.9063,2278.5,714.9063,2288.5,718.9063,2284.5,714.9063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2284.5" y="696.8403">DISCOVERY-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="2395.5" y="696.8403">DFSPBackendRequests.getUserAccounts('username1234')</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2277.5" x2="2319.5" y1="744.0391" y2="744.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2319.5" x2="2319.5" y1="744.0391" y2="757.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2278.5" x2="2319.5" y1="757.0391" y2="757.0391"/><polygon fill="#A80036" points="2288.5,753.0391,2278.5,757.0391,2288.5,761.0391,2284.5,757.0391" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2284.5" y="738.9731">DISCOVERY-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="2395.5" y="738.9731">Accounts returned.</text><rect fill="#FBFB77" filter="url(#f17a77ui4et5pp)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="167" x="2282" y="770.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="2286" y="786.106">state: accountsRetrieved</text><rect fill="#ADD8E6" filter="url(#f17a77ui4et5pp)" height="204" style="stroke:#A80036;stroke-width:1.0;" width="570" x="1692" y="803.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="354" x="1696" y="819.2388">NOTE: This deviates from the original design document.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318" x="1720" y="834.3716">Which has the response as a top-level array which</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="1720" y="849.5044">is a security and expandability risk.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="1720" y="864.6372">Fixing that here.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1696" y="879.77">PUT /accounts/username1234</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1696" y="894.9028">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="1696" y="910.0356">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1696" y="925.1685">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="1704" y="940.3013">"accounts": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="507" x="1712" y="955.4341">{ accountNickname: "XXXXXXnt", id: "dfspa.username.1234", currency: "ZAR" },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="546" x="1712" y="970.5669">{ accountNickname: "SpeXXXXXXXXnt", id: "dfspa.username.5678", currency: "USD" }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="1704" y="985.6997">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1696" y="1000.8325">}</text><polygon fill="#A80036" points="1652.5,1030.0313,1642.5,1034.0313,1652.5,1038.0313,1648.5,1034.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1646.5" x2="2266.5" y1="1034.0313" y2="1034.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1658.5" y="1028.9653">DISCOVERY-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1769.5" y="1028.9653">PUT /accounts/username1234</text><polygon fill="#A80036" points="2260.5,1059.1641,2270.5,1063.1641,2260.5,1067.1641,2264.5,1063.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1641.5" x2="2266.5" y1="1063.1641" y2="1063.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1648.5" y="1058.0981">DISCOVERY-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1759.5" y="1058.0981">200 OK</text><polygon fill="#A80036" points="1319.5,1088.2969,1309.5,1092.2969,1319.5,1096.2969,1315.5,1092.2969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1313.5" x2="1630.5" y1="1092.2969" y2="1092.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1325.5" y="1087.231">DISCOVERY-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1436.5" y="1087.231">PUT /accounts/username1234</text><polygon fill="#A80036" points="1624.5,1117.4297,1634.5,1121.4297,1624.5,1125.4297,1628.5,1121.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1308.5" x2="1630.5" y1="1121.4297" y2="1121.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1315.5" y="1116.3638">DISCOVERY-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1426.5" y="1116.3638">200 OK</text><polygon fill="#A80036" points="976.5,1146.5625,966.5,1150.5625,976.5,1154.5625,972.5,1150.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="970.5" x2="1302.5" y1="1150.5625" y2="1150.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="982.5" y="1145.4966">DISCOVERY-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="1093.5" y="1145.4966">Accounts response received</text><rect fill="#FBFB77" filter="url(#f17a77ui4et5pp)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="199" x="970" y="1163.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="974" y="1179.6294">state: accountLookupSuccess</text><polygon fill="#A80036" points="600.5,1208.8281,590.5,1212.8281,600.5,1216.8281,596.5,1212.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="594.5" x2="959.5" y1="1212.8281" y2="1212.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="606.5" y="1207.7622">DISCOVERY-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="717.5" y="1207.7622">return Accounts</text><rect fill="#ADD8E6" filter="url(#f17a77ui4et5pp)" height="113" style="stroke:#A80036;stroke-width:1.0;" width="570" x="5" y="1225.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="9" y="1241.895">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="17" y="1257.0278">accounts: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="507" x="25" y="1272.1606">{ accountNickname: "XXXXXXnt", id: "dfspa.username.1234", currency: "ZAR" },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="546" x="25" y="1287.2935">{ accountNickname: "SpeXXXXXXXXnt", id: "dfspa.username.5678", currency: "USD" }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="17" y="1302.4263">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="17" y="1317.5591">currentState="accountLookupSuccess"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="9" y="1332.6919">}</text><polygon fill="#A80036" points="194.5,1361.8906,184.5,1365.8906,194.5,1369.8906,190.5,1365.8906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="188.5" x2="583.5" y1="1365.8906" y2="1365.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="200.5" y="1360.8247">DISCOVERY-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="311.5" y="1360.8247">200 OK Accounts</text><!--MD5=[3b0cd6c573b2744a17fb9aa8cfc93c4e]
@startuml

title PISP Discovery

participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPDiscoveryModel" as PISP_DM
  participant "inbound-server" as PISP_TP_IN
end box
box "Mojaloop"
    participant Switch
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPDiscoveryModel" as DFSP_DM
end box

== Discovery ==
autonumber 1 "<b>DISCOVERY-#</b>"
rnote right of PISP
PISP presents thirdparty enabled DFSPs to user. User selects a dfpsa and provides a generic ID to search for associated accounts
end note
PISP -> PISP_TP_OUT: GET /linking/accounts/dfspa/username1234

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await create()
rnote right of PISP_TP_OUT: state: start
PISP_TP_OUT -> PISP_DM: model.getAccounts(dfspId, username)

activate PISP_DM


PISP_DM -> PISP_DM: ThirdpartyRequests.getAccounts()
PISP_DM -> Switch: GET /accounts/username1234
rnote right of PISP_DM #LightBlue
GET /accounts/username1234
FSIOP-Source: pispa
FSIOP-Destination: dfspa
end note

activate Switch
Switch - -> PISP_DM: 202 Accepted
deactivate PISP_DM

Switch -> DFSP_TP_IN: GET /accounts/username1234
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch

DFSP_TP_IN -> DFSP_TP_IN: const model = await create()
rnote right of DFSP_TP_IN: state: start
DFSP_TP_IN -> DFSP_DM: model.retrieveAccounts()
deactivate DFSP_TP_IN

note over PISP, DFSP_DM
  HAPPY_SCENARIO: DFSP returns list of accounts.
end note

activate DFSP_DM
DFSP_DM -> DFSP_DM: DFSPBackendRequests.getUserAccounts('username1234')
DFSP_DM -> DFSP_DM: Accounts returned.
rnote right of DFSP_DM: state: accountsRetrieved

rnote left of DFSP_DM #LightBlue
NOTE: This deviates from the original design document.
      Which has the response as a top-level array which
      is a security and expandability risk.
      Fixing that here.
PUT /accounts/username1234
FSIOP-Source: dfspa
FSIOP-Destination: pispa
{
  "accounts": [
    { accountNickname: "XXXXXXnt", id: "dfspa.username.1234", currency: "ZAR" },
    { accountNickname: "SpeXXXXXXXXnt", id: "dfspa.username.5678", currency: "USD" }
  ]
}
end note

DFSP_DM -> Switch: PUT /accounts/username1234
activate Switch
Switch - -> DFSP_DM: 200 OK
deactivate DFSP_DM

Switch - -> PISP_TP_IN: PUT /accounts/username1234
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_DM: Accounts response received
rnote right of PISP_DM: state: accountLookupSuccess
deactivate PISP_TP_IN
activate PISP_DM
PISP_DM -> PISP_TP_OUT: return Accounts
deactivate PISP_DM
rnote left of PISP_TP_OUT #LightBlue
{
  accounts: [
    { accountNickname: "XXXXXXnt", id: "dfspa.username.1234", currency: "ZAR" },
    { accountNickname: "SpeXXXXXXXXnt", id: "dfspa.username.5678", currency: "USD" }
  ],
  currentState="accountLookupSuccess"
}
end note
PISP_TP_OUT - -> PISP: 200 OK Accounts
deactivate PISP_TP_OUT
deactivate PISP
@enduml

PlantUML version 1.2021.00(Sun Jan 10 05:25:05 EST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>