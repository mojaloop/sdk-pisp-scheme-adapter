<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2123px" preserveAspectRatio="none" style="width:2813px;height:2123px;" version="1.1" viewBox="0 0 2813 2123" width="2813px" zoomAndPan="magnify"><defs><filter height="300%" id="fz61wi417q6in" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="275" x="1265.75" y="28.708">PISP Discovery Error Scenarios</text><rect fill="#DDDDDD" height="2076.6875" style="stroke:#A80036;stroke-width:1.0;" width="906.5" x="451.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="814.75" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="2076.6875" style="stroke:#A80036;stroke-width:1.0;" width="73" x="1624" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="1627" y="53.02">Mojaloop</text><rect fill="#DDDDDD" height="2076.6875" style="stroke:#A80036;stroke-width:1.0;" width="463.5" x="1919" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186" x="2057.75" y="53.02">DFSP tp-scheme-adapter</text><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="1858.5625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="66.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="1858.5625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="517.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="163.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="893.5" y="307.1797"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="893.5" y="1132.1641"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="893.5" y="1846.0156"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1287.5" y="1073.8984"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1287.5" y="1787.75"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="150.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1655.5" y="378.4453"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1655.5" y="1015.6328"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1655.5" y="1729.4844"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1979.5" y="500.1094"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="411.125" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2291.5" y="633.6406"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="411.125" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2291.5" y="1347.4922"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="71" x2="71" y1="95.3828" y2="2079.3438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="522.5" x2="522.5" y1="95.3828" y2="2079.3438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="898" x2="898" y1="95.3828" y2="2079.3438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1292" x2="1292" y1="95.3828" y2="2079.3438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1660" x2="1660" y1="95.3828" y2="2079.3438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1984" x2="1984" y1="95.3828" y2="2079.3438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2296.5" x2="2296.5" y1="95.3828" y2="2079.3438"/><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="15" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="22" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="15" y="2078.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="22" y="2098.3389">PISP Backend</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="455.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="462.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="455.5" y="2078.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="462.5" y="2098.3389">outbound-server</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="153" x="820" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="827" y="80.0811">PISPDiscoveryModel</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="153" x="820" y="2078.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="827" y="2098.3389">PISPDiscoveryModel</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1231" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1238" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1231" y="2078.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1238" y="2098.3389">inbound-server</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1629" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1636" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1629" y="2078.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1636" y="2098.3389">Switch</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1923" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1930" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1923" y="2078.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1930" y="2098.3389">inbound-server</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="160" x="2214.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="2221.5" y="80.0811">DFSPDiscoveryModel</text><rect fill="#FEFECE" filter="url(#fz61wi417q6in)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="160" x="2214.5" y="2078.3438"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="2221.5" y="2098.3389">DFSPDiscoveryModel</text><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="1858.5625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="66.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="1858.5625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="517.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="163.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="893.5" y="307.1797"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="893.5" y="1132.1641"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="893.5" y="1846.0156"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1287.5" y="1073.8984"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1287.5" y="1787.75"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="150.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1655.5" y="378.4453"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1655.5" y="1015.6328"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1655.5" y="1729.4844"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1979.5" y="500.1094"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="411.125" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2291.5" y="633.6406"/><rect fill="#FFFFFF" filter="url(#fz61wi417q6in)" height="411.125" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2291.5" y="1347.4922"/><rect fill="#EEEEEE" filter="url(#fz61wi417q6in)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2806.5" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2806.5" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2806.5" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#fz61wi417q6in)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="90" x="1358.25" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="1364.25" y="131.4497">Discovery</text><rect fill="#FBFB77" filter="url(#fz61wi417q6in)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="835" x="76" y="153.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="827" x="80" y="169.5825">PISP presents thirdparty enabled DFSPs to user. User selects a dfpsa and provides a generic ID to search for associated accounts</text><polygon fill="#A80036" points="505.5,198.7813,515.5,202.7813,505.5,206.7813,509.5,202.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="76.5" x2="511.5" y1="202.7813" y2="202.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="83.5" y="197.7153">DISCOVERY-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="275" x="185.5" y="197.7153">GET /linking/accounts/dfspa/username1234</text><line style="stroke:#A80036;stroke-width:1.0;" x1="527.5" x2="569.5" y1="231.9141" y2="231.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="569.5" x2="569.5" y1="231.9141" y2="244.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="528.5" x2="569.5" y1="244.9141" y2="244.9141"/><polygon fill="#A80036" points="538.5,240.9141,528.5,244.9141,538.5,248.9141,534.5,244.9141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="534.5" y="226.8481">DISCOVERY-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="636.5" y="226.8481">const model = await create()</text><rect fill="#FBFB77" filter="url(#fz61wi417q6in)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="79" x="532" y="257.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="536" y="273.981">state: start</text><polygon fill="#A80036" points="881.5,303.1797,891.5,307.1797,881.5,311.1797,885.5,307.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="527.5" x2="887.5" y1="307.1797" y2="307.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="534.5" y="302.1138">DISCOVERY-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="636.5" y="302.1138">model.getAccounts(dfspId, username)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="903.5" x2="945.5" y1="336.3125" y2="336.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="945.5" x2="945.5" y1="336.3125" y2="349.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="904.5" x2="945.5" y1="349.3125" y2="349.3125"/><polygon fill="#A80036" points="914.5,345.3125,904.5,349.3125,914.5,353.3125,910.5,349.3125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="910.5" y="331.2466">DISCOVERY-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="1012.5" y="331.2466">ThirdpartyRequests.getAccounts()</text><polygon fill="#A80036" points="1643.5,374.4453,1653.5,378.4453,1643.5,382.4453,1647.5,378.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="903.5" x2="1649.5" y1="378.4453" y2="378.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="910.5" y="373.3794">DISCOVERY-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1012.5" y="373.3794">GET /accounts/username1234</text><rect fill="#ADD8E6" filter="url(#fz61wi417q6in)" height="53" style="stroke:#A80036;stroke-width:1.0;" width="200" x="908" y="391.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="912" y="407.5122">GET /accounts/username1234</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="912" y="422.645">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="912" y="437.7778">FSIOP-Destination: dfspa</text><polygon fill="#A80036" points="909.5,466.9766,899.5,470.9766,909.5,474.9766,905.5,470.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="903.5" x2="1654.5" y1="470.9766" y2="470.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="915.5" y="465.9106">DISCOVERY-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1017.5" y="465.9106">202 Accepted</text><polygon fill="#A80036" points="1967.5,496.1094,1977.5,500.1094,1967.5,504.1094,1971.5,500.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1665.5" x2="1973.5" y1="500.1094" y2="500.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1672.5" y="495.0435">DISCOVERY-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1774.5" y="495.0435">GET /accounts/username1234</text><polygon fill="#A80036" points="1671.5,525.2422,1661.5,529.2422,1671.5,533.2422,1667.5,529.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1665.5" x2="1978.5" y1="529.2422" y2="529.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1677.5" y="524.1763">DISCOVERY-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1779.5" y="524.1763">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1989.5" x2="2031.5" y1="558.375" y2="558.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2031.5" x2="2031.5" y1="558.375" y2="571.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1990.5" x2="2031.5" y1="571.375" y2="571.375"/><polygon fill="#A80036" points="2000.5,567.375,1990.5,571.375,2000.5,575.375,1996.5,571.375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="98" x="1996.5" y="553.3091">DISCOVERY-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="2098.5" y="553.3091">const model = await create()</text><rect fill="#FBFB77" filter="url(#fz61wi417q6in)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="79" x="1994" y="584.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="1998" y="600.4419">state: start</text><polygon fill="#A80036" points="2279.5,629.6406,2289.5,633.6406,2279.5,637.6406,2283.5,633.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1984.5" x2="2285.5" y1="633.6406" y2="633.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1991.5" y="628.5747">DISCOVERY-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="2102.5" y="628.5747">model.retrieveAccounts()</text><path d="M5,646.6406 L5,671.6406 L2363,671.6406 L2363,656.6406 L2353,646.6406 L5,646.6406 " fill="#FBFB77" filter="url(#fz61wi417q6in)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2353,646.6406 L2353,656.6406 L2363,656.6406 L2353,646.6406 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="528" x="913.75" y="663.7075">ERROR_SCENARIO: Switch sends back 7202 No accounts found for generic ID error.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2301.5" x2="2343.5" y1="701.9063" y2="701.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2343.5" x2="2343.5" y1="701.9063" y2="714.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2302.5" x2="2343.5" y1="714.9063" y2="714.9063"/><polygon fill="#A80036" points="2312.5,710.9063,2302.5,714.9063,2312.5,718.9063,2308.5,714.9063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2308.5" y="696.8403">DISCOVERY-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="2419.5" y="696.8403">DFSPBackendRequests.getUserAccounts('username1234')</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2301.5" x2="2343.5" y1="744.0391" y2="744.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2343.5" x2="2343.5" y1="744.0391" y2="757.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2302.5" x2="2343.5" y1="757.0391" y2="757.0391"/><polygon fill="#A80036" points="2312.5,753.0391,2302.5,757.0391,2312.5,761.0391,2308.5,757.0391" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2308.5" y="738.9731">DISCOVERY-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="2419.5" y="738.9731">No accounts returned.</text><rect fill="#FBFB77" filter="url(#fz61wi417q6in)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="96" x="2306" y="770.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2310" y="786.106">state: errored</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2301.5" x2="2343.5" y1="819.3047" y2="819.3047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2343.5" x2="2343.5" y1="819.3047" y2="832.3047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2302.5" x2="2343.5" y1="832.3047" y2="832.3047"/><polygon fill="#A80036" points="2312.5,828.3047,2302.5,832.3047,2312.5,836.3047,2308.5,832.3047" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2308.5" y="814.2388">DISCOVERY-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="2419.5" y="814.2388">throw MojaloopFSPIOPError</text><rect fill="#F08080" filter="url(#fz61wi417q6in)" height="144" style="stroke:#A80036;stroke-width:1.0;" width="350" x="1936" y="845.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1940" y="861.3716">PUT /accounts/username1234/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1940" y="876.5044">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="1940" y="891.6372">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1940" y="906.77">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="1948" y="921.9028">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="1956" y="937.0356">errorCode: '7202',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="1956" y="952.1685">errorDescription: 'No accounts found for generic ID'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1948" y="967.3013">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1940" y="982.4341">}</text><polygon fill="#A80036" points="1676.5,1011.6328,1666.5,1015.6328,1676.5,1019.6328,1672.5,1015.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1670.5" x2="2290.5" y1="1015.6328" y2="1015.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1682.5" y="1010.5669">DISCOVERY-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1793.5" y="1010.5669">PUT /accounts/username1234/error</text><polygon fill="#A80036" points="2284.5,1040.7656,2294.5,1044.7656,2284.5,1048.7656,2288.5,1044.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1665.5" x2="2290.5" y1="1044.7656" y2="1044.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1672.5" y="1039.6997">DISCOVERY-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1783.5" y="1039.6997">200 OK</text><polygon fill="#A80036" points="1308.5,1069.8984,1298.5,1073.8984,1308.5,1077.8984,1304.5,1073.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1302.5" x2="1654.5" y1="1073.8984" y2="1073.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1314.5" y="1068.8325">DISCOVERY-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1425.5" y="1068.8325">PUT /accounts/username1234/error</text><polygon fill="#A80036" points="1648.5,1099.0313,1658.5,1103.0313,1648.5,1107.0313,1652.5,1103.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1297.5" x2="1654.5" y1="1103.0313" y2="1103.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1304.5" y="1097.9653">DISCOVERY-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1415.5" y="1097.9653">200 OK</text><polygon fill="#A80036" points="914.5,1128.1641,904.5,1132.1641,914.5,1136.1641,910.5,1132.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="908.5" x2="1291.5" y1="1132.1641" y2="1132.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="920.5" y="1127.0981">DISCOVERY-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="1031.5" y="1127.0981">MojaloopFSPIOPError response received</text><polygon fill="#A80036" points="538.5,1157.2969,528.5,1161.2969,538.5,1165.2969,534.5,1161.2969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532.5" x2="897.5" y1="1161.2969" y2="1161.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="544.5" y="1156.231">DISCOVERY-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="655.5" y="1156.231">return MojaloopFSPIOPError</text><rect fill="#FBFB77" filter="url(#fz61wi417q6in)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="96" x="903" y="1174.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="907" y="1190.3638">state: errored</text><rect fill="#F08080" filter="url(#fz61wi417q6in)" height="113" style="stroke:#A80036;stroke-width:1.0;" width="350" x="162" y="1207.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="166" y="1223.4966">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="174" y="1238.6294">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="182" y="1253.7622">errorCode: '7202',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="182" y="1268.895">errorDescription: 'No accounts found for generic ID'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="174" y="1284.0278">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="174" y="1299.1606">currentState="errored"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="166" y="1314.2935">}</text><polygon fill="#A80036" points="87.5,1343.4922,77.5,1347.4922,87.5,1351.4922,83.5,1347.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="81.5" x2="516.5" y1="1347.4922" y2="1347.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="93.5" y="1342.4263">DISCOVERY-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="204.5" y="1342.4263">404 Not Found ErrorInformationObject</text><path d="M5,1360.4922 L5,1385.4922 L2363,1385.4922 L2363,1370.4922 L2353,1360.4922 L5,1360.4922 " fill="#FBFB77" filter="url(#fz61wi417q6in)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2353,1360.4922 L2353,1370.4922 L2363,1370.4922 L2353,1360.4922 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="1005.75" y="1377.5591">ERROR_SCENARIO: Switch sends back any other error.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2301.5" x2="2343.5" y1="1415.7578" y2="1415.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2343.5" x2="2343.5" y1="1415.7578" y2="1428.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2302.5" x2="2343.5" y1="1428.7578" y2="1428.7578"/><polygon fill="#A80036" points="2312.5,1424.7578,2302.5,1428.7578,2312.5,1432.7578,2308.5,1428.7578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2308.5" y="1410.6919">DISCOVERY-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="2419.5" y="1410.6919">DFSPBackendRequests.getUserAccounts('username1234')</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2301.5" x2="2343.5" y1="1457.8906" y2="1457.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2343.5" x2="2343.5" y1="1457.8906" y2="1470.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2302.5" x2="2343.5" y1="1470.8906" y2="1470.8906"/><polygon fill="#A80036" points="2312.5,1466.8906,2302.5,1470.8906,2312.5,1474.8906,2308.5,1470.8906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2308.5" y="1452.8247">DISCOVERY-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="2419.5" y="1452.8247">No accounts returned.</text><rect fill="#FBFB77" filter="url(#fz61wi417q6in)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="96" x="2306" y="1483.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2310" y="1499.9575">state: errored</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2301.5" x2="2343.5" y1="1533.1563" y2="1533.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2343.5" x2="2343.5" y1="1533.1563" y2="1546.1563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2302.5" x2="2343.5" y1="1546.1563" y2="1546.1563"/><polygon fill="#A80036" points="2312.5,1542.1563,2302.5,1546.1563,2312.5,1550.1563,2308.5,1546.1563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="2308.5" y="1528.0903">DISCOVERY-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="2419.5" y="1528.0903">throw MojaloopFSPIOPError</text><rect fill="#F08080" filter="url(#fz61wi417q6in)" height="144" style="stroke:#A80036;stroke-width:1.0;" width="268" x="2018" y="1559.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="2022" y="1575.2231">PUT /accounts/username1234/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="2022" y="1590.356">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="2022" y="1605.4888">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="2022" y="1620.6216">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="2030" y="1635.7544">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="2038" y="1650.8872">errorCode: '2001',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="2038" y="1666.02">errorDescription: 'Internal server error'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="2030" y="1681.1528">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="2022" y="1696.2856">}</text><polygon fill="#A80036" points="1676.5,1725.4844,1666.5,1729.4844,1676.5,1733.4844,1672.5,1729.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1670.5" x2="2290.5" y1="1729.4844" y2="1729.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1682.5" y="1724.4185">DISCOVERY-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1793.5" y="1724.4185">PUT /accounts/username1234/error</text><polygon fill="#A80036" points="2284.5,1754.6172,2294.5,1758.6172,2284.5,1762.6172,2288.5,1758.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1665.5" x2="2290.5" y1="1758.6172" y2="1758.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1672.5" y="1753.5513">DISCOVERY-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1783.5" y="1753.5513">200 OK</text><polygon fill="#A80036" points="1308.5,1783.75,1298.5,1787.75,1308.5,1791.75,1304.5,1787.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1302.5" x2="1654.5" y1="1787.75" y2="1787.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1314.5" y="1782.6841">DISCOVERY-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1425.5" y="1782.6841">PUT /accounts/username1234/error</text><polygon fill="#A80036" points="1648.5,1812.8828,1658.5,1816.8828,1648.5,1820.8828,1652.5,1816.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1297.5" x2="1654.5" y1="1816.8828" y2="1816.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="1304.5" y="1811.8169">DISCOVERY-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1415.5" y="1811.8169">200 OK</text><polygon fill="#A80036" points="914.5,1842.0156,904.5,1846.0156,914.5,1850.0156,910.5,1846.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="908.5" x2="1291.5" y1="1846.0156" y2="1846.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="920.5" y="1840.9497">DISCOVERY-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="1031.5" y="1840.9497">MojaloopFSPIOPError response received</text><polygon fill="#A80036" points="538.5,1871.1484,528.5,1875.1484,538.5,1879.1484,534.5,1875.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532.5" x2="897.5" y1="1875.1484" y2="1875.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="544.5" y="1870.0825">DISCOVERY-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="655.5" y="1870.0825">return MojaloopFSPIOPError</text><rect fill="#FBFB77" filter="url(#fz61wi417q6in)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="96" x="903" y="1888.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="907" y="1904.2153">state: errored</text><rect fill="#F08080" filter="url(#fz61wi417q6in)" height="113" style="stroke:#A80036;stroke-width:1.0;" width="392" x="120" y="1921.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="124" y="1937.3481">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="132" y="1952.481">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="140" y="1967.6138">errorCode: '7200',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="368" x="140" y="1982.7466">errorDescription: 'Generic Thirdparty account linking error'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="132" y="1997.8794">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="132" y="2013.0122">currentState="errored"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="124" y="2028.145">}</text><polygon fill="#A80036" points="82.5,2057.3438,72.5,2061.3438,82.5,2065.3438,78.5,2061.3438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="76.5" x2="521.5" y1="2061.3438" y2="2061.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="88.5" y="2056.2778">DISCOVERY-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="199.5" y="2056.2778">500 Internal Server Error ErrorInformationObject</text><!--MD5=[8fd9f8990c84110db5ad030201bf1045]
@startuml

title PISP Discovery Error Scenarios

participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPDiscoveryModel" as PISP_DM
  participant "inbound-server" as PISP_TP_IN
end box
box "Mojaloop"
    participant Switch
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPDiscoveryModel" as DFSP_DM
end box

== Discovery ==
autonumber 1 "<b>DISCOVERY-#</b>"
rnote right of PISP
PISP presents thirdparty enabled DFSPs to user. User selects a dfpsa and provides a generic ID to search for associated accounts
end note
PISP -> PISP_TP_OUT: GET /linking/accounts/dfspa/username1234

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await create()
rnote right of PISP_TP_OUT: state: start
PISP_TP_OUT -> PISP_DM: model.getAccounts(dfspId, username)

activate PISP_DM


PISP_DM -> PISP_DM: ThirdpartyRequests.getAccounts()
PISP_DM -> Switch: GET /accounts/username1234
rnote right of PISP_DM #LightBlue
GET /accounts/username1234
FSIOP-Source: pispa
FSIOP-Destination: dfspa
end note

activate Switch
Switch - -> PISP_DM: 202 Accepted
deactivate PISP_DM

Switch -> DFSP_TP_IN: GET /accounts/username1234
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch

DFSP_TP_IN -> DFSP_TP_IN: const model = await create()
rnote right of DFSP_TP_IN: state: start
DFSP_TP_IN -> DFSP_DM: model.retrieveAccounts()
deactivate DFSP_TP_IN

note over PISP, DFSP_DM
  ERROR_SCENARIO: Switch sends back 7202 No accounts found for generic ID error.
end note

activate DFSP_DM
DFSP_DM -> DFSP_DM: DFSPBackendRequests.getUserAccounts('username1234')
DFSP_DM -> DFSP_DM: No accounts returned.
rnote right of DFSP_DM: state: errored
DFSP_DM -> DFSP_DM: throw MojaloopFSPIOPError

rnote left of DFSP_DM #LightCoral
PUT /accounts/username1234/error
FSIOP-Source: dfspa
FSIOP-Destination: pispa
{
  errorInformation: {
    errorCode: '7202',
    errorDescription: 'No accounts found for generic ID'
  }
}
end note

DFSP_DM -> Switch: PUT /accounts/username1234/error
activate Switch
Switch - -> DFSP_DM: 200 OK
deactivate DFSP_DM

Switch - -> PISP_TP_IN: PUT /accounts/username1234/error
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_DM: MojaloopFSPIOPError response received
deactivate PISP_TP_IN
activate PISP_DM
PISP_DM -> PISP_TP_OUT: return MojaloopFSPIOPError
rnote right of PISP_DM: state: errored
deactivate PISP_DM
rnote left of PISP_TP_OUT #LightCoral
{
  errorInformation: {
    errorCode: '7202',
    errorDescription: 'No accounts found for generic ID'
  }
  currentState="errored"
}
end note
PISP_TP_OUT - -> PISP: 404 Not Found ErrorInformationObject

note over PISP, DFSP_DM
  ERROR_SCENARIO: Switch sends back any other error.
end note

activate DFSP_DM
DFSP_DM -> DFSP_DM: DFSPBackendRequests.getUserAccounts('username1234')
DFSP_DM -> DFSP_DM: No accounts returned.
rnote right of DFSP_DM: state: errored
DFSP_DM -> DFSP_DM: throw MojaloopFSPIOPError

rnote left of DFSP_DM #LightCoral
PUT /accounts/username1234/error
FSIOP-Source: dfspa
FSIOP-Destination: pispa
{
  errorInformation: {
    errorCode: '2001',
    errorDescription: 'Internal server error'
  }
}
end note

DFSP_DM -> Switch: PUT /accounts/username1234/error
activate Switch
Switch - -> DFSP_DM: 200 OK
deactivate DFSP_DM

Switch - -> PISP_TP_IN: PUT /accounts/username1234/error
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_DM: MojaloopFSPIOPError response received
deactivate PISP_TP_IN
activate PISP_DM
PISP_DM -> PISP_TP_OUT: return MojaloopFSPIOPError
rnote right of PISP_DM: state: errored
deactivate PISP_DM
rnote left of PISP_TP_OUT #LightCoral
{
  errorInformation: {
    errorCode: '7200',
    errorDescription: 'Generic Thirdparty account linking error'
  }
  currentState="errored"
}
end note
PISP_TP_OUT - -> PISP: 500 Internal Server Error ErrorInformationObject

deactivate PISP_TP_OUT
deactivate PISP

@enduml

PlantUML version 1.2021.00(Sun Jan 10 05:25:05 EST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>