<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1764px" preserveAspectRatio="none" style="width:1704px;height:1764px;" version="1.1" viewBox="0 0 1704 1764" width="1704px" zoomAndPan="magnify"><defs><filter height="300%" id="f1g002lcjjz8s3" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="145" x="776" y="28.708">PISP Pre-Linking</text><rect fill="#DDDDDD" height="1717.2266" style="stroke:#A80036;stroke-width:1.0;" width="871.5" x="445.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="791.25" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="1717.2266" style="stroke:#A80036;stroke-width:1.0;" width="73" x="1614" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="1617" y="53.02">Mojaloop</text><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="1532.2344" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="169.6484"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="1532.2344" style="stroke:#A80036;stroke-width:1.0;" width="10" x="511.5" y="169.6484"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="100.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="877.5" y="274.0469"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="877.5" y="609.7734"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="213.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="877.5" y="966.7656"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="213.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="877.5" y="1459.5547"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1246.5" y="374.4453"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="265.5938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1246.5" y="701.1719"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="250.4609" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1246.5" y="1209.0938"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1645.5" y="345.3125"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="236.4609" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1645.5" y="701.1719"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="221.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1645.5" y="1209.0938"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="61" x2="61" y1="95.3828" y2="1719.8828"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="516.5" x2="516.5" y1="95.3828" y2="1719.8828"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="882.5" x2="882.5" y1="95.3828" y2="1719.8828"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1251" x2="1251" y1="95.3828" y2="1719.8828"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1650" x2="1650" y1="95.3828" y2="1719.8828"/><rect fill="#FEFECE" filter="url(#f1g002lcjjz8s3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="12" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#f1g002lcjjz8s3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="5" y="1718.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="12" y="1738.8779">PISP Backend</text><rect fill="#FEFECE" filter="url(#f1g002lcjjz8s3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="449.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="456.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f1g002lcjjz8s3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="449.5" y="1718.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="456.5" y="1738.8779">outbound-server</text><rect fill="#FEFECE" filter="url(#f1g002lcjjz8s3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="144" x="808.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="815.5" y="80.0811">PISPrelinkingModel</text><rect fill="#FEFECE" filter="url(#f1g002lcjjz8s3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="144" x="808.5" y="1718.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="815.5" y="1738.8779">PISPrelinkingModel</text><rect fill="#FEFECE" filter="url(#f1g002lcjjz8s3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1190" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1197" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f1g002lcjjz8s3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1190" y="1718.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1197" y="1738.8779">inbound-server</text><rect fill="#FEFECE" filter="url(#f1g002lcjjz8s3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1619" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1626" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#f1g002lcjjz8s3)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1619" y="1718.8828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1626" y="1738.8779">Switch</text><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="1532.2344" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="169.6484"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="1532.2344" style="stroke:#A80036;stroke-width:1.0;" width="10" x="511.5" y="169.6484"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="100.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="877.5" y="274.0469"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="877.5" y="609.7734"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="213.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="877.5" y="966.7656"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="213.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="877.5" y="1459.5547"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1246.5" y="374.4453"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="265.5938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1246.5" y="701.1719"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="250.4609" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1246.5" y="1209.0938"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1645.5" y="345.3125"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="236.4609" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1645.5" y="701.1719"/><rect fill="#FFFFFF" filter="url(#f1g002lcjjz8s3)" height="221.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1645.5" y="1209.0938"/><rect fill="#EEEEEE" filter="url(#f1g002lcjjz8s3)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1697" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1697" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1697" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#f1g002lcjjz8s3)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="102" x="797.5" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="83" x="803.5" y="131.4497">Pre-Linking</text><polygon fill="#A80036" points="499.5,165.6484,509.5,169.6484,499.5,173.6484,503.5,169.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="66.5" x2="505.5" y1="169.6484" y2="169.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="73.5" y="164.5825">PRELINKING-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="179.5" y="164.5825">GET /linking/get-dfsps</text><line style="stroke:#A80036;stroke-width:1.0;" x1="521.5" x2="563.5" y1="198.7813" y2="198.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="563.5" x2="563.5" y1="198.7813" y2="211.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="522.5" x2="563.5" y1="211.7813" y2="211.7813"/><polygon fill="#A80036" points="532.5,207.7813,522.5,211.7813,532.5,215.7813,528.5,211.7813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="528.5" y="193.7153">PRELINKING-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="634.5" y="193.7153">const model = await create()</text><rect fill="#FBFB77" filter="url(#f1g002lcjjz8s3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="79" x="526" y="224.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="530" y="240.8481">state: start</text><polygon fill="#A80036" points="865.5,270.0469,875.5,274.0469,865.5,278.0469,869.5,274.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="521.5" x2="871.5" y1="274.0469" y2="274.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="528.5" y="268.981">PRELINKING-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="634.5" y="268.981">model.getThirdpartyEnabledDFSPs()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="887.5" x2="929.5" y1="303.1797" y2="303.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="929.5" x2="929.5" y1="303.1797" y2="316.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="888.5" x2="929.5" y1="316.1797" y2="316.1797"/><polygon fill="#A80036" points="898.5,312.1797,888.5,316.1797,898.5,320.1797,894.5,316.1797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="894.5" y="298.1138">PRELINKING-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="1000.5" y="298.1138">ThirdpartyRequests.getServicesById()</text><polygon fill="#A80036" points="1633.5,341.3125,1643.5,345.3125,1633.5,349.3125,1637.5,345.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="887.5" x2="1639.5" y1="345.3125" y2="345.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="894.5" y="340.2466">PRELINKING-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="1000.5" y="340.2466">GET /services/THIRD_PARTY_DFSP</text><polygon fill="#A80036" points="893.5,370.4453,883.5,374.4453,893.5,378.4453,889.5,374.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="887.5" x2="1644.5" y1="374.4453" y2="374.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="899.5" y="369.3794">PRELINKING-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1005.5" y="369.3794">202 Accepted</text><path d="M20,387.4453 L20,412.4453 L1692,412.4453 L1692,397.4453 L1682,387.4453 L20,387.4453 " fill="#FBFB77" filter="url(#f1g002lcjjz8s3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1682,387.4453 L1682,397.4453 L1692,397.4453 L1682,387.4453 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322" x="688.5" y="404.5122">HAPPY_SCENARIO: Switch returns a non-empty list</text><polygon fill="#A80036" points="1267.5,438.7109,1257.5,442.7109,1267.5,446.7109,1263.5,442.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1261.5" x2="1644.5" y1="442.7109" y2="442.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="1273.5" y="437.645">PRELINKING-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="1379.5" y="437.645">PUT /services/THIRD_PARTY_DFSP</text><rect fill="#ADD8E6" filter="url(#f1g002lcjjz8s3)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="222" x="1418" y="455.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="1422" y="471.7778">PUT /services/THIRD_PARTY_DFSP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1422" y="486.9106">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="1430" y="502.0435">serviceProviders: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="1438" y="517.1763">"dfspa", "dfspb"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="1430" y="532.3091">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1422" y="547.4419">}</text><polygon fill="#A80036" points="1638.5,576.6406,1648.5,580.6406,1638.5,584.6406,1642.5,580.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1256.5" x2="1644.5" y1="580.6406" y2="580.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="1263.5" y="575.5747">PRELINKING-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1369.5" y="575.5747">200 OK</text><polygon fill="#A80036" points="898.5,605.7734,888.5,609.7734,898.5,613.7734,894.5,609.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="892.5" x2="1250.5" y1="609.7734" y2="609.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="904.5" y="604.7075">PRELINKING-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="1010.5" y="604.7075">Services request recieved</text><rect fill="#FBFB77" filter="url(#f1g002lcjjz8s3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="233" x="892" y="622.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="896" y="638.8403">state: enabledDFSPLookupSuccess</text><polygon fill="#A80036" points="532.5,668.0391,522.5,672.0391,532.5,676.0391,528.5,672.0391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="526.5" x2="881.5" y1="672.0391" y2="672.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="538.5" y="666.9731">PRELINKING-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="653.5" y="666.9731">return TPEnabledDFSPs</text><polygon fill="#A80036" points="77.5,697.1719,67.5,701.1719,77.5,705.1719,73.5,701.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="71.5" x2="510.5" y1="701.1719" y2="701.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="83.5" y="696.106">PRELINKING-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="198.5" y="696.106">200 OK TPEnabledDFSPs</text><path d="M20,714.1719 L20,754.1719 L1692,754.1719 L1692,724.1719 L1682,714.1719 L20,714.1719 " fill="#FBFB77" filter="url(#f1g002lcjjz8s3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1682,714.1719 L1682,724.1719 L1692,724.1719 L1682,714.1719 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="682.5" y="731.2388">ERROR_SCENARIO: Switch receives 7201 error.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="682.5" y="746.3716">NOTE: What microservice is handling service lookup?</text><polygon fill="#A80036" points="1267.5,780.5703,1257.5,784.5703,1267.5,788.5703,1263.5,784.5703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1261.5" x2="1644.5" y1="784.5703" y2="784.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="1273.5" y="779.5044">PRELINKING-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="1388.5" y="779.5044">PUT /services/THIRD_PARTY_DFSP/error</text><rect fill="#F08080" filter="url(#f1g002lcjjz8s3)" height="113" style="stroke:#A80036;stroke-width:1.0;" width="348" x="1292" y="797.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="1296" y="813.6372">PUT /services/THIRD_PARTY_DFSP/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1296" y="828.77">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="1304" y="843.9028">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="1312" y="859.0356">errorCode: '7201',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="1312" y="874.1685">errorDescription: 'No thirdparty enabled FSP found'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1304" y="889.3013">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1296" y="904.4341">}</text><polygon fill="#A80036" points="1638.5,933.6328,1648.5,937.6328,1638.5,941.6328,1642.5,937.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1256.5" x2="1644.5" y1="937.6328" y2="937.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="1263.5" y="932.5669">PRELINKING-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1378.5" y="932.5669">200 OK</text><polygon fill="#A80036" points="898.5,962.7656,888.5,966.7656,898.5,970.7656,894.5,966.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="892.5" x2="1250.5" y1="966.7656" y2="966.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="904.5" y="961.6997">PRELINKING-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="1019.5" y="961.6997">ErrorInformationObject recieved</text><line style="stroke:#A80036;stroke-width:1.0;" x1="887.5" x2="929.5" y1="995.8984" y2="995.8984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="929.5" x2="929.5" y1="995.8984" y2="1008.8984"/><line style="stroke:#A80036;stroke-width:1.0;" x1="888.5" x2="929.5" y1="1008.8984" y2="1008.8984"/><polygon fill="#A80036" points="898.5,1004.8984,888.5,1008.8984,898.5,1012.8984,894.5,1008.8984" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="894.5" y="990.8325">PRELINKING-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="1009.5" y="990.8325">throw same error</text><rect fill="#F08080" filter="url(#f1g002lcjjz8s3)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="348" x="892" y="1021.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="896" y="1037.9653">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="904" y="1053.0981">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="912" y="1068.231">errorCode: '7201',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="912" y="1083.3638">errorDescription: 'No thirdparty enabled FSP found'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="904" y="1098.4966">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="896" y="1113.6294">}</text><rect fill="#FBFB77" filter="url(#f1g002lcjjz8s3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="96" x="892" y="1130.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="896" y="1146.7622">state: errored</text><polygon fill="#A80036" points="532.5,1175.9609,522.5,1179.9609,532.5,1183.9609,528.5,1179.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="526.5" x2="881.5" y1="1179.9609" y2="1179.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="538.5" y="1174.895">PRELINKING-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="653.5" y="1174.895">catch MojaloopFSPIOPError</text><polygon fill="#A80036" points="77.5,1205.0938,67.5,1209.0938,77.5,1213.0938,73.5,1209.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="71.5" x2="510.5" y1="1209.0938" y2="1209.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="83.5" y="1204.0278">PRELINKING-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="198.5" y="1204.0278">500 Internal Server Error ErrorInformationObject</text><path d="M20,1222.0938 L20,1247.0938 L1692,1247.0938 L1692,1232.0938 L1682,1222.0938 L20,1222.0938 " fill="#FBFB77" filter="url(#f1g002lcjjz8s3)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1682,1222.0938 L1682,1232.0938 L1692,1232.0938 L1682,1222.0938 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="677.5" y="1239.1606">ERROR_SCENARIO: Switch sends back any other error.</text><polygon fill="#A80036" points="1267.5,1273.3594,1257.5,1277.3594,1267.5,1281.3594,1263.5,1277.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1261.5" x2="1644.5" y1="1277.3594" y2="1277.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="1273.5" y="1272.2935">PRELINKING-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="1388.5" y="1272.2935">PUT /services/THIRD_PARTY_DFSP/error</text><rect fill="#F08080" filter="url(#f1g002lcjjz8s3)" height="113" style="stroke:#A80036;stroke-width:1.0;" width="268" x="1372" y="1290.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="1376" y="1306.4263">PUT /services/THIRD_PARTY_DFSP/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1376" y="1321.5591">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="1384" y="1336.6919">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="1392" y="1351.8247">errorCode: '2001',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="1392" y="1366.9575">errorDescription: 'Internal server error'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1384" y="1382.0903">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1376" y="1397.2231">}</text><polygon fill="#A80036" points="1638.5,1426.4219,1648.5,1430.4219,1638.5,1434.4219,1642.5,1430.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1256.5" x2="1644.5" y1="1430.4219" y2="1430.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="1263.5" y="1425.356">PRELINKING-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1378.5" y="1425.356">200 OK</text><polygon fill="#A80036" points="898.5,1455.5547,888.5,1459.5547,898.5,1463.5547,894.5,1459.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="892.5" x2="1250.5" y1="1459.5547" y2="1459.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="904.5" y="1454.4888">PRELINKING-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="1019.5" y="1454.4888">Services request recieved</text><line style="stroke:#A80036;stroke-width:1.0;" x1="887.5" x2="929.5" y1="1488.6875" y2="1488.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="929.5" x2="929.5" y1="1488.6875" y2="1501.6875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="888.5" x2="929.5" y1="1501.6875" y2="1501.6875"/><polygon fill="#A80036" points="898.5,1497.6875,888.5,1501.6875,898.5,1505.6875,894.5,1501.6875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="894.5" y="1483.6216">PRELINKING-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="1009.5" y="1483.6216">throw account linking generic error</text><rect fill="#F08080" filter="url(#f1g002lcjjz8s3)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="392" x="892" y="1514.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="896" y="1530.7544">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="904" y="1545.8872">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="912" y="1561.02">errorCode: '7200',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="368" x="912" y="1576.1528">errorDescription: 'Generic Thirdparty account linking error'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="904" y="1591.2856">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="896" y="1606.4185">}</text><rect fill="#FBFB77" filter="url(#f1g002lcjjz8s3)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="96" x="892" y="1623.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="896" y="1639.5513">state: errored</text><polygon fill="#A80036" points="532.5,1668.75,522.5,1672.75,532.5,1676.75,528.5,1672.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="526.5" x2="881.5" y1="1672.75" y2="1672.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="538.5" y="1667.6841">PRELINKING-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="653.5" y="1667.6841">catch MojaloopFSPIOPError</text><polygon fill="#A80036" points="72.5,1697.8828,62.5,1701.8828,72.5,1705.8828,68.5,1701.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="66.5" x2="515.5" y1="1701.8828" y2="1701.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="78.5" y="1696.8169">PRELINKING-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="193.5" y="1696.8169">500 Internal Server Error ErrorInformationObject</text><!--MD5=[11c537dc180319148b7c4be866caa8e2]
@startuml

title PISP Pre-Linking

participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPrelinkingModel" as PISP_PLM
  participant "inbound-server" as PISP_TP_IN
end box
box "Mojaloop"
    participant Switch
end box

== Pre-Linking ==
autonumber 1 "<b>PRELINKING-#</b>"

PISP -> PISP_TP_OUT: GET /linking/get-dfsps

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await create()
rnote right of PISP_TP_OUT: state: start
PISP_TP_OUT -> PISP_PLM: model.getThirdpartyEnabledDFSPs()

activate PISP_PLM

PISP_PLM -> PISP_PLM: ThirdpartyRequests.getServicesById()
PISP_PLM -> Switch: GET /services/THIRD_PARTY_DFSP

activate Switch
Switch - -> PISP_PLM: 202 Accepted
deactivate PISP_PLM

note over PISP, Switch
  HAPPY_SCENARIO: Switch returns a non-empty list
end note

activate PISP_TP_IN

Switch - -> PISP_TP_IN: PUT /services/THIRD_PARTY_DFSP
rnote left of Switch #LightBlue
PUT /services/THIRD_PARTY_DFSP
{
  serviceProviders: [
    "dfspa", "dfspb"
  ]
}
end note
PISP_TP_IN - -> Switch: 200 OK

deactivate Switch

PISP_TP_IN -> PISP_PLM: Services request recieved

deactivate PISP_TP_IN
activate PISP_PLM

rnote right of PISP_PLM: state: enabledDFSPLookupSuccess
PISP_PLM -> PISP_TP_OUT: return TPEnabledDFSPs

deactivate PISP_PLM

PISP_TP_OUT - -> PISP: 200 OK TPEnabledDFSPs

note over PISP, Switch
  ERROR_SCENARIO: Switch receives 7201 error.
  NOTE: What microservice is handling service lookup?
end note

activate PISP_TP_IN
activate Switch

Switch - -> PISP_TP_IN: PUT /services/THIRD_PARTY_DFSP/error
rnote left of Switch #LightCoral
PUT /services/THIRD_PARTY_DFSP/error
{
  errorInformation: {
    errorCode: '7201',
    errorDescription: 'No thirdparty enabled FSP found'
  }
}
end note
PISP_TP_IN - -> Switch: 200 OK

deactivate Switch

PISP_TP_IN -> PISP_PLM: ErrorInformationObject recieved

deactivate PISP_TP_IN
activate PISP_PLM

PISP_PLM -> PISP_PLM: throw same error
rnote right of PISP_PLM #LightCoral
{
  errorInformation: {
    errorCode: '7201',
    errorDescription: 'No thirdparty enabled FSP found'
  }
}
end note
rnote right of PISP_PLM: state: errored
PISP_PLM -> PISP_TP_OUT: catch MojaloopFSPIOPError

deactivate PISP_PLM

PISP_TP_OUT - -> PISP: 500 Internal Server Error ErrorInformationObject


note over PISP, Switch
  ERROR_SCENARIO: Switch sends back any other error.
end note

activate PISP_TP_IN
activate Switch
Switch - -> PISP_TP_IN: PUT /services/THIRD_PARTY_DFSP/error
rnote left of Switch #LightCoral
PUT /services/THIRD_PARTY_DFSP/error
{
  errorInformation: {
    errorCode: '2001',
    errorDescription: 'Internal server error'
  }
}
end note
PISP_TP_IN - -> Switch: 200 OK

deactivate Switch

PISP_TP_IN -> PISP_PLM: Services request recieved

deactivate PISP_TP_IN
activate PISP_PLM

PISP_PLM -> PISP_PLM: throw account linking generic error
rnote right of PISP_PLM #LightCoral
{
  errorInformation: {
    errorCode: '7200',
    errorDescription: 'Generic Thirdparty account linking error'
  }
}
end note
rnote right of PISP_PLM: state: errored
PISP_PLM -> PISP_TP_OUT: catch MojaloopFSPIOPError

deactivate PISP_PLM

PISP_TP_OUT - -> PISP: 500 Internal Server Error ErrorInformationObject

deactivate PISP_TP_OUT
deactivate PISP

@enduml

PlantUML version 1.2021.00(Sun Jan 10 05:25:05 EST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>