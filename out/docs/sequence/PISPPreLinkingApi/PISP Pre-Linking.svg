<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="872px" preserveAspectRatio="none" style="width:1511px;height:872px;" version="1.1" viewBox="0 0 1511 872" width="1511px" zoomAndPan="magnify"><defs><filter height="300%" id="f17wb2i85l9xgr" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="145" x="679.5" y="28.708">PISP Pre-Linking</text><rect fill="#DDDDDD" height="825.3125" style="stroke:#A80036;stroke-width:1.0;" width="871.5" x="296.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="642.25" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="825.3125" style="stroke:#A80036;stroke-width:1.0;" width="73" x="1421" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="1424" y="53.02">Mojaloop</text><rect fill="#FFFFFF" filter="url(#f17wb2i85l9xgr)" height="649.3203" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="169.6484"/><rect fill="#FFFFFF" filter="url(#f17wb2i85l9xgr)" height="649.3203" style="stroke:#A80036;stroke-width:1.0;" width="10" x="362.5" y="169.6484"/><rect fill="#FFFFFF" filter="url(#f17wb2i85l9xgr)" height="100.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="728.5" y="274.0469"/><rect fill="#FFFFFF" filter="url(#f17wb2i85l9xgr)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="728.5" y="609.7734"/><rect fill="#FFFFFF" filter="url(#f17wb2i85l9xgr)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1097.5" y="374.4453"/><rect fill="#FFFFFF" filter="url(#f17wb2i85l9xgr)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1452.5" y="345.3125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="61" x2="61" y1="95.3828" y2="827.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="367.5" x2="367.5" y1="95.3828" y2="827.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="733.5" x2="733.5" y1="95.3828" y2="827.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1102" x2="1102" y1="95.3828" y2="827.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1457" x2="1457" y1="95.3828" y2="827.9688"/><rect fill="#FEFECE" filter="url(#f17wb2i85l9xgr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="12" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#f17wb2i85l9xgr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="5" y="826.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="12" y="846.9639">PISP Backend</text><rect fill="#FEFECE" filter="url(#f17wb2i85l9xgr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="300.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="307.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f17wb2i85l9xgr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="300.5" y="826.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="307.5" y="846.9639">outbound-server</text><rect fill="#FEFECE" filter="url(#f17wb2i85l9xgr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="144" x="659.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="666.5" y="80.0811">PISPrelinkingModel</text><rect fill="#FEFECE" filter="url(#f17wb2i85l9xgr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="144" x="659.5" y="826.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="666.5" y="846.9639">PISPrelinkingModel</text><rect fill="#FEFECE" filter="url(#f17wb2i85l9xgr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1041" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1048" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f17wb2i85l9xgr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1041" y="826.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1048" y="846.9639">inbound-server</text><rect fill="#FEFECE" filter="url(#f17wb2i85l9xgr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1426" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1433" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#f17wb2i85l9xgr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1426" y="826.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1433" y="846.9639">Switch</text><rect fill="#FFFFFF" filter="url(#f17wb2i85l9xgr)" height="649.3203" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="169.6484"/><rect fill="#FFFFFF" filter="url(#f17wb2i85l9xgr)" height="649.3203" style="stroke:#A80036;stroke-width:1.0;" width="10" x="362.5" y="169.6484"/><rect fill="#FFFFFF" filter="url(#f17wb2i85l9xgr)" height="100.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="728.5" y="274.0469"/><rect fill="#FFFFFF" filter="url(#f17wb2i85l9xgr)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="728.5" y="609.7734"/><rect fill="#FFFFFF" filter="url(#f17wb2i85l9xgr)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1097.5" y="374.4453"/><rect fill="#FFFFFF" filter="url(#f17wb2i85l9xgr)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1452.5" y="345.3125"/><rect fill="#EEEEEE" filter="url(#f17wb2i85l9xgr)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1504" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1504" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1504" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#f17wb2i85l9xgr)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="102" x="701" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="83" x="707" y="131.4497">Pre-Linking</text><polygon fill="#A80036" points="350.5,165.6484,360.5,169.6484,350.5,173.6484,354.5,169.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="66.5" x2="356.5" y1="169.6484" y2="169.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="73.5" y="164.5825">PRELINKING-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="179.5" y="164.5825">GET /linking/providers</text><line style="stroke:#A80036;stroke-width:1.0;" x1="372.5" x2="414.5" y1="198.7813" y2="198.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="414.5" x2="414.5" y1="198.7813" y2="211.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="373.5" x2="414.5" y1="211.7813" y2="211.7813"/><polygon fill="#A80036" points="383.5,207.7813,373.5,211.7813,383.5,215.7813,379.5,211.7813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="379.5" y="193.7153">PRELINKING-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="485.5" y="193.7153">const model = await create()</text><rect fill="#FBFB77" filter="url(#f17wb2i85l9xgr)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="79" x="377" y="224.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="381" y="240.8481">state: start</text><polygon fill="#A80036" points="716.5,270.0469,726.5,274.0469,716.5,278.0469,720.5,274.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="372.5" x2="722.5" y1="274.0469" y2="274.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="379.5" y="268.981">PRELINKING-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="485.5" y="268.981">model.getThirdpartyEnabledDFSPs()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="738.5" x2="780.5" y1="303.1797" y2="303.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="780.5" x2="780.5" y1="303.1797" y2="316.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="739.5" x2="780.5" y1="316.1797" y2="316.1797"/><polygon fill="#A80036" points="749.5,312.1797,739.5,316.1797,749.5,320.1797,745.5,316.1797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="745.5" y="298.1138">PRELINKING-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="851.5" y="298.1138">ThirdpartyRequests.getServicesById()</text><polygon fill="#A80036" points="1440.5,341.3125,1450.5,345.3125,1440.5,349.3125,1444.5,345.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="738.5" x2="1446.5" y1="345.3125" y2="345.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="745.5" y="340.2466">PRELINKING-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="851.5" y="340.2466">GET /services/THIRD_PARTY_DFSP</text><polygon fill="#A80036" points="744.5,370.4453,734.5,374.4453,744.5,378.4453,740.5,374.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="738.5" x2="1451.5" y1="374.4453" y2="374.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="750.5" y="369.3794">PRELINKING-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="856.5" y="369.3794">202 Accepted</text><path d="M20,387.4453 L20,412.4453 L1499,412.4453 L1499,397.4453 L1489,387.4453 L20,387.4453 " fill="#FBFB77" filter="url(#f17wb2i85l9xgr)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1489,387.4453 L1489,397.4453 L1499,397.4453 L1489,387.4453 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322" x="592" y="404.5122">HAPPY_SCENARIO: Switch returns a non-empty list</text><polygon fill="#A80036" points="1118.5,438.7109,1108.5,442.7109,1118.5,446.7109,1114.5,442.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1112.5" x2="1451.5" y1="442.7109" y2="442.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="1124.5" y="437.645">PRELINKING-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="1230.5" y="437.645">PUT /services/THIRD_PARTY_DFSP</text><rect fill="#ADD8E6" filter="url(#f17wb2i85l9xgr)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="222" x="1225" y="455.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="1229" y="471.7778">PUT /services/THIRD_PARTY_DFSP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1229" y="486.9106">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="1237" y="502.0435">providers: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="1245" y="517.1763">"dfspa", "dfspb"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="1237" y="532.3091">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1229" y="547.4419">}</text><polygon fill="#A80036" points="1445.5,576.6406,1455.5,580.6406,1445.5,584.6406,1449.5,580.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1107.5" x2="1451.5" y1="580.6406" y2="580.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="1114.5" y="575.5747">PRELINKING-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1220.5" y="575.5747">200 OK</text><polygon fill="#A80036" points="749.5,605.7734,739.5,609.7734,749.5,613.7734,745.5,609.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="743.5" x2="1101.5" y1="609.7734" y2="609.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="102" x="755.5" y="604.7075">PRELINKING-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="861.5" y="604.7075">Services request recieved</text><rect fill="#FBFB77" filter="url(#f17wb2i85l9xgr)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="233" x="743" y="622.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="747" y="638.8403">state: enabledDFSPLookupSuccess</text><polygon fill="#A80036" points="383.5,668.0391,373.5,672.0391,383.5,676.0391,379.5,672.0391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="377.5" x2="732.5" y1="672.0391" y2="672.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="389.5" y="666.9731">PRELINKING-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="504.5" y="666.9731">return TPEnabledDFSPs</text><polygon fill="#A80036" points="77.5,697.1719,67.5,701.1719,77.5,705.1719,73.5,701.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="71.5" x2="361.5" y1="701.1719" y2="701.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="111" x="83.5" y="696.106">PRELINKING-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="198.5" y="696.106">200 OK TPEnabledDFSPs</text><rect fill="#ADD8E6" filter="url(#f17wb2i85l9xgr)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="204" x="153" y="714.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="157" y="730.2388">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="72" x="173" y="745.3716">providers: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="185" y="760.5044">"dfspa", "dfspb"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="173" y="775.6372">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="173" y="790.77">currentState="COMPLETED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="157" y="805.9028">}</text><!--MD5=[fdd47cec7be8920fdc2b2c78b3e8b445]
@startuml

title PISP Pre-Linking

participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPrelinkingModel" as PISP_PLM
  participant "inbound-server" as PISP_TP_IN
end box
box "Mojaloop"
    participant Switch
end box

== Pre-Linking ==
autonumber 1 "<b>PRELINKING-#</b>"

PISP -> PISP_TP_OUT: GET /linking/providers

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await create()
rnote right of PISP_TP_OUT: state: start
PISP_TP_OUT -> PISP_PLM: model.getThirdpartyEnabledDFSPs()

activate PISP_PLM

PISP_PLM -> PISP_PLM: ThirdpartyRequests.getServicesById()
PISP_PLM -> Switch: GET /services/THIRD_PARTY_DFSP

activate Switch
Switch - -> PISP_PLM: 202 Accepted
deactivate PISP_PLM

note over PISP, Switch
  HAPPY_SCENARIO: Switch returns a non-empty list
end note

activate PISP_TP_IN

Switch - -> PISP_TP_IN: PUT /services/THIRD_PARTY_DFSP
rnote left of Switch #LightBlue
PUT /services/THIRD_PARTY_DFSP
{
  providers: [
    "dfspa", "dfspb"
  ]
}
end note
PISP_TP_IN - -> Switch: 200 OK

deactivate Switch

PISP_TP_IN -> PISP_PLM: Services request recieved

deactivate PISP_TP_IN
activate PISP_PLM

rnote right of PISP_PLM: state: enabledDFSPLookupSuccess
PISP_PLM -> PISP_TP_OUT: return TPEnabledDFSPs

deactivate PISP_PLM

PISP_TP_OUT - -> PISP: 200 OK TPEnabledDFSPs
rnote left of PISP_TP_OUT #LightBlue
{
    providers: [
       "dfspa", "dfspb"
    ],
    currentState="COMPLETED"
}
end note

@enduml

PlantUML version 1.2021.00(Sun Jan 10 05:25:05 EST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>