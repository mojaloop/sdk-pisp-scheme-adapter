<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1053px" preserveAspectRatio="none" style="width:844px;height:1053px;" version="1.1" viewBox="0 0 844 1053" width="844px" zoomAndPan="magnify"><defs><filter height="300%" id="f14j0lddn5ecun" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="211" x="310" y="16.708">DFSPOTPValidateModel</text><polygon fill="#FEFECE" filter="url(#f14j0lddn5ecun)" points="35,280.9531,47,292.9531,35,304.9531,23,292.9531,35,280.9531" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#f14j0lddn5ecun)" points="331,553.9531,343,565.9531,331,577.9531,319,565.9531,331,553.9531" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#f14j0lddn5ecun)" points="673,857.9531,685,869.9531,673,881.9531,661,869.9531,673,857.9531" style="stroke:#A80036;stroke-width:1.5;"/><g id="errored"><rect fill="#FEFECE" filter="url(#f14j0lddn5ecun)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="74" x="294" y="989.9531"/><line style="stroke:#A80036;stroke-width:1.5;" x1="294" x2="368" y1="1016.25" y2="1016.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="54" x="304" y="1007.9482">errored</text></g><ellipse cx="35" cy="36.9531" fill="#000000" filter="url(#f14j0lddn5ecun)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="start"><rect fill="#FEFECE" filter="url(#f14j0lddn5ecun)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="55" x="7.5" y="123.9531"/><line style="stroke:#A80036;stroke-width:1.5;" x1="7.5" x2="62.5" y1="150.25" y2="150.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="35" x="17.5" y="141.9482">start</text></g><g id="OTPIsValid"><rect fill="#FEFECE" filter="url(#f14j0lddn5ecun)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="95" x="183.5" y="381.9531"/><line style="stroke:#A80036;stroke-width:1.5;" x1="183.5" x2="278.5" y1="408.25" y2="408.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="193.5" y="399.9482">OTPIsValid</text></g><g id="scopesReceived"><rect fill="#FEFECE" filter="url(#f14j0lddn5ecun)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="136" x="494" y="685.9531"/><line style="stroke:#A80036;stroke-width:1.5;" x1="494" x2="630" y1="712.25" y2="712.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="504" y="703.9482">scopesReceived</text></g><g id="consentSent"><rect fill="#FEFECE" filter="url(#f14j0lddn5ecun)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="112" x="675" y="989.9531"/><line style="stroke:#A80036;stroke-width:1.5;" x1="675" x2="787" y1="1016.25" y2="1016.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="92" x="685" y="1007.9482">consentSent</text></g><!--MD5=[7d9315d395aa72765e62706ddc7d207e]
link isValid to errored--><path d="M32.7244,302.7411 C25.8879,329.1441 6,405.9531 6,405.9531 C6,405.9531 6,405.9531 6,870.9531 C6,870.9531 201.3,956.8851 289.11,995.5214 " fill="none" id="isValid-to-errored" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="293.718,997.5492,287.0919,990.2626,289.1416,995.535,283.8692,997.5848,293.718,997.5492" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="45" x="134.5" y="621.02">FALSE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="44.5" y="636.62">call</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="200" x="69.5" y="636.1239">putConsentRequestsError()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="11" y="652.22"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="248" x="11" y="651.724">PUT /consentRequests/{ID}/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="263" y="652.22">to PISP</text><!--MD5=[3a7df7c632cd12e2e574b325c2bcd294]
link scopesExist to errored--><path d="M330.624,577.6521 C329.17,618.9861 324,765.9531 324,765.9531 C324,765.9531 324,827.9531 324,827.9531 C324,827.9531 327.914,931.9531 329.889,984.4198 " fill="none" id="scopesExist-to-errored" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="330.085,989.6368,333.7436,980.4927,329.8969,984.6404,325.7492,980.7937,330.085,989.6368" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="45" x="452.5" y="786.02">FALSE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="362.5" y="801.62">call</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="200" x="387.5" y="801.1239">putConsentRequestsError()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="329" y="817.22"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="248" x="329" y="816.724">PUT /consentRequests/{ID}/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="581" y="817.22">to PISP</text><!--MD5=[9856b1eac4fc2852c8c344eb44778682]
link sentConsent to errored--><path d="M663.318,872.3171 C612.825,879.4311 382,911.9531 382,911.9531 C382,911.9531 360.527,954.8997 345.447,985.0585 " fill="none" id="sentConsent-to-errored" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="343.086,989.7805,350.6883,983.5191,345.3218,985.3083,343.5327,979.9418,343.086,989.7805" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="45" x="510.5" y="925.02">FALSE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="420.5" y="940.62">call</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="200" x="445.5" y="940.1239">putConsentRequestsError()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="387" y="956.22"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="248" x="387" y="955.724">PUT /consentRequests/{ID}/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="639" y="956.22">to PISP</text><!--MD5=[dd85dc063561b54f5230c9b8c6f8ed31]
link *start to start--><path d="M35,46.9551 C35,62.4111 35,94.6381 35,118.5531 " fill="none" id="*start-to-start" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="35,123.8261,39,114.8261,35,118.8261,31,114.8261,35,123.8261" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="16" x="36" y="90.4872">on</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="216" x="56" y="89.9911">PATCH /consentRequests/{ID}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="276" y="90.4872">from PISP. creation of state machine.</text><!--MD5=[72ed18311fb04d2e0dcbf8838db3ac8d]
link start to isValid--><path d="M35,174.0411 C35,202.8781 35,250.4031 35,275.4021 " fill="none" id="start-to-isValid" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="35,280.6691,39,271.6691,35,275.6691,31,271.6691,35,280.6691" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="118.5" y="217.02">validateOTP()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="40" y="232.62"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="136" x="40" y="232.1239">POST /validateOTP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="180" y="232.62">to DFSP backend</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="142" y="247.7528">isValid?</text><!--MD5=[c6946a040b04f243f7eb5c792933d0bd]
link isValid to OTPIsValid--><path d="M42.4441,298.2071 C65.3403,311.2901 136.069,351.7071 184.086,379.1451 " fill="none" id="isValid-to-OTPIsValid" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="188.659,381.7581,182.8302,373.8193,184.318,379.277,178.8604,380.7648,188.659,381.7581" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40" x="134" y="348.02">TRUE</text><!--MD5=[3017cfff0893d60779c625ea1dba22ee]
link OTPIsValid to scopesExist--><path d="M246.406,432.1401 C268.377,466.6361 307.83,528.5761 323.898,553.8041 " fill="none" id="OTPIsValid-to-scopesExist" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="326.617,558.0721,325.1564,548.3322,323.9311,553.8548,318.4086,552.6296,326.617,558.0721" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="431" y="475.02"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="376.5" y="490.1528">requestScopes()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="309" y="505.7528"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="128" x="309" y="505.2568">GET /{ID}/scopes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="441" y="505.7528">to DFSP backend</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="389.5" y="520.8857">scopesExist?</text><!--MD5=[a7c877e227721624b7631cfa9311259b]
link scopesExist to scopesReceived--><path d="M337.913,571.2331 C364.472,587.6741 461.319,647.6271 518.638,683.1101 " fill="none" id="scopesExist-to-scopesReceived" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="523.035,685.8321,517.4875,677.6943,518.7835,683.2006,513.2771,684.4967,523.035,685.8321" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40" x="474" y="629.02">TRUE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="518" y="629.02"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="498" y="644.1528"/><!--MD5=[cee8b31ad12b4357f1f72f548964064c]
link scopesReceived to sentConsent--><path d="M594.209,736.1101 C613.38,750.4881 634,765.9531 634,765.9531 C634,765.9531 657.703,828.5541 668.152,856.1491 " fill="none" id="scopesReceived-to-sentConsent" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="669.94,860.8711,670.4946,851.0379,668.1698,856.195,663.0128,853.8702,669.94,860.8711" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="748.5" y="779.02"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="688.5" y="794.1528">registerConsent()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="661" y="809.7528"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="112" x="661" y="809.2568">POST /consents</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="777" y="809.7528">to Switch</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="702.5" y="824.8857">Request sent?</text><!--MD5=[ff47c288eda6669fcbf3d37e0cb3f772]
link sentConsent to consentSent--><path d="M676.485,878.4731 C681.97,890.3091 692,911.9531 692,911.9531 C692,911.9531 708.421,954.8997 719.952,985.0585 " fill="none" id="sentConsent-to-consentSent" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="721.758,989.7805,722.2795,979.9455,719.9721,985.1104,714.8072,982.803,721.758,989.7805" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40" x="711" y="940.52">TRUE</text><!--MD5=[2a846cfe0aa84d6837d77f36236546ab]
@startuml
skinparam linetype polyline


title DFSPOTPValidateModel

state isValid <<choice>>
state scopesExist <<choice>>
state sentConsent <<choice>>

isValid - -> errored:**FALSE**\ncall ""putConsentRequestsError()""\n ""PUT /consentRequests/{ID}/error"" to PISP
scopesExist - -> errored:**FALSE**\ncall ""putConsentRequestsError()""\n ""PUT /consentRequests/{ID}/error"" to PISP
sentConsent - -> errored:**FALSE**\ncall ""putConsentRequestsError()""\n ""PUT /consentRequests/{ID}/error"" to PISP

[*] - -> start: on ""PATCH /consentRequests/{ID}"" from PISP. creation of state machine.
start - -> isValid: validateOTP() \n ""POST /validateOTP"" to DFSP backend \n isValid?
isValid - -> OTPIsValid:**TRUE**
OTPIsValid - -> scopesExist: \nrequestScopes()\n ""GET /{ID}/scopes"" to DFSP backend \n scopesExist?
scopesExist - -> scopesReceived:**TRUE** \n
scopesReceived - -> sentConsent:\nregisterConsent() \n ""POST /consents"" to Switch\n Request sent?
sentConsent - -> consentSent:**TRUE**
@enduml

PlantUML version 1.2021.4(Sun Apr 04 08:49:39 UTC 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
