<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1036px" preserveAspectRatio="none" style="width:865px;height:1036px;" version="1.1" viewBox="0 0 865 1036" width="865px" zoomAndPan="magnify"><defs><filter height="300%" id="f1jqzvofqefsm1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="208" x="322.1586" y="16.708">DFSPOTPValidateModel</text><polygon fill="#FEFECE" filter="url(#f1jqzvofqefsm1)" points="461.3173,503.9531,473.3173,515.9531,461.3173,527.9531,449.3173,515.9531,461.3173,503.9531" style="stroke:#A80036;stroke-width:1.5;"/><polygon fill="#FEFECE" filter="url(#f1jqzvofqefsm1)" points="229.3173,873.9531,241.3173,885.9531,229.3173,897.9531,217.3173,885.9531,229.3173,873.9531" style="stroke:#A80036;stroke-width:1.5;"/><ellipse cx="461.3173" cy="36.9531" fill="#000000" filter="url(#f1jqzvofqefsm1)" rx="10" ry="10" style="stroke:none;stroke-width:1.0;"/><g id="patchConsentRequestIdReceived"><rect fill="#FEFECE" filter="url(#f1jqzvofqefsm1)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="253" x="334.8173" y="123.9531"/><line style="stroke:#A80036;stroke-width:1.5;" x1="334.8173" x2="587.8173" y1="150.25" y2="150.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="233" x="344.8173" y="141.9482">patchConsentRequestIdReceived</text></g><g id="isOTPValid"><rect fill="#FEFECE" filter="url(#f1jqzvofqefsm1)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="92" x="415.3173" y="234.9531"/><line style="stroke:#A80036;stroke-width:1.5;" x1="415.3173" x2="507.3173" y1="261.25" y2="261.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="425.3173" y="252.9482">isOTPValid</text></g><g id="isOTPValidReceived"><rect fill="#FEFECE" filter="url(#f1jqzvofqefsm1)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="156" x="383.3173" y="376.9531"/><line style="stroke:#A80036;stroke-width:1.5;" x1="383.3173" x2="539.3173" y1="403.25" y2="403.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="136" x="393.3173" y="394.9482">isOTPValidReceived</text></g><g id="getScopes"><rect fill="#FEFECE" filter="url(#f1jqzvofqefsm1)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="95" x="318.8173" y="604.9531"/><line style="stroke:#A80036;stroke-width:1.5;" x1="318.8173" x2="413.8173" y1="631.25" y2="631.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="328.8173" y="622.9482">getScopes</text></g><g id="scopesReceived"><rect fill="#FEFECE" filter="url(#f1jqzvofqefsm1)" height="50" rx="12.5" ry="12.5" style="stroke:#A80036;stroke-width:1.5;" width="135" x="203.8173" y="746.9531"/><line style="stroke:#A80036;stroke-width:1.5;" x1="203.8173" x2="338.8173" y1="773.25" y2="773.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="213.8173" y="764.9482">scopesReceived</text></g><ellipse cx="229.3173" cy="1014.9531" fill="none" filter="url(#f1jqzvofqefsm1)" rx="10" ry="10" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="229.8173" cy="1015.4531" fill="#000000" rx="6" ry="6" style="stroke:none;stroke-width:1.0;"/><!--MD5=[f98e619f72ffd02dae37e122d1bddcd9]
link *start to patchConsentRequestIdReceived--><path d="M461.3173,47.289 C461.3173,63.299 461.3173,94.7165 461.3173,118.4102 " fill="none" id="*start-to-patchConsentRequestIdReceived" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="461.3173,123.6435,465.3173,114.6435,461.3173,118.6435,457.3173,114.6435,461.3173,123.6435" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="462.3173" y="90.02">on</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="482.3173" y="90.02">PATCH /consentRequests/{ID}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="702.3173" y="90.02">from PISP</text><!--MD5=[0d310c200aaf7323e993c115b57fad27]
link patchConsentRequestIdReceived to isOTPValid--><path d="M461.3173,174.1407 C461.3173,190.6035 461.3173,212.1992 461.3173,229.6074 " fill="none" id="patchConsentRequestIdReceived-to-isOTPValid" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="461.3173,234.8652,465.3173,225.8652,461.3173,229.8652,457.3173,225.8652,461.3173,234.8652" style="stroke:#A80036;stroke-width:1.0;"/><!--MD5=[46ff1aca4ed0677c414cc4afaf78576e]
link isOTPValid to isOTPValidReceived--><path d="M461.3173,285.013 C461.3173,309.1975 461.3173,345.8447 461.3173,371.6554 " fill="none" id="isOTPValid-to-isOTPValidReceived" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="461.3173,376.6661,465.3173,367.6661,461.3173,371.6661,457.3173,367.6661,461.3173,376.6661" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="498.3173" y="328.02">call</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="523.3173" y="328.02">validateOTPSecret()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="679.3173" y="328.02"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="466.3173" y="343.1528"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="466.3173" y="343.1528">POST /validateOTP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="606.3173" y="343.1528">to DFSP backend</text><!--MD5=[cf3c56ec8d567699b3e828443b8e5526]
link isOTPValidReceived to isValid--><path d="M461.3173,426.9709 C461.3173,448.7781 461.3173,479.8195 461.3173,498.8845 " fill="none" id="isOTPValidReceived-to-isValid" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="461.3173,503.9266,465.3173,494.9266,461.3173,498.9266,457.3173,494.9266,461.3173,503.9266" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="462.3173" y="470.02">isValid?</text><!--MD5=[dc0fcadd857e476eb71f0918f7724b8e]
link isValid to getScopes--><path d="M455.6591,522.7429 C443.1467,537.7578 412.5038,574.5293 390.5983,600.8159 " fill="none" id="isValid-to-getScopes" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="387.1617,604.9397,395.9962,600.5863,390.3626,601.0986,389.8503,595.465,387.1617,604.9397" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="426.3173" y="571.02">TRUE</text><!--MD5=[9e576eface5aaaa7d6fcc43f59827160]
link getScopes to scopesReceived--><path d="M318.4064,651.458 C304.6306,659.9501 290.9991,671.0568 282.3173,684.9531 C271.8633,701.6858 269.1746,723.7725 269.0681,741.5045 " fill="none" id="getScopes-to-scopesReceived" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="269.1123,746.857,273.0378,737.8243,269.071,741.8572,265.0381,737.8904,269.1123,746.857" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="349.3173" y="698.02">call</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="374.3173" y="698.02">getScopes()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="287.3173" y="713.1528"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="287.3173" y="713.1528">GET /{ID}/scopes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="419.3173" y="713.1528">to DFSP backend</text><!--MD5=[57445bfde06ae5035de234419763615f]
link isValid to *end--><path d="M469.0097,520.2649 C491.4596,533.48 555.3173,575.827 555.3173,629.9531 C555.3173,629.9531 555.3173,629.9531 555.3173,885.9531 C555.3173,926.6992 563.6899,947.7915 533.3173,974.9531 C511.5505,994.4187 303.7637,1009.9017 244.8296,1013.9288 " fill="none" id="isValid-to-*end" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="239.6022,1014.2825,248.8518,1017.6655,244.5908,1013.9448,248.3115,1009.6838,239.6022,1014.2825" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="684.3173" y="761.52">FALSE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="594.3173" y="776.6528">call</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="619.3173" y="776.6528">putConsentRequestsError()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="560.3173" y="791.7856"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="560.3173" y="791.7856">PUT /consentRequests/{ID}/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="812.3173" y="791.7856">to PISP</text><!--MD5=[d6cd38ac69a87ee601a0b7021c70b8ce]
link scopesReceived to scopesExist--><path d="M262.1002,796.9709 C253.5803,820.0961 241.2348,853.6055 234.3822,872.2054 " fill="none" id="scopesReceived-to-scopesExist" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="232.6028,877.0352,239.4678,869.9732,234.3315,872.3436,231.9611,867.2073,232.6028,877.0352" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="251.3173" y="840.02">scopesExist?</text><!--MD5=[bc9f7f0e9f77335814c469a795d5d442]
link scopesExist to *end--><path d="M217.6838,886.4212 C177.3864,888.3091 44.8339,896.8278 19.3173,927.9531 C6.0739,944.1074 6,958.8598 19.3173,974.9531 C44.2203,1005.0473 170.1515,1012.6954 214.1322,1014.4635 " fill="none" id="scopesExist-to-*end" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="219.3113,1014.6594,210.4689,1010.3221,214.3149,1014.4704,210.1665,1018.3164,219.3113,1014.6594" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="84.3173" y="941.02">TRUE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="34.3173" y="956.1528">call</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="59.3173" y="956.1528">postConsents()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="24.3173" y="971.2856"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="24.3173" y="971.2856">POST /consents</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="140.3173" y="971.2856">to PISP</text><!--MD5=[bc9f7f0e9f77335814c469a795d5d442]
link scopesExist to *end--><path d="M228.3125,896.9953 C227.5948,905.459 226.6925,917.433 226.3173,927.9531 C225.5726,948.8287 225.5356,954.0788 226.3173,974.9531 C226.6204,983.0495 227.2677,992.0485 227.8836,999.4574 " fill="none" id="scopesExist-to-*end-1" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="228.3423,1004.7717,231.5532,995.461,227.9122,999.7903,223.5829,996.1492,228.3423,1004.7717" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45" x="355.3173" y="941.02">FALSE</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="265.3173" y="956.1528">call</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="290.3173" y="956.1528">putConsentRequestsError()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="231.3173" y="971.2856"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="231.3173" y="971.2856">PUT /consentRequests/{ID}/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="45" x="483.3173" y="971.2856">to PISP</text><!--MD5=[40f266116a388374ae8fe5ddb0268370]
@startuml
title DFSPOTPValidateModel

state isValid <<choice>>
state scopesExist <<choice>>

[*] - -> patchConsentRequestIdReceived: on ""PATCH /consentRequests/{ID}"" from PISP
patchConsentRequestIdReceived - -> isOTPValid
isOTPValid - -> isOTPValidReceived: call ""validateOTPSecret()"" \n ""POST /validateOTP"" to DFSP backend
isOTPValidReceived - -> isValid: isValid?
isValid - -> getScopes:**TRUE**
getScopes - -> scopesReceived: call ""getScopes()""\n ""GET /{ID}/scopes"" to DFSP backend
isValid - -> [*]:**FALSE**\ncall ""putConsentRequestsError()""\n ""PUT /consentRequests/{ID}/error"" to PISP
scopesReceived - -> scopesExist: scopesExist?
scopesExist - -> [*]:**TRUE**\ncall ""postConsents()""\n ""POST /consents"" to PISP
scopesExist - -> [*]:**FALSE**\ncall ""putConsentRequestsError()""\n ""PUT /consentRequests/{ID}/error"" to PISP
@enduml

PlantUML version 1.2020.22(Sun Dec 06 09:36:27 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>