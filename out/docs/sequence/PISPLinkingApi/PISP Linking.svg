<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="8878px" preserveAspectRatio="none" style="width:4609px;height:8878px;" version="1.1" viewBox="0 0 4609 8878" width="4609px" zoomAndPan="magnify"><defs><filter height="300%" id="f12n4llvw00jwz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="108" x="2247.25" y="28.708">PISP Linking</text><rect fill="#DDDDDD" height="8831.7344" style="stroke:#A80036;stroke-width:1.0;" width="1122.5" x="407.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="878.75" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="8831.7344" style="stroke:#A80036;stroke-width:1.0;" width="920.5" x="1945" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="2371.75" y="53.02">Mojaloop</text><rect fill="#DDDDDD" height="8831.7344" style="stroke:#A80036;stroke-width:1.0;" width="658" x="3136" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186" x="3372" y="53.02">DFSP tp-scheme-adapter</text><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="1481.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="71.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="1481.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="71.5" y="2089.0703"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="4865.1641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="71.5" y="3960.2266"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="1481.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="473.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="1481.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="473.5" y="2089.0703"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="4865.1641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="473.5" y="3960.2266"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="375.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="446.2422"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="1521.75"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="375.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="2332.5313"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="3408.0391"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="209.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="4143.1563"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="652.8516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="5590.125"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="125.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="8552.9297"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="155.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1459.5" y="1463.4844"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="155.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1459.5" y="3349.7734"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="129.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1459.5" y="5523.8594"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="100.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1459.5" y="8515.7969"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="467.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="517.5078"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="394.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="1127.0938"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="467.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="2403.7969"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="394.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="3013.3828"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="300.5938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="4214.4219"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="407.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="5245.8672"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="552.3203" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="5886.4531"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="946.9766" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="6584.3047"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="297.7266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="8318.4688"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="389.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2323.5" y="6936.8281"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2323.5" y="7531.2813"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="233.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2764.5" y="7560.4141"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3196.5" y="851.0313"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3196.5" y="2737.3203"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3196.5" y="4381.4844"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="166.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3196.5" y="6272.1094"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="204.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3196.5" y="7326.4844"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="175.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3196.5" y="7618.6797"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="575.3203" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3712.5" y="888.1641"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="575.3203" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3712.5" y="2774.4531"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="1105.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3712.5" y="4418.6172"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="598.4531" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3712.5" y="6309.2422"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="984.5156" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3712.5" y="7502.1484"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="105.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="4220.5" y="1021.6953"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="105.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="4220.5" y="2907.9844"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="279.3281" style="stroke:#000000;stroke-width:2.0;" width="1861" x="1939" y="7884.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="76" x2="76" y1="95.3828" y2="8834.3906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="478.5" x2="478.5" y1="95.3828" y2="8834.3906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="954.5" x2="954.5" y1="95.3828" y2="8834.3906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1464" x2="1464" y1="95.3828" y2="8834.3906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1980" x2="1980" y1="95.3828" y2="8834.3906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2328.5" x2="2328.5" y1="95.3828" y2="8834.3906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2769.5" x2="2769.5" y1="95.3828" y2="8834.3906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="3201" x2="3201" y1="95.3828" y2="8834.3906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="3717" x2="3717" y1="95.3828" y2="8834.3906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="4225" x2="4225" y1="95.3828" y2="8834.3906"/><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="20" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="27" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="20" y="8833.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="27" y="8853.3857">PISP Backend</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="411.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="418.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="411.5" y="8833.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="418.5" y="8853.3857">outbound-server</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="134" x="885.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="892.5" y="80.0811">PISPLinkingModel</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="134" x="885.5" y="8833.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="892.5" y="8853.3857">PISPLinkingModel</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1403" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1410" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1403" y="8833.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1410" y="8853.3857">inbound-server</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1949" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1956" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1949" y="8833.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1956" y="8853.3857">Switch</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="100" x="2276.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="2283.5" y="80.0811">Auth Service</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="100" x="2276.5" y="8833.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="2283.5" y="8853.3857">Auth Service</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="180" x="2677.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="2684.5" y="80.0811">Account Lookup Service</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="180" x="2677.5" y="8833.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="2684.5" y="8853.3857">Account Lookup Service</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="3140" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="3147" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="3140" y="8833.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="3147" y="8853.3857">inbound-server</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="141" x="3645" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="3652" y="80.0811">DFSPLinkingModel</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="141" x="3645" y="8833.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="3652" y="8853.3857">DFSPLinkingModel</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="181" x="4133" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="4140" y="80.0811">DFSPAuthorizeSimulator</text><rect fill="#FEFECE" filter="url(#f12n4llvw00jwz)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="181" x="4133" y="8833.3906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="4140" y="8853.3857">DFSPAuthorizeSimulator</text><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="1481.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="71.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="1481.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="71.5" y="2089.0703"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="4865.1641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="71.5" y="3960.2266"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="1481.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="473.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="1481.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="473.5" y="2089.0703"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="4865.1641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="473.5" y="3960.2266"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="375.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="446.2422"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="1521.75"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="375.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="2332.5313"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="3408.0391"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="209.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="4143.1563"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="652.8516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="5590.125"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="125.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="8552.9297"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="155.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1459.5" y="1463.4844"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="155.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1459.5" y="3349.7734"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="129.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1459.5" y="5523.8594"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="100.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1459.5" y="8515.7969"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="467.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="517.5078"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="394.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="1127.0938"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="467.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="2403.7969"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="394.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="3013.3828"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="300.5938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="4214.4219"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="407.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="5245.8672"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="552.3203" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="5886.4531"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="946.9766" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="6584.3047"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="297.7266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1975.5" y="8318.4688"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="389.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2323.5" y="6936.8281"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2323.5" y="7531.2813"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="233.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2764.5" y="7560.4141"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3196.5" y="851.0313"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3196.5" y="2737.3203"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3196.5" y="4381.4844"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="166.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3196.5" y="6272.1094"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="204.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3196.5" y="7326.4844"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="175.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3196.5" y="7618.6797"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="575.3203" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3712.5" y="888.1641"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="575.3203" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3712.5" y="2774.4531"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="1105.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3712.5" y="4418.6172"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="598.4531" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3712.5" y="6309.2422"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="984.5156" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3712.5" y="7502.1484"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="105.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="4220.5" y="1021.6953"/><rect fill="#FFFFFF" filter="url(#f12n4llvw00jwz)" height="105.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="4220.5" y="2907.9844"/><rect fill="#EEEEEE" filter="url(#f12n4llvw00jwz)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4602.5" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4602.5" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4602.5" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#f12n4llvw00jwz)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="193" x="2204.75" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="174" x="2210.75" y="131.4497">Request Consent - Web</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="485" x="81" y="153.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="477" x="85" y="169.5825">PISP presents accounts to user. User selects one or more accounts to link.</text><polygon fill="#A80036" points="461.5,198.7813,471.5,202.7813,461.5,206.7813,465.5,202.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="81.5" x2="467.5" y1="202.7813" y2="202.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="88.5" y="197.7153">REQUEST-CONSENT-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="246.5" y="197.7153">POST /linking/request-consent</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="129" style="stroke:#A80036;stroke-width:1.0;" width="570" x="86" y="215.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="90" y="231.8481">POST /linking/request-consent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="90" y="246.981">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="98" y="262.1138">"accounts": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="507" x="106" y="277.2466">{ accountNickname: "XXXXXXnt", id: "dfspa.username.1234", currency: "ZAR" },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="546" x="106" y="292.3794">{ accountNickname: "SpeXXXXXXXXnt", id: "dfspa.username.5678", currency: "USD" }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="98" y="307.5122">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="98" y="322.645">callbackURI: 'pisp-app://callback'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="90" y="337.7778">}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="370.9766" y2="370.9766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="370.9766" y2="383.9766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="383.9766" y2="383.9766"/><polygon fill="#A80036" points="494.5,379.9766,484.5,383.9766,494.5,387.9766,490.5,383.9766" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="490.5" y="365.9106">REQUEST-CONSENT-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="648.5" y="365.9106">const model = await create()</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="79" x="488" y="396.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="492" y="413.0435">state: start</text><polygon fill="#A80036" points="937.5,442.2422,947.5,446.2422,937.5,450.2422,941.5,446.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="943.5" y1="446.2422" y2="446.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="490.5" y="441.1763">REQUEST-CONSENT-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="648.5" y="441.1763">model.requestConsent()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="959.5" x2="1001.5" y1="475.375" y2="475.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001.5" x2="1001.5" y1="475.375" y2="488.375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="960.5" x2="1001.5" y1="488.375" y2="488.375"/><polygon fill="#A80036" points="970.5,484.375,960.5,488.375,970.5,492.375,966.5,488.375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="966.5" y="470.3091">REQUEST-CONSENT-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="1124.5" y="470.3091">ThirdpartyRequests.postConsentRequests()</text><polygon fill="#A80036" points="1963.5,513.5078,1973.5,517.5078,1963.5,521.5078,1967.5,517.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="959.5" x2="1969.5" y1="517.5078" y2="517.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="966.5" y="512.4419">REQUEST-CONSENT-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="1124.5" y="512.4419">POST /consentRequests</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="265" style="stroke:#A80036;stroke-width:1.0;" width="358" x="964" y="530.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="968" y="546.5747">POST /consentRequests</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="968" y="561.7075">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="968" y="576.8403">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="968" y="591.9731">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="976" y="607.106">// consentRequestId will be the uuid created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="976" y="622.2388">// at the PRELINKING-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="976" y="637.3716">consentRequestId: 6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="976" y="652.5044">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="984" y="667.6372">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="984" y="682.77">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="984" y="697.9028">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="984" y="713.0356">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="976" y="728.1685">}],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="976" y="743.3013">// model will add `authChannels`</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="976" y="758.4341">authChannels: ["WEB", "OTP"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="976" y="773.5669">callbackURI: 'pisp-app://callback...'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="968" y="788.6997">}</text><polygon fill="#A80036" points="965.5,817.8984,955.5,821.8984,965.5,825.8984,961.5,821.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="959.5" x2="1974.5" y1="821.8984" y2="821.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="971.5" y="816.8325">REQUEST-CONSENT-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1129.5" y="816.8325">202 Accepted</text><polygon fill="#A80036" points="3184.5,847.0313,3194.5,851.0313,3184.5,855.0313,3188.5,851.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1985.5" x2="3190.5" y1="851.0313" y2="851.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="1992.5" y="845.9653">REQUEST-CONSENT-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="2150.5" y="845.9653">POST /consentRequests</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3253.5" y1="875.1641" y2="875.1641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3253.5" x2="3253.5" y1="875.1641" y2="888.1641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3212.5" x2="3253.5" y1="888.1641" y2="888.1641"/><polygon fill="#A80036" points="3222.5,884.1641,3212.5,888.1641,3222.5,892.1641,3218.5,888.1641" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="3218.5" y="870.0981">REQUEST-CONSENT-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="3376.5" y="870.0981">const model = await create()</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="79" x="3211" y="906.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="3215" y="922.231">state: start</text><polygon fill="#A80036" points="3700.5,951.4297,3710.5,955.4297,3700.5,959.4297,3704.5,955.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3706.5" y1="955.4297" y2="955.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="3213.5" y="950.3638">REQUEST-CONSENT-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="3371.5" y="950.3638">model.requestConsent()</text><polygon fill="#A80036" points="1991.5,980.5625,1981.5,984.5625,1991.5,988.5625,1987.5,984.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="3200.5" y1="984.5625" y2="984.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="1997.5" y="979.4966">REQUEST-CONSENT-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2164.5" y="979.4966">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3769.5" y1="1008.6953" y2="1008.6953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3769.5" x2="3769.5" y1="1008.6953" y2="1021.6953"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3728.5" x2="3769.5" y1="1021.6953" y2="1021.6953"/><polygon fill="#A80036" points="3738.5,1017.6953,3728.5,1021.6953,3738.5,1025.6953,3734.5,1021.6953" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="3734.5" y="1003.6294">REQUEST-CONSENT-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="3901.5" y="1003.6294">DFSPBackendRequests.validateConsentRequest()</text><polygon fill="#A80036" points="4208.5,1051.8281,4218.5,1055.8281,4208.5,1059.8281,4212.5,1055.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="4214.5" y1="1055.8281" y2="1055.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="3729.5" y="1050.7622">REQUEST-CONSENT-12</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="256" x="3896.5" y="1050.7622">POST /store/consentRequests/6789</text><line style="stroke:#A80036;stroke-width:1.0;" x1="4230.5" x2="4272.5" y1="1084.9609" y2="1084.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4272.5" x2="4272.5" y1="1084.9609" y2="1097.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4231.5" x2="4272.5" y1="1097.9609" y2="1097.9609"/><polygon fill="#A80036" points="4241.5,1093.9609,4231.5,1097.9609,4241.5,1101.9609,4237.5,1097.9609" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="4237.5" y="1079.895">REQUEST-CONSENT-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="4404.5" y="1079.895">store consentRequest details</text><polygon fill="#A80036" points="3733.5,1123.0938,3723.5,1127.0938,3733.5,1131.0938,3729.5,1127.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3727.5" x2="4224.5" y1="1127.0938" y2="1127.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="3739.5" y="1122.0278">REQUEST-CONSENT-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="3906.5" y="1122.0278">201 Created</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="280" x="3727" y="1140.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="3731" y="1156.1606">state: consentRequestValidatedAndStored</text><polygon fill="#A80036" points="1996.5,1185.3594,1986.5,1189.3594,1996.5,1193.3594,1992.5,1189.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1990.5" x2="3711.5" y1="1189.3594" y2="1189.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="2002.5" y="1184.2935">REQUEST-CONSENT-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="2169.5" y="1184.2935">PUT /consentRequests/6789</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="234" style="stroke:#A80036;stroke-width:1.0;" width="457" x="3250" y="1202.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="3254" y="1218.4263">PUT /consentRequests/6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="3254" y="1233.5591">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="3254" y="1248.6919">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3254" y="1263.8247">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="3262" y="1278.9575">consentRequestId: 6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="3262" y="1294.0903">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="3270" y="1309.2231">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="3270" y="1324.356">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="3270" y="1339.4888">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="3270" y="1354.6216">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="3262" y="1369.7544">}],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="3262" y="1384.8872">authChannels: ["WEB"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="3262" y="1400.02">callbackURI: 'pisp-app://callback...',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="441" x="3262" y="1415.1528">authURI: 'dfspa.com/authorize?consentRequestId=6789' // this is new</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3254" y="1430.2856">}</text><polygon fill="#A80036" points="3705.5,1459.4844,3715.5,1463.4844,3705.5,1467.4844,3709.5,1463.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="3711.5" y1="1463.4844" y2="1463.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="1992.5" y="1458.4185">REQUEST-CONSENT-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="2159.5" y="1458.4185">202 ACCEPTED</text><polygon fill="#A80036" points="1480.5,1488.6172,1470.5,1492.6172,1480.5,1496.6172,1476.5,1492.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1474.5" x2="1974.5" y1="1492.6172" y2="1492.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="1486.5" y="1487.5513">REQUEST-CONSENT-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="1653.5" y="1487.5513">PUT /consentRequests/6789</text><polygon fill="#A80036" points="1968.5,1517.75,1978.5,1521.75,1968.5,1525.75,1972.5,1521.75" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1469.5" x2="1974.5" y1="1521.75" y2="1521.75"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="1476.5" y="1516.6841">REQUEST-CONSENT-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1643.5" y="1516.6841">200 OK</text><polygon fill="#A80036" points="970.5,1546.8828,960.5,1550.8828,970.5,1554.8828,966.5,1550.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="964.5" x2="1458.5" y1="1550.8828" y2="1550.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="976.5" y="1545.8169">REQUEST-CONSENT-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="1143.5" y="1545.8169">Consent Request response recieved</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="338" x="964" y="1563.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="330" x="968" y="1579.9497">state: webAuthenticationChannelResponseRecieved</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="959.5" x2="1001.5" y1="1618.1484" y2="1618.1484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1001.5" x2="1001.5" y1="1618.1484" y2="1631.1484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="954.5" x2="1001.5" y1="1631.1484" y2="1631.1484"/><polygon fill="#A80036" points="964.5,1627.1484,954.5,1631.1484,964.5,1635.1484,960.5,1631.1484" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="966.5" y="1613.0825">REQUEST-CONSENT-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="1133.5" y="1613.0825">this.saveToKVS()</text><polygon fill="#A80036" points="494.5,1651.2813,484.5,1655.2813,494.5,1659.2813,490.5,1655.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="488.5" x2="953.5" y1="1655.2813" y2="1655.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="500.5" y="1650.2153">REQUEST-CONSENT-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="667.5" y="1650.2153">return Authentication Response</text><polygon fill="#A80036" points="87.5,1680.4141,77.5,1684.4141,87.5,1688.4141,83.5,1684.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="81.5" x2="477.5" y1="1684.4141" y2="1684.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="93.5" y="1679.3481">REQUEST-CONSENT-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="260.5" y="1679.3481">200 OK Autentication Response</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="234" style="stroke:#A80036;stroke-width:1.0;" width="465" x="8" y="1697.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="12" y="1713.481">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="20" y="1728.6138">channelResponse: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="28" y="1743.7466">consentRequestId: 6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="28" y="1758.8794">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="36" y="1774.0122">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="36" y="1789.145">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="36" y="1804.2778">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="36" y="1819.4106">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="28" y="1834.5435">}],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="28" y="1849.6763">authChannels: ["WEB"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="28" y="1864.8091">callbackURI: 'pisp-app://callback...',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="441" x="28" y="1879.9419">authURI: 'dfspa.com/authorize?consentRequestId=6789' // this is new</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="20" y="1895.0747">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="20" y="1910.2075">currentState="OTPAuthenticationChannelResponseRecieved"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="12" y="1925.3403">}</text><path d="M5,1942.4063 L5,1982.4063 L4298,1982.4063 L4298,1952.4063 L4288,1942.4063 L5,1942.4063 " fill="#FBFB77" filter="url(#f12n4llvw00jwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4288,1942.4063 L4288,1952.4063 L4298,1952.4063 L4288,1942.4063 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="784" x="1753" y="1959.4731">The PISP is expected to redirect to the DFSP's `authUri` in their application to let the end user complete the web login flow.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="580" x="1753" y="1974.606">Logging in successfully should provide the PISP with a secret to use in the next linking step.</text><rect fill="#EEEEEE" filter="url(#f12n4llvw00jwz)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4602.5" x="0" y="2012.2383"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4602.5" y1="2012.2383" y2="2012.2383"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4602.5" y1="2015.2383" y2="2015.2383"/><rect fill="#EEEEEE" filter="url(#f12n4llvw00jwz)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="189" x="2206.75" y="2001.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="170" x="2212.75" y="2017.7388">Request Consent - OTP</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="485" x="81" y="2039.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="477" x="85" y="2055.8716">PISP presents accounts to user. User selects one or more accounts to link.</text><polygon fill="#A80036" points="461.5,2085.0703,471.5,2089.0703,461.5,2093.0703,465.5,2089.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="81.5" x2="467.5" y1="2089.0703" y2="2089.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="88.5" y="2084.0044">REQUEST-CONSENT-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="246.5" y="2084.0044">POST /linking/request-consent</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="129" style="stroke:#A80036;stroke-width:1.0;" width="570" x="86" y="2102.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="90" y="2118.1372">POST /linking/request-consent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="90" y="2133.27">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="98" y="2148.4028">"accounts": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="507" x="106" y="2163.5356">{ accountNickname: "XXXXXXnt", id: "dfspa.username.1234", currency: "ZAR" },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="546" x="106" y="2178.6685">{ accountNickname: "SpeXXXXXXXXnt", id: "dfspa.username.5678", currency: "USD" }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="98" y="2193.8013">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="98" y="2208.9341">callbackURI: 'pisp-app://callback'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="90" y="2224.0669">}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="2257.2656" y2="2257.2656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="2257.2656" y2="2270.2656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="2270.2656" y2="2270.2656"/><polygon fill="#A80036" points="494.5,2266.2656,484.5,2270.2656,494.5,2274.2656,490.5,2270.2656" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="490.5" y="2252.1997">REQUEST-CONSENT-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="648.5" y="2252.1997">const model = await create()</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="79" x="488" y="2283.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="492" y="2299.3325">state: start</text><polygon fill="#A80036" points="937.5,2328.5313,947.5,2332.5313,937.5,2336.5313,941.5,2332.5313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="943.5" y1="2332.5313" y2="2332.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="490.5" y="2327.4653">REQUEST-CONSENT-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="648.5" y="2327.4653">model.requestConsent()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="959.5" x2="1001.5" y1="2361.6641" y2="2361.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001.5" x2="1001.5" y1="2361.6641" y2="2374.6641"/><line style="stroke:#A80036;stroke-width:1.0;" x1="960.5" x2="1001.5" y1="2374.6641" y2="2374.6641"/><polygon fill="#A80036" points="970.5,2370.6641,960.5,2374.6641,970.5,2378.6641,966.5,2374.6641" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="966.5" y="2356.5981">REQUEST-CONSENT-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="1124.5" y="2356.5981">ThirdpartyRequests.postConsentRequests()</text><polygon fill="#A80036" points="1963.5,2399.7969,1973.5,2403.7969,1963.5,2407.7969,1967.5,2403.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="959.5" x2="1969.5" y1="2403.7969" y2="2403.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="966.5" y="2398.731">REQUEST-CONSENT-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="1124.5" y="2398.731">POST /consentRequests</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="265" style="stroke:#A80036;stroke-width:1.0;" width="358" x="964" y="2416.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="968" y="2432.8638">POST /consentRequests</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="968" y="2447.9966">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="968" y="2463.1294">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="968" y="2478.2622">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277" x="976" y="2493.395">// consentRequestId will be the uuid created</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="976" y="2508.5278">// at the PRELINKING-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="976" y="2523.6606">consentRequestId: 6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="976" y="2538.7935">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="984" y="2553.9263">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="984" y="2569.0591">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="984" y="2584.1919">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="984" y="2599.3247">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="976" y="2614.4575">}],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="976" y="2629.5903">// model will add `authChannels`</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="976" y="2644.7231">authChannels: ["OTP"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="976" y="2659.856">callbackURI: 'pisp-app://callback...'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="968" y="2674.9888">}</text><polygon fill="#A80036" points="965.5,2704.1875,955.5,2708.1875,965.5,2712.1875,961.5,2708.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="959.5" x2="1974.5" y1="2708.1875" y2="2708.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="971.5" y="2703.1216">REQUEST-CONSENT-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1129.5" y="2703.1216">202 Accepted</text><polygon fill="#A80036" points="3184.5,2733.3203,3194.5,2737.3203,3184.5,2741.3203,3188.5,2737.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1985.5" x2="3190.5" y1="2737.3203" y2="2737.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="1992.5" y="2732.2544">REQUEST-CONSENT-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="2150.5" y="2732.2544">POST /consentRequests</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3253.5" y1="2761.4531" y2="2761.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3253.5" x2="3253.5" y1="2761.4531" y2="2774.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3212.5" x2="3253.5" y1="2774.4531" y2="2774.4531"/><polygon fill="#A80036" points="3222.5,2770.4531,3212.5,2774.4531,3222.5,2778.4531,3218.5,2774.4531" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="3218.5" y="2756.3872">REQUEST-CONSENT-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="3376.5" y="2756.3872">const model = await create()</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="79" x="3211" y="2792.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="3215" y="2808.52">state: start</text><polygon fill="#A80036" points="3700.5,2837.7188,3710.5,2841.7188,3700.5,2845.7188,3704.5,2841.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3706.5" y1="2841.7188" y2="2841.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="3213.5" y="2836.6528">REQUEST-CONSENT-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="3371.5" y="2836.6528">model.requestConsent()</text><polygon fill="#A80036" points="1991.5,2866.8516,1981.5,2870.8516,1991.5,2874.8516,1987.5,2870.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="3200.5" y1="2870.8516" y2="2870.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="1997.5" y="2865.7856">REQUEST-CONSENT-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2164.5" y="2865.7856">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3769.5" y1="2894.9844" y2="2894.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3769.5" x2="3769.5" y1="2894.9844" y2="2907.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3728.5" x2="3769.5" y1="2907.9844" y2="2907.9844"/><polygon fill="#A80036" points="3738.5,2903.9844,3728.5,2907.9844,3738.5,2911.9844,3734.5,2907.9844" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="3734.5" y="2889.9185">REQUEST-CONSENT-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="3901.5" y="2889.9185">DFSPBackendRequests.validateConsentRequest()</text><polygon fill="#A80036" points="4208.5,2938.1172,4218.5,2942.1172,4208.5,2946.1172,4212.5,2942.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="4214.5" y1="2942.1172" y2="2942.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="3729.5" y="2937.0513">REQUEST-CONSENT-12</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacing" textLength="256" x="3896.5" y="2937.0513">POST /store/consentRequests/6789</text><line style="stroke:#A80036;stroke-width:1.0;" x1="4230.5" x2="4272.5" y1="2971.25" y2="2971.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4272.5" x2="4272.5" y1="2971.25" y2="2984.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4231.5" x2="4272.5" y1="2984.25" y2="2984.25"/><polygon fill="#A80036" points="4241.5,2980.25,4231.5,2984.25,4241.5,2988.25,4237.5,2984.25" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="4237.5" y="2966.1841">REQUEST-CONSENT-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="4404.5" y="2966.1841">store consentRequest details</text><polygon fill="#A80036" points="3733.5,3009.3828,3723.5,3013.3828,3733.5,3017.3828,3729.5,3013.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3727.5" x2="4224.5" y1="3013.3828" y2="3013.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="3739.5" y="3008.3169">REQUEST-CONSENT-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="3906.5" y="3008.3169">201 Created</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="280" x="3727" y="3026.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="3731" y="3042.4497">state: consentRequestValidatedAndStored</text><polygon fill="#A80036" points="1996.5,3071.6484,1986.5,3075.6484,1996.5,3079.6484,1992.5,3075.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1990.5" x2="3711.5" y1="3075.6484" y2="3075.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="2002.5" y="3070.5825">REQUEST-CONSENT-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="2169.5" y="3070.5825">PUT /consentRequests/6789</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="234" style="stroke:#A80036;stroke-width:1.0;" width="457" x="3250" y="3088.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="3254" y="3104.7153">PUT /consentRequests/6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="3254" y="3119.8481">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="3254" y="3134.981">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3254" y="3150.1138">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="3262" y="3165.2466">consentRequestId: 6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="3262" y="3180.3794">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="3270" y="3195.5122">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="3270" y="3210.645">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="3270" y="3225.7778">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="3270" y="3240.9106">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="3262" y="3256.0435">}],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="3262" y="3271.1763">authChannels: ["OTP"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="3262" y="3286.3091">callbackURI: 'pisp-app://callback...',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="441" x="3262" y="3301.4419">authURI: 'dfspa.com/authorize?consentRequestId=6789' // this is new</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3254" y="3316.5747">}</text><polygon fill="#A80036" points="3705.5,3345.7734,3715.5,3349.7734,3705.5,3353.7734,3709.5,3349.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="3711.5" y1="3349.7734" y2="3349.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="1992.5" y="3344.7075">REQUEST-CONSENT-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="2159.5" y="3344.7075">202 ACCEPTED</text><polygon fill="#A80036" points="1480.5,3374.9063,1470.5,3378.9063,1480.5,3382.9063,1476.5,3378.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1474.5" x2="1974.5" y1="3378.9063" y2="3378.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="1486.5" y="3373.8403">REQUEST-CONSENT-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="1653.5" y="3373.8403">PUT /consentRequests/6789</text><polygon fill="#A80036" points="1968.5,3404.0391,1978.5,3408.0391,1968.5,3412.0391,1972.5,3408.0391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1469.5" x2="1974.5" y1="3408.0391" y2="3408.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="1476.5" y="3402.9731">REQUEST-CONSENT-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1643.5" y="3402.9731">200 OK</text><polygon fill="#A80036" points="970.5,3433.1719,960.5,3437.1719,970.5,3441.1719,966.5,3437.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="964.5" x2="1458.5" y1="3437.1719" y2="3437.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="976.5" y="3432.106">REQUEST-CONSENT-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230" x="1143.5" y="3432.106">Consent Request response recieved</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="338" x="964" y="3450.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="330" x="968" y="3466.2388">state: OTPAuthenticationChannelResponseRecieved</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="959.5" x2="1001.5" y1="3504.4375" y2="3504.4375"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1001.5" x2="1001.5" y1="3504.4375" y2="3517.4375"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="954.5" x2="1001.5" y1="3517.4375" y2="3517.4375"/><polygon fill="#A80036" points="964.5,3513.4375,954.5,3517.4375,964.5,3521.4375,960.5,3517.4375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="966.5" y="3499.3716">REQUEST-CONSENT-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="1133.5" y="3499.3716">this.saveToKVS()</text><polygon fill="#A80036" points="494.5,3537.5703,484.5,3541.5703,494.5,3545.5703,490.5,3541.5703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="488.5" x2="953.5" y1="3541.5703" y2="3541.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="500.5" y="3536.5044">REQUEST-CONSENT-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="667.5" y="3536.5044">return Authentication Response</text><polygon fill="#A80036" points="87.5,3566.7031,77.5,3570.7031,87.5,3574.7031,83.5,3570.7031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="81.5" x2="477.5" y1="3570.7031" y2="3570.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="163" x="93.5" y="3565.6372">REQUEST-CONSENT-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="260.5" y="3565.6372">200 OK Autentication Response</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="234" style="stroke:#A80036;stroke-width:1.0;" width="465" x="8" y="3583.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="12" y="3599.77">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="20" y="3614.9028">channelResponse: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="28" y="3630.0356">consentRequestId: 6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="28" y="3645.1685">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="36" y="3660.3013">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="36" y="3675.4341">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="36" y="3690.5669">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="36" y="3705.6997">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="28" y="3720.8325">}],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="28" y="3735.9653">authChannels: ["OTP"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="28" y="3751.0981">callbackURI: 'pisp-app://callback...',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="441" x="28" y="3766.231">authURI: 'dfspa.com/authorize?consentRequestId=6789' // this is new</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="12" x="20" y="3781.3638">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="20" y="3796.4966">currentState="OTPAuthenticationChannelResponseRecieved"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="12" y="3811.6294">}</text><path d="M5,3828.6953 L5,3853.6953 L4298,3853.6953 L4298,3838.6953 L4288,3828.6953 L5,3828.6953 " fill="#FBFB77" filter="url(#f12n4llvw00jwz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M4288,3828.6953 L4288,3838.6953 L4298,3838.6953 L4288,3828.6953 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="609" x="1840.5" y="3845.7622">The DFSP is expected to send an OTP to the end user which will be used in the next linking step.</text><rect fill="#EEEEEE" filter="url(#f12n4llvw00jwz)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4602.5" x="0" y="3883.3945"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4602.5" y1="3883.3945" y2="3883.3945"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4602.5" y1="3886.3945" y2="3886.3945"/><rect fill="#EEEEEE" filter="url(#f12n4llvw00jwz)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="397" x="2102.75" y="3872.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="378" x="2108.75" y="3888.895">Authentication+Grant Consent+Register Credential</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="503" x="81" y="3910.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="495" x="85" y="3927.0278">PISP has obtained authToken from end-user(OTP) or through a callback(Web).</text><polygon fill="#A80036" points="461.5,3956.2266,471.5,3960.2266,461.5,3964.2266,465.5,3960.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="81.5" x2="467.5" y1="3960.2266" y2="3960.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="88.5" y="3955.1606">AUTHENTICATION-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="231.5" y="3955.1606">POST /linking/authenticate</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="68" style="stroke:#A80036;stroke-width:1.0;" width="220" x="86" y="3973.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="90" y="3989.2935">PATCH /linking/authenticate/6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="90" y="4004.4263">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="98" y="4019.5591">authToken: '123456'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="90" y="4034.6919">}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="4067.8906" y2="4067.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="4067.8906" y2="4080.8906"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="4080.8906" y2="4080.8906"/><polygon fill="#A80036" points="494.5,4076.8906,484.5,4080.8906,494.5,4084.8906,490.5,4080.8906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="490.5" y="4062.8247">AUTHENTICATION-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="633.5" y="4062.8247">const model = await loadFromKVS({key: 6789})</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="648" x="488" y="4093.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="640" x="492" y="4109.9575">state: webAuthenticationChannelResponseRecieved or OTPAuthenticationChannelResponseRecieved</text><polygon fill="#A80036" points="937.5,4139.1563,947.5,4143.1563,937.5,4147.1563,941.5,4143.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="943.5" y1="4143.1563" y2="4143.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="490.5" y="4138.0903">AUTHENTICATION-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="633.5" y="4138.0903">model.authenticate()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="959.5" x2="1001.5" y1="4172.2891" y2="4172.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001.5" x2="1001.5" y1="4172.2891" y2="4185.2891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="960.5" x2="1001.5" y1="4185.2891" y2="4185.2891"/><polygon fill="#A80036" points="970.5,4181.2891,960.5,4185.2891,970.5,4189.2891,966.5,4185.2891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="966.5" y="4167.2231">AUTHENTICATION-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="1109.5" y="4167.2231">ThirdpartyRequests.patchConsentRequests()</text><polygon fill="#A80036" points="1963.5,4210.4219,1973.5,4214.4219,1963.5,4218.4219,1967.5,4214.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="959.5" x2="1969.5" y1="4214.4219" y2="4214.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="966.5" y="4209.356">AUTHENTICATION-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="1109.5" y="4209.356">PATCH /consentRequests/6789</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="205" x="964" y="4227.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="968" y="4243.4888">PATCH /consentRequests/6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="968" y="4258.6216">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="968" y="4273.7544">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="968" y="4288.8872">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="976" y="4304.02">authToken: '124356'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="968" y="4319.1528">}</text><polygon fill="#A80036" points="965.5,4348.3516,955.5,4352.3516,965.5,4356.3516,961.5,4352.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="959.5" x2="1974.5" y1="4352.3516" y2="4352.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="971.5" y="4347.2856">AUTHENTICATION-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1114.5" y="4347.2856">202 Accepted</text><polygon fill="#A80036" points="3184.5,4377.4844,3194.5,4381.4844,3184.5,4385.4844,3188.5,4381.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1985.5" x2="3190.5" y1="4381.4844" y2="4381.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="1992.5" y="4376.4185">AUTHENTICATION-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="2135.5" y="4376.4185">PATCH /consentRequests/6789</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3253.5" y1="4405.6172" y2="4405.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3253.5" x2="3253.5" y1="4405.6172" y2="4418.6172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3212.5" x2="3253.5" y1="4418.6172" y2="4418.6172"/><polygon fill="#A80036" points="3222.5,4414.6172,3212.5,4418.6172,3222.5,4422.6172,3218.5,4418.6172" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="3218.5" y="4400.5513">AUTHENTICATION-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="3361.5" y="4400.5513">const model = await loadFromKVS({key: 6789})</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="280" x="3211" y="4436.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="3215" y="4452.6841">state: consentRequestValidatedAndStored</text><polygon fill="#A80036" points="3700.5,4481.8828,3710.5,4485.8828,3700.5,4489.8828,3704.5,4485.8828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3706.5" y1="4485.8828" y2="4485.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="3213.5" y="4480.8169">AUTHENTICATION-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="3356.5" y="4480.8169">model.validateAuthToken()</text><polygon fill="#A80036" points="1991.5,4511.0156,1981.5,4515.0156,1991.5,4519.0156,1987.5,4515.0156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="3200.5" y1="4515.0156" y2="4515.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1997.5" y="4509.9497">AUTHENTICATION-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2149.5" y="4509.9497">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3764.5" y1="4544.1484" y2="4544.1484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3764.5" x2="3764.5" y1="4544.1484" y2="4557.1484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3723.5" x2="3764.5" y1="4557.1484" y2="4557.1484"/><polygon fill="#A80036" points="3733.5,4553.1484,3723.5,4557.1484,3733.5,4561.1484,3729.5,4557.1484" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3729.5" y="4539.0825">AUTHENTICATION-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="3881.5" y="4539.0825">DFSPBackendRequests.validateAuthToken()</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="144" style="stroke:#A80036;stroke-width:1.0;" width="416" x="3727" y="4570.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="3731" y="4586.2153">Do we need two backend endpoints for validating</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="408" x="3731" y="4601.3481">web authTokens and OTP authTokens? Or is a DFSP expected to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="3731" y="4616.481">validate both cases with one endpoint?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="3735" y="4631.6138"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="3731" y="4646.7466">POST /validateAuthToken</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3731" y="4661.8794">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="3739" y="4677.0122">consentRequestId: '6789'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="3739" y="4692.145">authToken: '124356'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3731" y="4707.2778">}</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="176" x="3727" y="4724.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="3731" y="4740.4106">state: authTokenValidated</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3764.5" y1="4773.6094" y2="4773.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3764.5" x2="3764.5" y1="4773.6094" y2="4786.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3723.5" x2="3764.5" y1="4786.6094" y2="4786.6094"/><polygon fill="#A80036" points="3733.5,4782.6094,3723.5,4786.6094,3733.5,4790.6094,3729.5,4786.6094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3729.5" y="4768.5435">AUTHENTICATION-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="3881.5" y="4768.5435">model.getScopes()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3764.5" y1="4815.7422" y2="4815.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3764.5" x2="3764.5" y1="4815.7422" y2="4828.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3723.5" x2="3764.5" y1="4828.7422" y2="4828.7422"/><polygon fill="#A80036" points="3733.5,4824.7422,3723.5,4828.7422,3733.5,4832.7422,3729.5,4828.7422" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3729.5" y="4810.6763">AUTHENTICATION-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76" x="3881.5" y="4810.6763">Get scopes.</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="433" x="3727" y="4841.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="3731" y="4857.8091">Do we need to get scopes from</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="3731" y="4872.9419">- DFSPAuthorizeSimulator?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="3731" y="4888.0747">- Using DFSPBackendRequests?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="425" x="3731" y="4903.2075">- Can't we store the consentRequest in the Consent Request stage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="381" x="3739" y="4918.3403">in the model data and pull it from there instead of having to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="3739" y="4933.4731">make a request?</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="154" x="3727" y="4950.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="3731" y="4966.606">state: scopesRetrieved</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3764.5" y1="4999.8047" y2="4999.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3764.5" x2="3764.5" y1="4999.8047" y2="5012.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3723.5" x2="3764.5" y1="5012.8047" y2="5012.8047"/><polygon fill="#A80036" points="3733.5,5008.8047,3723.5,5012.8047,3733.5,5016.8047,3729.5,5012.8047" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3729.5" y="4994.7388">AUTHENTICATION-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="3881.5" y="4994.7388">const consentId = uuid()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3764.5" y1="5041.9375" y2="5041.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3764.5" x2="3764.5" y1="5041.9375" y2="5054.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3723.5" x2="3764.5" y1="5054.9375" y2="5054.9375"/><polygon fill="#A80036" points="3733.5,5050.9375,3723.5,5054.9375,3733.5,5058.9375,3729.5,5054.9375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3729.5" y="5036.8716">AUTHENTICATION-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="3881.5" y="5036.8716">model.grantConsent()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3764.5" y1="5084.0703" y2="5084.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3764.5" x2="3764.5" y1="5084.0703" y2="5097.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3723.5" x2="3764.5" y1="5097.0703" y2="5097.0703"/><polygon fill="#A80036" points="3733.5,5093.0703,3723.5,5097.0703,3733.5,5101.0703,3729.5,5097.0703" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3729.5" y="5079.0044">AUTHENTICATION-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="3881.5" y="5079.0044">ThirdpartyRequests.postConsents()</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="152" x="3727" y="5110.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="3731" y="5126.1372">state: consentGranted</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="68" style="stroke:#A80036;stroke-width:1.0;" width="495" x="3727" y="5143.2031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="484" x="3731" y="5159.27">It's important to save the model with the consentId from this point onwards!</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="458" x="3731" y="5174.4028">Requests will not contain a consentRequestId in the upcoming requests.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="487" x="3731" y="5189.5356">This may require changing `PersistentModel` to have a secondary key it can</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="3731" y="5204.6685">store the model with.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3769.5" y1="5232.8672" y2="5232.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3769.5" x2="3769.5" y1="5232.8672" y2="5245.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3728.5" x2="3769.5" y1="5245.8672" y2="5245.8672"/><polygon fill="#A80036" points="3738.5,5241.8672,3728.5,5245.8672,3738.5,5249.8672,3734.5,5245.8672" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3734.5" y="5227.8013">AUTHENTICATION-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="3886.5" y="5227.8013">this.saveToKVS({key: '1a2b3c4d'})</text><polygon fill="#A80036" points="1996.5,5276,1986.5,5280,1996.5,5284,1992.5,5280" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1990.5" x2="3711.5" y1="5280" y2="5280"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2002.5" y="5274.9341">AUTHENTICATION-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="2154.5" y="5274.9341">POST /consents</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="204" style="stroke:#A80036;stroke-width:1.0;" width="358" x="3349" y="5293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="3353" y="5309.0669">POST /consents</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="3353" y="5324.1997">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="3353" y="5339.3325">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3353" y="5354.4653">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="3361" y="5369.5981">consentId: 1a2b3c4d</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="3361" y="5384.731">consentRequestId: 6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="3361" y="5399.8638">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="3369" y="5414.9966">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="3369" y="5430.1294">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="3369" y="5445.2622">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="3369" y="5460.395">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="13" x="3361" y="5475.5278">}]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3353" y="5490.6606">}</text><polygon fill="#A80036" points="3705.5,5519.8594,3715.5,5523.8594,3705.5,5527.8594,3709.5,5523.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="3711.5" y1="5523.8594" y2="5523.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1992.5" y="5518.7935">AUTHENTICATION-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="2144.5" y="5518.7935">202 ACCEPTED</text><polygon fill="#A80036" points="1480.5,5548.9922,1470.5,5552.9922,1480.5,5556.9922,1476.5,5552.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1474.5" x2="1974.5" y1="5552.9922" y2="5552.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1486.5" y="5547.9263">AUTHENTICATION-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="1638.5" y="5547.9263">POST /consents</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1469.5" x2="1516.5" y1="5577.125" y2="5577.125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1516.5" x2="1516.5" y1="5577.125" y2="5590.125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1475.5" x2="1516.5" y1="5590.125" y2="5590.125"/><polygon fill="#A80036" points="1485.5,5586.125,1475.5,5590.125,1485.5,5594.125,1481.5,5590.125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1481.5" y="5572.0591">AUTHENTICATION-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="1633.5" y="5572.0591">const model = await loadFromKVS({key: 6789})</text><polygon fill="#A80036" points="970.5,5620.2578,960.5,5624.2578,970.5,5628.2578,966.5,5624.2578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="964.5" x2="1458.5" y1="5624.2578" y2="5624.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="976.5" y="5619.1919">AUTHENTICATION-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="1128.5" y="5619.1919">model.registerCredential()</text><polygon fill="#A80036" points="1968.5,5649.3906,1978.5,5653.3906,1968.5,5657.3906,1972.5,5653.3906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1464.5" x2="1974.5" y1="5653.3906" y2="5653.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1471.5" y="5648.3247">AUTHENTICATION-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1623.5" y="5648.3247">202 Accepted</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="157" x="964" y="5666.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="968" y="5682.4575">state: consentRecieved</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="68" style="stroke:#A80036;stroke-width:1.0;" width="495" x="964" y="5699.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="484" x="968" y="5715.5903">It's important to save the model with the consentId from this point onwards!</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="458" x="968" y="5730.7231">Requests will not contain a consentRequestId in the upcoming requests.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="487" x="968" y="5745.856">This may require changing `PersistentModel` to have a secondary key it can</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="968" y="5760.9888">store the model with.</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="959.5" x2="1001.5" y1="5794.1875" y2="5794.1875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1001.5" x2="1001.5" y1="5794.1875" y2="5807.1875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="960.5" x2="1001.5" y1="5807.1875" y2="5807.1875"/><polygon fill="#A80036" points="970.5,5803.1875,960.5,5807.1875,970.5,5811.1875,966.5,5807.1875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="966.5" y="5789.1216">AUTHENTICATION-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="1118.5" y="5789.1216">const challenge = deriveChallenge(consentRequest)</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="959.5" x2="1001.5" y1="5836.3203" y2="5836.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1001.5" x2="1001.5" y1="5836.3203" y2="5849.3203"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="960.5" x2="1001.5" y1="5849.3203" y2="5849.3203"/><polygon fill="#A80036" points="970.5,5845.3203,960.5,5849.3203,970.5,5853.3203,966.5,5849.3203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="966.5" y="5831.2544">AUTHENTICATION-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="1118.5" y="5831.2544">this.saveToKVS({key: '1a2b3c4d'})</text><line style="stroke:#A80036;stroke-width:1.0;" x1="959.5" x2="1006.5" y1="5873.4531" y2="5873.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1006.5" x2="1006.5" y1="5873.4531" y2="5886.4531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="965.5" x2="1006.5" y1="5886.4531" y2="5886.4531"/><polygon fill="#A80036" points="975.5,5882.4531,965.5,5886.4531,975.5,5890.4531,971.5,5886.4531" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="971.5" y="5868.3872">AUTHENTICATION-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="1123.5" y="5868.3872">ThirdpartyRequests.putConsents()</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="174" x="964" y="5904.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="968" y="5920.52">state: signedConsentSent</text><polygon fill="#A80036" points="1963.5,5949.7188,1973.5,5953.7188,1963.5,5957.7188,1967.5,5953.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="959.5" x2="1969.5" y1="5953.7188" y2="5953.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="966.5" y="5948.6528">AUTHENTICATION-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="1118.5" y="5948.6528">PUT /consents/1a2b3c4d</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="250" style="stroke:#A80036;stroke-width:1.0;" width="358" x="964" y="5966.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="968" y="5982.7856">PUT /consents/1a2b3c4d</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="968" y="5997.9185">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="968" y="6013.0513">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="968" y="6028.1841">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="976" y="6043.3169">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="984" y="6058.4497">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="984" y="6073.5825">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="984" y="6088.7153">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="984" y="6103.8481">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="976" y="6118.981">}],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="976" y="6134.1138">credential: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="984" y="6149.2466">credentialType: "FIDO",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="984" y="6164.3794">status: "PENDING",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="984" y="6179.5122">payload: PublicKeyCredential</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="976" y="6194.645">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="968" y="6209.7778">}</text><polygon fill="#A80036" points="965.5,6238.9766,955.5,6242.9766,965.5,6246.9766,961.5,6242.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="959.5" x2="1974.5" y1="6242.9766" y2="6242.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="971.5" y="6237.9106">AUTHENTICATION-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1123.5" y="6237.9106">202 Accepted</text><polygon fill="#A80036" points="3184.5,6268.1094,3194.5,6272.1094,3184.5,6276.1094,3188.5,6272.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1985.5" x2="3190.5" y1="6272.1094" y2="6272.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1992.5" y="6267.0435">AUTHENTICATION-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="2144.5" y="6267.0435">PUT /consents/1a2b3c4d</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3253.5" y1="6296.2422" y2="6296.2422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3253.5" x2="3253.5" y1="6296.2422" y2="6309.2422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3212.5" x2="3253.5" y1="6309.2422" y2="6309.2422"/><polygon fill="#A80036" points="3222.5,6305.2422,3212.5,6309.2422,3222.5,6313.2422,3218.5,6309.2422" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3218.5" y="6291.1763">AUTHENTICATION-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="3370.5" y="6291.1763">const model = await loadFromKVS({key: 1a2b3c4d})</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="201" x="3211" y="6327.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="3215" y="6343.3091">state: signedConsentRecieved</text><polygon fill="#A80036" points="3700.5,6372.5078,3710.5,6376.5078,3700.5,6380.5078,3704.5,6376.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3706.5" y1="6376.5078" y2="6376.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3213.5" y="6371.4419">AUTHENTICATION-31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="3365.5" y="6371.4419">model.validateSignedConsent()</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="264" x="3211" y="6389.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="3215" y="6405.5747">state: pendingRegistrationAndValidation</text><polygon fill="#A80036" points="1991.5,6434.7734,1981.5,6438.7734,1991.5,6442.7734,1987.5,6438.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="3200.5" y1="6438.7734" y2="6438.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1997.5" y="6433.7075">AUTHENTICATION-32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2149.5" y="6433.7075">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3764.5" y1="6467.9063" y2="6467.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3764.5" x2="3764.5" y1="6467.9063" y2="6480.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3723.5" x2="3764.5" y1="6480.9063" y2="6480.9063"/><polygon fill="#A80036" points="3733.5,6476.9063,3723.5,6480.9063,3733.5,6484.9063,3729.5,6480.9063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3729.5" y="6462.8403">AUTHENTICATION-33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="3881.5" y="6462.8403">Check signed consent.</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="530" x="3727" y="6493.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="522" x="3731" y="6509.9731">Does this need a backend request or can the scheme adapter check the consent.</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="199" x="3727" y="6527.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="3731" y="6543.106">state: signedConsentChecked</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3769.5" y1="6571.3047" y2="6571.3047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3769.5" x2="3769.5" y1="6571.3047" y2="6584.3047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3728.5" x2="3769.5" y1="6584.3047" y2="6584.3047"/><polygon fill="#A80036" points="3738.5,6580.3047,3728.5,6584.3047,3738.5,6588.3047,3734.5,6584.3047" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3734.5" y="6566.2388">AUTHENTICATION-34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="3886.5" y="6566.2388">model.validateWithAuthService()</text><polygon fill="#A80036" points="1996.5,6614.4375,1986.5,6618.4375,1996.5,6622.4375,1992.5,6618.4375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1990.5" x2="3711.5" y1="6618.4375" y2="6618.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2002.5" y="6613.3716">AUTHENTICATION-35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="2154.5" y="6613.3716">POST /consents/1a2b3c4d</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="250" style="stroke:#A80036;stroke-width:1.0;" width="358" x="3349" y="6631.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="3353" y="6647.5044">POST /consents/1a2b3c4d</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="3353" y="6662.6372">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="3353" y="6677.77">FSIOP-Destination: central-auth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3353" y="6692.9028">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="3361" y="6708.0356">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="3369" y="6723.1685">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="3369" y="6738.3013">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="3369" y="6753.4341">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="3369" y="6768.5669">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="3361" y="6783.6997">}],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="3361" y="6798.8325">credential: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="3369" y="6813.9653">credentialType: "FIDO",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="3369" y="6829.0981">status: "PENDING",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="3369" y="6844.231">payload: PublicKeyCredential</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3361" y="6859.3638">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3353" y="6874.4966">}</text><polygon fill="#A80036" points="3705.5,6903.6953,3715.5,6907.6953,3705.5,6911.6953,3709.5,6907.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="3711.5" y1="6907.6953" y2="6907.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1992.5" y="6902.6294">AUTHENTICATION-36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2144.5" y="6902.6294">202 Accepted</text><polygon fill="#A80036" points="2311.5,6932.8281,2321.5,6936.8281,2311.5,6940.8281,2315.5,6936.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1985.5" x2="2317.5" y1="6936.8281" y2="6936.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1992.5" y="6931.7622">AUTHENTICATION-37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="2144.5" y="6931.7622">POST /consents/1a2b3c4d</text><polygon fill="#A80036" points="1996.5,6961.9609,1986.5,6965.9609,1996.5,6969.9609,1992.5,6965.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1990.5" x2="2322.5" y1="6965.9609" y2="6965.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2002.5" y="6960.895">AUTHENTICATION-38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2154.5" y="6960.895">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2333.5" x2="2375.5" y1="6995.0938" y2="6995.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2375.5" x2="2375.5" y1="6995.0938" y2="7008.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2334.5" x2="2375.5" y1="7008.0938" y2="7008.0938"/><polygon fill="#A80036" points="2344.5,7004.0938,2334.5,7008.0938,2344.5,7012.0938,2340.5,7008.0938" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2340.5" y="6990.0278">AUTHENTICATION-39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="2492.5" y="6990.0278">Check consent.</text><polygon fill="#A80036" points="1996.5,7033.2266,1986.5,7037.2266,1996.5,7041.2266,1992.5,7037.2266" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1990.5" x2="2322.5" y1="7037.2266" y2="7037.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2002.5" y="7032.1606">AUTHENTICATION-40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="2154.5" y="7032.1606">PUT /consents/1a2b3c4d</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="250" style="stroke:#A80036;stroke-width:1.0;" width="358" x="1960" y="7050.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="1964" y="7066.2935">PUT /consents/1a2b3c4d</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="1964" y="7081.4263">FSIOP-Source: central-auth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="1964" y="7096.5591">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1964" y="7111.6919">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="1972" y="7126.8247">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="1980" y="7141.9575">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="1980" y="7157.0903">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="1980" y="7172.2231">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="1980" y="7187.356">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="1972" y="7202.4888">}],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="1972" y="7217.6216">credential: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="1980" y="7232.7544">credentialType: "FIDO",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="1980" y="7247.8872">status: "VERIFIED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="1980" y="7263.02">payload: PublicKeyCredential</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1972" y="7278.1528">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1964" y="7293.2856">}</text><polygon fill="#A80036" points="2316.5,7322.4844,2326.5,7326.4844,2316.5,7330.4844,2320.5,7326.4844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="2322.5" y1="7326.4844" y2="7326.4844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1992.5" y="7321.4185">AUTHENTICATION-41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2144.5" y="7321.4185">200 OK</text><polygon fill="#A80036" points="3184.5,7351.6172,3194.5,7355.6172,3184.5,7359.6172,3188.5,7355.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1985.5" x2="3190.5" y1="7355.6172" y2="7355.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1992.5" y="7350.5513">AUTHENTICATION-42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="2144.5" y="7350.5513">PUT /consents/1a2b3c4d</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3248.5" y1="7384.75" y2="7384.75"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3248.5" x2="3248.5" y1="7384.75" y2="7397.75"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3207.5" x2="3248.5" y1="7397.75" y2="7397.75"/><polygon fill="#A80036" points="3217.5,7393.75,3207.5,7397.75,3217.5,7401.75,3213.5,7397.75" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3213.5" y="7379.6841">AUTHENTICATION-43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="3365.5" y="7379.6841">const model = await loadFromKVS({key: 1a2b3c4d})</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3248.5" y1="7426.8828" y2="7426.8828"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3248.5" x2="3248.5" y1="7426.8828" y2="7439.8828"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3207.5" x2="3248.5" y1="7439.8828" y2="7439.8828"/><polygon fill="#A80036" points="3217.5,7435.8828,3207.5,7439.8828,3217.5,7443.8828,3213.5,7439.8828" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3213.5" y="7421.8169">AUTHENTICATION-44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="3365.5" y="7421.8169">consentResponseRecieved()</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="219" x="3211" y="7452.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="3215" y="7468.9497">state: consentResponseRecieved</text><polygon fill="#A80036" points="3700.5,7498.1484,3710.5,7502.1484,3700.5,7506.1484,3704.5,7502.1484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3706.5" y1="7502.1484" y2="7502.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3213.5" y="7497.0825">AUTHENTICATION-45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="3365.5" y="7497.0825">Auth Service response recieved</text><polygon fill="#A80036" points="1991.5,7527.2813,1981.5,7531.2813,1991.5,7535.2813,1987.5,7531.2813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="3200.5" y1="7531.2813" y2="7531.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1997.5" y="7526.2153">AUTHENTICATION-46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2149.5" y="7526.2153">200 OK</text><polygon fill="#A80036" points="2752.5,7556.4141,2762.5,7560.4141,2752.5,7564.4141,2756.5,7560.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2333.5" x2="2758.5" y1="7560.4141" y2="7560.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2340.5" y="7555.3481">AUTHENTICATION-47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="2492.5" y="7555.3481">POST /participants/CONSENTS/1a2b3c4d</text><polygon fill="#A80036" points="2339.5,7585.5469,2329.5,7589.5469,2339.5,7593.5469,2335.5,7589.5469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2333.5" x2="2763.5" y1="7589.5469" y2="7589.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2345.5" y="7584.481">AUTHENTICATION-48</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2497.5" y="7584.481">202 Accepted</text><polygon fill="#A80036" points="3184.5,7614.6797,3194.5,7618.6797,3184.5,7622.6797,3188.5,7618.6797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2774.5" x2="3190.5" y1="7618.6797" y2="7618.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2781.5" y="7613.6138">AUTHENTICATION-49</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="2933.5" y="7613.6138">PUT /participants/CONSENTS/1a2b3c4d</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3248.5" y1="7647.8125" y2="7647.8125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3248.5" x2="3248.5" y1="7647.8125" y2="7660.8125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3207.5" x2="3248.5" y1="7660.8125" y2="7660.8125"/><polygon fill="#A80036" points="3217.5,7656.8125,3207.5,7660.8125,3217.5,7664.8125,3213.5,7660.8125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3213.5" y="7642.7466">AUTHENTICATION-50</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="3365.5" y="7642.7466">const model = await loadFromKVS({key: 1a2b3c4d})</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3248.5" y1="7689.9453" y2="7689.9453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3248.5" x2="3248.5" y1="7689.9453" y2="7702.9453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3207.5" x2="3248.5" y1="7702.9453" y2="7702.9453"/><polygon fill="#A80036" points="3217.5,7698.9453,3207.5,7702.9453,3217.5,7706.9453,3213.5,7702.9453" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3213.5" y="7684.8794">AUTHENTICATION-51</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="3365.5" y="7684.8794">participantResponseRecieved()</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="243" x="3211" y="7715.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="3215" y="7732.0122">state: participantsResponseRecieved</text><polygon fill="#A80036" points="3700.5,7761.2109,3710.5,7765.2109,3700.5,7769.2109,3704.5,7765.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3206.5" x2="3706.5" y1="7765.2109" y2="7765.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3213.5" y="7760.145">AUTHENTICATION-52</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="3365.5" y="7760.145">Participant response recieved</text><polygon fill="#A80036" points="2780.5,7790.3438,2770.5,7794.3438,2780.5,7798.3438,2776.5,7794.3438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2774.5" x2="3200.5" y1="7794.3438" y2="7794.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2786.5" y="7789.2778">AUTHENTICATION-53</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2938.5" y="7789.2778">200 Accepted</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="253" x="3727" y="7807.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="3731" y="7823.4106">state: consentRegisteredAndValidated</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3764.5" y1="7856.6094" y2="7856.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3764.5" x2="3764.5" y1="7856.6094" y2="7869.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3723.5" x2="3764.5" y1="7869.6094" y2="7869.6094"/><polygon fill="#A80036" points="3733.5,7865.6094,3723.5,7869.6094,3733.5,7873.6094,3729.5,7869.6094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3729.5" y="7851.5435">AUTHENTICATION-54</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="3881.5" y="7851.5435">model.finalizeConsent()</text><path d="M1939,7884.6094 L2016,7884.6094 L2016,7891.6094 L2006,7901.6094 L1939,7901.6094 L1939,7884.6094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="279.3281" style="stroke:#000000;stroke-width:2.0;" width="1861" x="1939" y="7884.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="1954" y="7897.6763">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="116" x="2031" y="7896.8198">[for each scope in</text><text fill="#000000" font-family="monospace" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="105" x="2151" y="7896.8198">Consents.scopes</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="2256" y="7896.8198">]</text><polygon fill="#A80036" points="1991.5,7918.875,1981.5,7922.875,1991.5,7926.875,1987.5,7922.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1985.5" x2="3711.5" y1="7922.875" y2="7922.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1997.5" y="7917.8091">AUTHENTICATION-55</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="376" x="2149.5" y="7917.8091">POST /participants/THIRD_PARTY_LINK/dfsp.username.5678</text><polygon fill="#A80036" points="3700.5,7948.0078,3710.5,7952.0078,3700.5,7956.0078,3704.5,7952.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1980.5" x2="3706.5" y1="7952.0078" y2="7952.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1987.5" y="7946.9419">AUTHENTICATION-56</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2139.5" y="7946.9419">202 Accepted</text><polygon fill="#A80036" points="2757.5,7977.1406,2767.5,7981.1406,2757.5,7985.1406,2761.5,7981.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1980.5" x2="2763.5" y1="7981.1406" y2="7981.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1987.5" y="7976.0747">AUTHENTICATION-57</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="376" x="2139.5" y="7976.0747">POST /participants/THIRD_PARTY_LINK/dfsp.username.5678</text><polygon fill="#A80036" points="1991.5,8006.2734,1981.5,8010.2734,1991.5,8014.2734,1987.5,8010.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="2768.5" y1="8010.2734" y2="8010.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1997.5" y="8005.2075">AUTHENTICATION-58</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2149.5" y="8005.2075">202 Accepted</text><polygon fill="#A80036" points="1991.5,8035.4063,1981.5,8039.4063,1991.5,8043.4063,1987.5,8039.4063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1985.5" x2="2768.5" y1="8039.4063" y2="8039.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1997.5" y="8034.3403">AUTHENTICATION-59</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="367" x="2149.5" y="8034.3403">PUT /participants/THIRD_PARTY_LINK/dfsp.username.5678</text><polygon fill="#A80036" points="2757.5,8064.5391,2767.5,8068.5391,2757.5,8072.5391,2761.5,8068.5391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1980.5" x2="2763.5" y1="8068.5391" y2="8068.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1987.5" y="8063.4731">AUTHENTICATION-60</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2139.5" y="8063.4731">200 OK</text><polygon fill="#A80036" points="3189.5,8093.6719,3199.5,8097.6719,3189.5,8101.6719,3193.5,8097.6719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1980.5" x2="3195.5" y1="8097.6719" y2="8097.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1987.5" y="8092.606">AUTHENTICATION-61</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="367" x="2139.5" y="8092.606">PUT /participants/THIRD_PARTY_LINK/dfsp.username.5678</text><polygon fill="#A80036" points="1991.5,8122.8047,1981.5,8126.8047,1991.5,8130.8047,1987.5,8126.8047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="3200.5" y1="8126.8047" y2="8126.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1997.5" y="8121.7388">AUTHENTICATION-62</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2149.5" y="8121.7388">200 OK</text><polygon fill="#A80036" points="3700.5,8151.9375,3710.5,8155.9375,3700.5,8159.9375,3704.5,8155.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3201.5" x2="3706.5" y1="8155.9375" y2="8155.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3208.5" y="8150.8716">AUTHENTICATION-63</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="3360.5" y="8150.8716">Participant response recieved</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3764.5" y1="8192.0703" y2="8192.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3764.5" x2="3764.5" y1="8192.0703" y2="8205.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3723.5" x2="3764.5" y1="8205.0703" y2="8205.0703"/><polygon fill="#A80036" points="3733.5,8201.0703,3723.5,8205.0703,3733.5,8209.0703,3729.5,8205.0703" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3729.5" y="8187.0044">AUTHENTICATION-64</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="3881.5" y="8187.0044">await Promise.all()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3764.5" y1="8234.2031" y2="8234.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3764.5" x2="3764.5" y1="8234.2031" y2="8247.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3723.5" x2="3764.5" y1="8247.2031" y2="8247.2031"/><polygon fill="#A80036" points="3733.5,8243.2031,3723.5,8247.2031,3733.5,8251.2031,3729.5,8247.2031" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3729.5" y="8229.1372">AUTHENTICATION-65</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="3881.5" y="8229.1372">state: PISPDFSPLinkEstablished</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3722.5" x2="3764.5" y1="8276.3359" y2="8276.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3764.5" x2="3764.5" y1="8276.3359" y2="8289.3359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3723.5" x2="3764.5" y1="8289.3359" y2="8289.3359"/><polygon fill="#A80036" points="3733.5,8285.3359,3723.5,8289.3359,3733.5,8293.3359,3729.5,8289.3359" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3729.5" y="8271.27">AUTHENTICATION-66</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="3881.5" y="8271.27">model.notifyVerificationToPISP()</text><polygon fill="#A80036" points="1996.5,8314.4688,1986.5,8318.4688,1996.5,8322.4688,1992.5,8318.4688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1990.5" x2="3711.5" y1="8318.4688" y2="8318.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2002.5" y="8313.4028">AUTHENTICATION-67</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="2154.5" y="8313.4028">PATCH /consents/1a2b3c4d</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="129" style="stroke:#A80036;stroke-width:1.0;" width="184" x="3523" y="8331.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="3527" y="8347.5356">PATCH /consents/1a2b3c4d</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="3527" y="8362.6685">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="3527" y="8377.8013">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3527" y="8392.9341">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="3535" y="8408.0669">credential: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="3543" y="8423.1997">status: "VERIFIED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3535" y="8438.3325">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3527" y="8453.4653">}</text><polygon fill="#A80036" points="3705.5,8482.6641,3715.5,8486.6641,3705.5,8490.6641,3709.5,8486.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1985.5" x2="3711.5" y1="8486.6641" y2="8486.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1992.5" y="8481.5981">AUTHENTICATION-68</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2144.5" y="8481.5981">200 OK</text><polygon fill="#A80036" points="1480.5,8511.7969,1470.5,8515.7969,1480.5,8519.7969,1476.5,8515.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1474.5" x2="1974.5" y1="8515.7969" y2="8515.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1486.5" y="8510.731">AUTHENTICATION-69</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="1638.5" y="8510.731">PATCH /consents/1a2b3c4d</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1469.5" x2="1516.5" y1="8539.9297" y2="8539.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1516.5" x2="1516.5" y1="8539.9297" y2="8552.9297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1475.5" x2="1516.5" y1="8552.9297" y2="8552.9297"/><polygon fill="#A80036" points="1485.5,8548.9297,1475.5,8552.9297,1485.5,8556.9297,1481.5,8552.9297" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1481.5" y="8534.8638">AUTHENTICATION-70</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="1633.5" y="8534.8638">const model = await loadFromKVS({key: 1a2b3c4d})</text><polygon fill="#A80036" points="970.5,8583.0625,960.5,8587.0625,970.5,8591.0625,966.5,8587.0625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="964.5" x2="1458.5" y1="8587.0625" y2="8587.0625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="976.5" y="8581.9966">AUTHENTICATION-71</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="1128.5" y="8581.9966">Verified Response recieved</text><polygon fill="#A80036" points="1968.5,8612.1953,1978.5,8616.1953,1968.5,8620.1953,1972.5,8616.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1464.5" x2="1974.5" y1="8616.1953" y2="8616.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1471.5" y="8611.1294">AUTHENTICATION-72</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1623.5" y="8611.1294">200 OK</text><rect fill="#FBFB77" filter="url(#f12n4llvw00jwz)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="148" x="964" y="8629.1953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="968" y="8645.2622">state: accountsLinked</text><polygon fill="#A80036" points="494.5,8674.4609,484.5,8678.4609,494.5,8682.4609,490.5,8678.4609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="488.5" x2="953.5" y1="8678.4609" y2="8678.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="500.5" y="8673.395">AUTHENTICATION-73</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="652.5" y="8673.395">return Accounts linked response</text><polygon fill="#A80036" points="92.5,8703.5938,82.5,8707.5938,92.5,8711.5938,88.5,8707.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="86.5" x2="472.5" y1="8707.5938" y2="8707.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="98.5" y="8702.5278">AUTHENTICATION-74</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="250.5" y="8702.5278">200 OK Accounts Linked</text><rect fill="#ADD8E6" filter="url(#f12n4llvw00jwz)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="217" x="251" y="8720.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="255" y="8736.6606">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="263" y="8751.7935">credential: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="271" y="8766.9263">status: "VERIFIED"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="263" y="8782.0591">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="263" y="8797.1919">currentState="accountsLinked"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="255" y="8812.3247">}</text><!--MD5=[27eb6362fdc77363a0e2a08935cb6702]
@startuml

title PISP Linking

participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPLinkingModel" as PISP_LM
  participant "inbound-server" as PISP_TP_IN
end box
box "Mojaloop"
    participant Switch
    participant "Auth Service" as AUTH
    participant "Account Lookup Service" as ALS
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPLinkingModel" as DFSP_LM
end box
participant DFSPAuthorizeSimulator

== Request Consent - Web ==
autonumber 1 "<b>REQUEST-CONSENT-#</b>"
rnote right of PISP
PISP presents accounts to user. User selects one or more accounts to link.
end note
PISP -> PISP_TP_OUT: POST /linking/request-consent
rnote right of PISP #LightBlue
POST /linking/request-consent
{
  "accounts": [
    { accountNickname: "XXXXXXnt", id: "dfspa.username.1234", currency: "ZAR" },
    { accountNickname: "SpeXXXXXXXXnt", id: "dfspa.username.5678", currency: "USD" }
  ],
  callbackURI: 'pisp-app://callback'
}
end note


activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await create()
rnote right of PISP_TP_OUT: state: start
PISP_TP_OUT -> PISP_LM: model.requestConsent()

activate PISP_LM

PISP_LM -> PISP_LM: ThirdpartyRequests.postConsentRequests()
PISP_LM -> Switch: POST /consentRequests
rnote right of PISP_LM #LightBlue
POST /consentRequests
FSIOP-Source: pispa
FSIOP-Destination: dfspa
{
  // consentRequestId will be the uuid created
  // at the PRELINKING-2
  consentRequestId: 6789
  scopes: [{
    accountId: 'dfspa.username.1234',
    actions: ['accounts.getBalance', 'accounts.transfer'],
    accountId: 'dfspa.username.5678',
    actions: ['accounts.getBalance', 'accounts.transfer'],
  }],
  // model will add `authChannels`
  authChannels: ["WEB", "OTP"],
  callbackURI: 'pisp-app://callback...'
}
end note

activate Switch
Switch - -> PISP_LM: 202 Accepted
deactivate PISP_LM
Switch -> DFSP_TP_IN: POST /consentRequests
activate DFSP_TP_IN

DFSP_TP_IN -> DFSP_TP_IN: const model = await create()
activate DFSP_LM
rnote right of DFSP_TP_IN: state: start
DFSP_TP_IN -> DFSP_LM: model.requestConsent()
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
deactivate DFSP_TP_IN
DFSP_LM -> DFSP_LM: DFSPBackendRequests.validateConsentRequest()
activate DFSPAuthorizeSimulator
DFSP_LM -> DFSPAuthorizeSimulator: ""POST /store/consentRequests/6789""
DFSPAuthorizeSimulator -> DFSPAuthorizeSimulator: store consentRequest details
DFSPAuthorizeSimulator -> DFSP_LM: 201 Created
rnote right of DFSP_LM: state: consentRequestValidatedAndStored
deactivate DFSPAuthorizeSimulator

activate Switch
DFSP_LM -> Switch: PUT /consentRequests/6789

rnote left of DFSP_LM #LightBlue
PUT /consentRequests/6789
FSIOP-Source: pispa
FSIOP-Destination: dfspa
{
  consentRequestId: 6789
  scopes: [{
    accountId: 'dfspa.username.1234',
    actions: ['accounts.getBalance', 'accounts.transfer'],
    accountId: 'dfspa.username.5678',
    actions: ['accounts.getBalance', 'accounts.transfer'],
  }],
  authChannels: ["WEB"],
  callbackURI: 'pisp-app://callback...',
  authURI: 'dfspa.com/authorize?consentRequestId=6789' // this is new
}
end note
Switch - -> DFSP_LM: 202 ACCEPTED
deactivate DFSP_LM
activate PISP_TP_IN
Switch ->  PISP_TP_IN: PUT /consentRequests/6789
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
activate PISP_LM
PISP_TP_IN - -> PISP_LM: Consent Request response recieved
rnote right of PISP_LM: state: webAuthenticationChannelResponseRecieved
PISP_LM - -> PISP_LM: this.saveToKVS()
deactivate PISP_TP_IN
PISP_LM -> PISP_TP_OUT: return Authentication Response
deactivate PISP_LM
PISP_TP_OUT - -> PISP: 200 OK Autentication Response
rnote left of PISP_TP_OUT #LightBlue
{
  channelResponse: {
    consentRequestId: 6789
    scopes: [{
      accountId: 'dfspa.username.1234',
      actions: ['accounts.getBalance', 'accounts.transfer'],
      accountId: 'dfspa.username.5678',
      actions: ['accounts.getBalance', 'accounts.transfer'],
    }],
    authChannels: ["WEB"],
    callbackURI: 'pisp-app://callback...',
    authURI: 'dfspa.com/authorize?consentRequestId=6789' // this is new
  },
  currentState="OTPAuthenticationChannelResponseRecieved"
}
end note
deactivate PISP_TP_OUT
deactivate PISP

note over PISP, DFSPAuthorizeSimulator
  The PISP is expected to redirect to the DFSP's `authUri` in their application to let the end user complete the web login flow.
  Logging in successfully should provide the PISP with a secret to use in the next linking step.
end note

== Request Consent - OTP ==
autonumber 1 "<b>REQUEST-CONSENT-#</b>"
rnote right of PISP
PISP presents accounts to user. User selects one or more accounts to link.
end note
PISP -> PISP_TP_OUT: POST /linking/request-consent
rnote right of PISP #LightBlue
POST /linking/request-consent
{
  "accounts": [
    { accountNickname: "XXXXXXnt", id: "dfspa.username.1234", currency: "ZAR" },
    { accountNickname: "SpeXXXXXXXXnt", id: "dfspa.username.5678", currency: "USD" }
  ],
  callbackURI: 'pisp-app://callback'
}
end note

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await create()
rnote right of PISP_TP_OUT: state: start
PISP_TP_OUT -> PISP_LM: model.requestConsent()

activate PISP_LM

PISP_LM -> PISP_LM: ThirdpartyRequests.postConsentRequests()
PISP_LM -> Switch: POST /consentRequests
rnote right of PISP_LM #LightBlue
POST /consentRequests
FSIOP-Source: pispa
FSIOP-Destination: dfspa
{
  // consentRequestId will be the uuid created
  // at the PRELINKING-2
  consentRequestId: 6789
  scopes: [{
    accountId: 'dfspa.username.1234',
    actions: ['accounts.getBalance', 'accounts.transfer'],
    accountId: 'dfspa.username.5678',
    actions: ['accounts.getBalance', 'accounts.transfer'],
  }],
  // model will add `authChannels`
  authChannels: ["OTP"],
  callbackURI: 'pisp-app://callback...'
}
end note

activate Switch
Switch - -> PISP_LM: 202 Accepted
deactivate PISP_LM
Switch -> DFSP_TP_IN: POST /consentRequests
activate DFSP_TP_IN

DFSP_TP_IN -> DFSP_TP_IN: const model = await create()
activate DFSP_LM
rnote right of DFSP_TP_IN: state: start
DFSP_TP_IN -> DFSP_LM: model.requestConsent()
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
deactivate DFSP_TP_IN
DFSP_LM -> DFSP_LM: DFSPBackendRequests.validateConsentRequest()
activate DFSPAuthorizeSimulator
DFSP_LM -> DFSPAuthorizeSimulator: ""POST /store/consentRequests/6789""
DFSPAuthorizeSimulator -> DFSPAuthorizeSimulator: store consentRequest details
DFSPAuthorizeSimulator -> DFSP_LM: 201 Created
rnote right of DFSP_LM: state: consentRequestValidatedAndStored
deactivate DFSPAuthorizeSimulator
deactivate DFSP_TP_IN


activate Switch
DFSP_LM -> Switch: PUT /consentRequests/6789

rnote left of DFSP_LM #LightBlue
PUT /consentRequests/6789
FSIOP-Source: pispa
FSIOP-Destination: dfspa
{
  consentRequestId: 6789
  scopes: [{
    accountId: 'dfspa.username.1234',
    actions: ['accounts.getBalance', 'accounts.transfer'],
    accountId: 'dfspa.username.5678',
    actions: ['accounts.getBalance', 'accounts.transfer'],
  }],
  authChannels: ["OTP"],
  callbackURI: 'pisp-app://callback...',
  authURI: 'dfspa.com/authorize?consentRequestId=6789' // this is new
}
end note
Switch - -> DFSP_LM: 202 ACCEPTED
deactivate DFSP_LM
activate PISP_TP_IN
Switch ->  PISP_TP_IN: PUT /consentRequests/6789
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
activate PISP_LM
PISP_TP_IN - -> PISP_LM: Consent Request response recieved
rnote right of PISP_LM: state: OTPAuthenticationChannelResponseRecieved
PISP_LM - -> PISP_LM: this.saveToKVS()
deactivate PISP_TP_IN
PISP_LM -> PISP_TP_OUT: return Authentication Response
deactivate PISP_LM
PISP_TP_OUT - -> PISP: 200 OK Autentication Response
rnote left of PISP_TP_OUT #LightBlue
{
  channelResponse: {
    consentRequestId: 6789
    scopes: [{
      accountId: 'dfspa.username.1234',
      actions: ['accounts.getBalance', 'accounts.transfer'],
      accountId: 'dfspa.username.5678',
      actions: ['accounts.getBalance', 'accounts.transfer'],
    }],
    authChannels: ["OTP"],
    callbackURI: 'pisp-app://callback...',
    authURI: 'dfspa.com/authorize?consentRequestId=6789' // this is new
  },
  currentState="OTPAuthenticationChannelResponseRecieved"
}
end note

deactivate PISP_TP_OUT
deactivate PISP

note over PISP, DFSPAuthorizeSimulator
  The DFSP is expected to send an OTP to the end user which will be used in the next linking step.
end note

== Authentication+Grant Consent+Register Credential ==
autonumber 1 "<b>AUTHENTICATION-#</b>"
rnote right of PISP
PISP has obtained authToken from end-user(OTP) or through a callback(Web).
end note
PISP -> PISP_TP_OUT: POST /linking/authenticate
rnote right of PISP #LightBlue
PATCH /linking/authenticate/6789
{
  authToken: '123456'
}
end note

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await loadFromKVS({key: 6789})
rnote right of PISP_TP_OUT: state: webAuthenticationChannelResponseRecieved or OTPAuthenticationChannelResponseRecieved
PISP_TP_OUT -> PISP_LM: model.authenticate()

activate PISP_LM

PISP_LM -> PISP_LM: ThirdpartyRequests.patchConsentRequests()
PISP_LM -> Switch: PATCH /consentRequests/6789
rnote right of PISP_LM #LightBlue
PATCH /consentRequests/6789
FSIOP-Source: pispa
FSIOP-Destination: dfspa
{
  authToken: '124356'
}
end note

activate Switch
Switch - -> PISP_LM: 202 Accepted
deactivate PISP_LM
Switch -> DFSP_TP_IN: PATCH /consentRequests/6789
activate DFSP_TP_IN

DFSP_TP_IN -> DFSP_TP_IN: const model = await loadFromKVS({key: 6789})
activate DFSP_LM
rnote right of DFSP_TP_IN: state: consentRequestValidatedAndStored
DFSP_TP_IN -> DFSP_LM: model.validateAuthToken()
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
deactivate DFSP_TP_IN

DFSP_LM -> DFSP_LM: DFSPBackendRequests.validateAuthToken()
rnote right of DFSP_LM #LightBlue
Do we need two backend endpoints for validating
web authTokens and OTP authTokens? Or is a DFSP expected to
validate both cases with one endpoint?

POST /validateAuthToken
{
  consentRequestId: '6789'
  authToken: '124356'
}
end note
rnote right of DFSP_LM: state: authTokenValidated

DFSP_LM -> DFSP_LM: model.getScopes()
DFSP_LM -> DFSP_LM: Get scopes.
rnote right of DFSP_LM #LightBlue
Do we need to get scopes from
- DFSPAuthorizeSimulator?
- Using DFSPBackendRequests?
- Can't we store the consentRequest in the Consent Request stage
  in the model data and pull it from there instead of having to
  make a request?
end note
rnote right of DFSP_LM: state: scopesRetrieved

DFSP_LM -> DFSP_LM: const consentId = uuid()
DFSP_LM -> DFSP_LM: model.grantConsent()
DFSP_LM -> DFSP_LM: ThirdpartyRequests.postConsents()
rnote right of DFSP_LM: state: consentGranted
rnote right of DFSP_LM #LightBlue
It's important to save the model with the consentId from this point onwards!
Requests will not contain a consentRequestId in the upcoming requests.
This may require changing `PersistentModel` to have a secondary key it can
store the model with.
end note
DFSP_LM -> DFSP_LM: this.saveToKVS({key: '1a2b3c4d'})

activate Switch
DFSP_LM -> Switch: POST /consents

rnote left of DFSP_LM #LightBlue
POST /consents
FSIOP-Source: dfspa
FSIOP-Destination: pispa
{
  consentId: 1a2b3c4d
  consentRequestId: 6789
  scopes: [{
    accountId: 'dfspa.username.1234',
    actions: ['accounts.getBalance', 'accounts.transfer'],
    accountId: 'dfspa.username.5678',
    actions: ['accounts.getBalance', 'accounts.transfer'],
  }]
}
end note
Switch - -> DFSP_LM: 202 ACCEPTED
deactivate DFSP_LM
activate PISP_TP_IN
Switch ->  PISP_TP_IN: POST /consents
PISP_TP_IN -> PISP_TP_IN: const model = await loadFromKVS({key: 6789})
activate PISP_LM
PISP_TP_IN -> PISP_LM: model.registerCredential()
PISP_TP_IN - -> Switch: 202 Accepted
deactivate PISP_TP_IN
deactivate Switch
rnote right of PISP_LM: state: consentRecieved
rnote right of PISP_LM #LightBlue
It's important to save the model with the consentId from this point onwards!
Requests will not contain a consentRequestId in the upcoming requests.
This may require changing `PersistentModel` to have a secondary key it can
store the model with.
end note
PISP_LM - -> PISP_LM: const challenge = deriveChallenge(consentRequest)
PISP_LM - -> PISP_LM: this.saveToKVS({key: '1a2b3c4d'})

PISP_LM -> PISP_LM: ThirdpartyRequests.putConsents()
rnote right of PISP_LM: state: signedConsentSent
activate Switch
PISP_LM -> Switch: PUT /consents/1a2b3c4d

rnote right of PISP_LM #LightBlue
PUT /consents/1a2b3c4d
FSIOP-Source: pispa
FSIOP-Destination: dfspa
{
  scopes: [{
    accountId: 'dfspa.username.1234',
    actions: ['accounts.getBalance', 'accounts.transfer'],
    accountId: 'dfspa.username.5678',
    actions: ['accounts.getBalance', 'accounts.transfer'],
  }],
  credential: {
    credentialType: "FIDO",
    status: "PENDING",
    payload: PublicKeyCredential
  }
}
end note

Switch - -> PISP_LM: 202 Accepted
deactivate PISP_LM
Switch -> DFSP_TP_IN: PUT /consents/1a2b3c4d
activate DFSP_TP_IN

DFSP_TP_IN -> DFSP_TP_IN: const model = await loadFromKVS({key: 1a2b3c4d})
activate DFSP_LM
rnote right of DFSP_TP_IN: state: signedConsentRecieved
DFSP_TP_IN -> DFSP_LM: model.validateSignedConsent()
rnote right of DFSP_TP_IN: state: pendingRegistrationAndValidation
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
deactivate DFSP_TP_IN
DFSP_LM -> DFSP_LM: Check signed consent.
rnote right of DFSP_LM #LightBlue
Does this need a backend request or can the scheme adapter check the consent.
end note
rnote right of DFSP_LM: state: signedConsentChecked
DFSP_LM-> DFSP_LM: model.validateWithAuthService()
activate Switch
DFSP_LM -> Switch: POST /consents/1a2b3c4d

rnote left of DFSP_LM #LightBlue
POST /consents/1a2b3c4d
FSIOP-Source: dfspa
FSIOP-Destination: central-auth
{
  scopes: [{
    accountId: 'dfspa.username.1234',
    actions: ['accounts.getBalance', 'accounts.transfer'],
    accountId: 'dfspa.username.5678',
    actions: ['accounts.getBalance', 'accounts.transfer'],
  }],
  credential: {
    credentialType: "FIDO",
    status: "PENDING",
    payload: PublicKeyCredential
  }
}
end note
Switch - -> DFSP_LM: 202 Accepted
deactivate DFSP_LM

Switch -> AUTH: POST /consents/1a2b3c4d
activate AUTH
AUTH - -> Switch: 202 Accepted
AUTH -> AUTH: Check consent.
AUTH -> Switch: PUT /consents/1a2b3c4d

rnote left of AUTH #LightBlue
PUT /consents/1a2b3c4d
FSIOP-Source: central-auth
FSIOP-Destination: dfspa
{
  scopes: [{
    accountId: 'dfspa.username.1234',
    actions: ['accounts.getBalance', 'accounts.transfer'],
    accountId: 'dfspa.username.5678',
    actions: ['accounts.getBalance', 'accounts.transfer'],
  }],
  credential: {
    credentialType: "FIDO",
    status: "VERIFIED",
    payload: PublicKeyCredential
  }
}
end note

Switch - -> AUTH: 200 OK
deactivate AUTH
activate DFSP_TP_IN
Switch -> DFSP_TP_IN: PUT /consents/1a2b3c4d
DFSP_TP_IN -> DFSP_TP_IN: const model = await loadFromKVS({key: 1a2b3c4d})
DFSP_TP_IN -> DFSP_TP_IN: consentResponseRecieved()
rnote right of DFSP_TP_IN: state: consentResponseRecieved
DFSP_TP_IN -> DFSP_LM: Auth Service response recieved
activate DFSP_LM
DFSP_TP_IN - -> Switch: 200 OK
deactivate Switch
deactivate DFSP_TP_IN

activate AUTH
AUTH -> ALS: POST /participants/CONSENTS/1a2b3c4d
activate ALS
ALS - -> AUTH: 202 Accepted
deactivate AUTH

ALS -> DFSP_TP_IN: PUT /participants/CONSENTS/1a2b3c4d
activate DFSP_TP_IN
DFSP_TP_IN -> DFSP_TP_IN: const model = await loadFromKVS({key: 1a2b3c4d})
DFSP_TP_IN -> DFSP_TP_IN: participantResponseRecieved()
rnote right of DFSP_TP_IN: state: participantsResponseRecieved
DFSP_TP_IN -> DFSP_LM: Participant response recieved
DFSP_TP_IN - -> ALS: 200 Accepted
deactivate ALS
deactivate DFSP_TP_IN
rnote right of DFSP_LM: state: consentRegisteredAndValidated
DFSP_LM -> DFSP_LM: model.finalizeConsent()

loop for each scope in ""Consents.scopes""
DFSP_LM -> Switch: POST /participants/THIRD_PARTY_LINK/dfsp.username.5678
Switch - -> DFSP_LM: 202 Accepted
Switch -> ALS: POST /participants/THIRD_PARTY_LINK/dfsp.username.5678
ALS - -> Switch: 202 Accepted
ALS -> Switch: PUT /participants/THIRD_PARTY_LINK/dfsp.username.5678
Switch - -> ALS: 200 OK
Switch -> DFSP_TP_IN: PUT /participants/THIRD_PARTY_LINK/dfsp.username.5678
DFSP_TP_IN - -> Switch: 200 OK
DFSP_TP_IN -> DFSP_LM: Participant response recieved
end

DFSP_LM -> DFSP_LM: await Promise.all()
DFSP_LM -> DFSP_LM: state: PISPDFSPLinkEstablished
DFSP_LM -> DFSP_LM: model.notifyVerificationToPISP()
DFSP_LM -> Switch: PATCH /consents/1a2b3c4d
rnote left of DFSP_LM #LightBlue
PATCH /consents/1a2b3c4d
FSIOP-Source: dfspa
FSIOP-Destination: pispa
{
  credential: {
    status: "VERIFIED"
  }
}
end note
activate Switch
Switch - -> DFSP_LM: 200 OK
deactivate DFSP_LM
Switch -> PISP_TP_IN: PATCH /consents/1a2b3c4d
activate PISP_TP_IN
PISP_TP_IN -> PISP_TP_IN: const model = await loadFromKVS({key: 1a2b3c4d})

activate PISP_LM
PISP_TP_IN -> PISP_LM: Verified Response recieved
PISP_TP_IN - -> Switch: 200 OK
deactivate PISP_TP_IN
deactivate Switch
rnote right of PISP_LM: state: accountsLinked
PISP_LM - -> PISP_TP_OUT: return Accounts linked response
deactivate PISP_LM
PISP_TP_OUT - -> PISP: 200 OK Accounts Linked
rnote left of PISP_TP_OUT #LightBlue
{
  credential: {
    status: "VERIFIED"
  }
  currentState="accountsLinked"
}
end note
@enduml

PlantUML version 1.2021.00(Sun Jan 10 05:25:05 EST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>