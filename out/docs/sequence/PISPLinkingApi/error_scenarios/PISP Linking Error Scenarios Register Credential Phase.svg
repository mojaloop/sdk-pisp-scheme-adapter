<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4750px" preserveAspectRatio="none" style="width:4322px;height:4750px;" version="1.1" viewBox="0 0 4322 4750" width="4322px" zoomAndPan="magnify"><defs><filter height="300%" id="fg5x6ah2pljuy" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="485" x="1915" y="28.708">PISP Linking Error Scenarios Register Credential Phase</text><rect fill="#DDDDDD" height="4703.2969" style="stroke:#A80036;stroke-width:1.0;" width="1122.5" x="482.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="953.75" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="4703.2969" style="stroke:#A80036;stroke-width:1.0;" width="920.5" x="1989" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="2415.75" y="53.02">Mojaloop</text><rect fill="#DDDDDD" height="4703.2969" style="stroke:#A80036;stroke-width:1.0;" width="658" x="3180" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186" x="3416" y="53.02">DFSP tp-scheme-adapter</text><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="4485.1719" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="4485.1719" style="stroke:#A80036;stroke-width:1.0;" width="10" x="548.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="209.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1024.5" y="385.7109"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="618.7188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1024.5" y="1580.0859"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1024.5" y="4596.5547"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="100.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1534.5" y="1508.8203"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1534.5" y="4538.2891"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="196.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2019.5" y="456.9766"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="297.7266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2019.5" y="1311.4922"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="485.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2019.5" y="1909.5469"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="954.9766" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2019.5" y="2574.2656"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="302.125" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2019.5" y="4265.2969"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="652.7188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2367.5" y="2934.7891"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="233.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2808.5" y="3558.375"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3240.5" y="624.0391"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="166.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3240.5" y="2227.9375"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="175.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3240.5" y="3353.5781"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="175.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3240.5" y="3616.6406"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="722.1172" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3756.5" y="757.5703"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="566.3203" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3756.5" y="2332.3359"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="1009.0469" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3756.5" y="3500.1094"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="279.3281" style="stroke:#000000;stroke-width:2.0;" width="1861" x="1983" y="3882.5703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="61" x2="61" y1="95.3828" y2="4705.9531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="553.5" x2="553.5" y1="95.3828" y2="4705.9531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1029.5" x2="1029.5" y1="95.3828" y2="4705.9531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1539" x2="1539" y1="95.3828" y2="4705.9531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2024" x2="2024" y1="95.3828" y2="4705.9531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2372.5" x2="2372.5" y1="95.3828" y2="4705.9531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="2813.5" x2="2813.5" y1="95.3828" y2="4705.9531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="3245" x2="3245" y1="95.3828" y2="4705.9531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="3761" x2="3761" y1="95.3828" y2="4705.9531"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="4217" x2="4217" y1="95.3828" y2="4705.9531"/><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="12" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="5" y="4704.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="12" y="4724.9482">PISP Backend</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="486.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="493.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="486.5" y="4704.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="493.5" y="4724.9482">outbound-server</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="134" x="960.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="967.5" y="80.0811">PISPLinkingModel</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="134" x="960.5" y="4704.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="967.5" y="4724.9482">PISPLinkingModel</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1478" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1485" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1478" y="4704.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1485" y="4724.9482">inbound-server</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1993" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="2000" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1993" y="4704.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="2000" y="4724.9482">Switch</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="100" x="2320.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="2327.5" y="80.0811">Auth Service</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="100" x="2320.5" y="4704.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="2327.5" y="4724.9482">Auth Service</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="180" x="2721.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="2728.5" y="80.0811">Account Lookup Service</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="180" x="2721.5" y="4704.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166" x="2728.5" y="4724.9482">Account Lookup Service</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="3184" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="3191" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="3184" y="4704.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="3191" y="4724.9482">inbound-server</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="141" x="3689" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="3696" y="80.0811">DFSPLinkingModel</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="141" x="3689" y="4704.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127" x="3696" y="4724.9482">DFSPLinkingModel</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="181" x="4125" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="4132" y="80.0811">DFSPAuthorizeSimulator</text><rect fill="#FEFECE" filter="url(#fg5x6ah2pljuy)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="181" x="4125" y="4704.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="4132" y="4724.9482">DFSPAuthorizeSimulator</text><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="4485.1719" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="4485.1719" style="stroke:#A80036;stroke-width:1.0;" width="10" x="548.5" y="202.7813"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="209.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1024.5" y="385.7109"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="618.7188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1024.5" y="1580.0859"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="62.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1024.5" y="4596.5547"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="100.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1534.5" y="1508.8203"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1534.5" y="4538.2891"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="196.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2019.5" y="456.9766"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="297.7266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2019.5" y="1311.4922"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="485.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2019.5" y="1909.5469"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="954.9766" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2019.5" y="2574.2656"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="302.125" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2019.5" y="4265.2969"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="652.7188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2367.5" y="2934.7891"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="233.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2808.5" y="3558.375"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="133.5313" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3240.5" y="624.0391"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="166.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3240.5" y="2227.9375"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="175.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3240.5" y="3353.5781"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="175.6641" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3240.5" y="3616.6406"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="722.1172" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3756.5" y="757.5703"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="566.3203" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3756.5" y="2332.3359"/><rect fill="#FFFFFF" filter="url(#fg5x6ah2pljuy)" height="1009.0469" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3756.5" y="3500.1094"/><rect fill="#EEEEEE" filter="url(#fg5x6ah2pljuy)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4315" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4315" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4315" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#fg5x6ah2pljuy)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="397" x="1959" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="378" x="1965" y="131.4497">Authentication+Grant Consent+Register Credential</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="503" x="66" y="153.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="495" x="70" y="169.5825">PISP has obtained authToken from end-user(OTP) or through a callback(Web).</text><polygon fill="#A80036" points="536.5,198.7813,546.5,202.7813,536.5,206.7813,540.5,202.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="66.5" x2="542.5" y1="202.7813" y2="202.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="73.5" y="197.7153">AUTHENTICATION-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="216.5" y="197.7153">POST /linking/request-consent/6789/authenticate</text><rect fill="#ADD8E6" filter="url(#fg5x6ah2pljuy)" height="68" style="stroke:#A80036;stroke-width:1.0;" width="320" x="71" y="215.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="75" y="231.8481">POST /linking/request-consent/6789/authenticate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="75" y="246.981">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="83" y="262.1138">authToken: '123456'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="75" y="277.2466">}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="558.5" x2="600.5" y1="310.4453" y2="310.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="600.5" x2="600.5" y1="310.4453" y2="323.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="559.5" x2="600.5" y1="323.4453" y2="323.4453"/><polygon fill="#A80036" points="569.5,319.4453,559.5,323.4453,569.5,327.4453,565.5,323.4453" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="565.5" y="305.3794">AUTHENTICATION-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="708.5" y="305.3794">const model = await loadFromKVS({key: 6789})</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="648" x="563" y="336.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="640" x="567" y="352.5122">state: webAuthenticationChannelResponseRecieved or OTPAuthenticationChannelResponseRecieved</text><polygon fill="#A80036" points="1012.5,381.7109,1022.5,385.7109,1012.5,389.7109,1016.5,385.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="558.5" x2="1018.5" y1="385.7109" y2="385.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="565.5" y="380.645">AUTHENTICATION-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="708.5" y="380.645">model.authenticate()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1034.5" x2="1076.5" y1="414.8438" y2="414.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1076.5" x2="1076.5" y1="414.8438" y2="427.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1035.5" x2="1076.5" y1="427.8438" y2="427.8438"/><polygon fill="#A80036" points="1045.5,423.8438,1035.5,427.8438,1045.5,431.8438,1041.5,427.8438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="1041.5" y="409.7778">AUTHENTICATION-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="285" x="1184.5" y="409.7778">ThirdpartyRequests.patchConsentRequests()</text><polygon fill="#A80036" points="2007.5,452.9766,2017.5,456.9766,2007.5,460.9766,2011.5,456.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1034.5" x2="2013.5" y1="456.9766" y2="456.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="1041.5" y="451.9106">AUTHENTICATION-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="1184.5" y="451.9106">PATCH /consentRequests/6789</text><rect fill="#ADD8E6" filter="url(#fg5x6ah2pljuy)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="205" x="1039" y="469.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="1043" y="486.0435">PATCH /consentRequests/6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="1043" y="501.1763">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="1043" y="516.3091">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1043" y="531.4419">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="1051" y="546.5747">authToken: '124356'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1043" y="561.7075">}</text><polygon fill="#A80036" points="1040.5,590.9063,1030.5,594.9063,1040.5,598.9063,1036.5,594.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1034.5" x2="2018.5" y1="594.9063" y2="594.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="1046.5" y="589.8403">AUTHENTICATION-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1189.5" y="589.8403">202 Accepted</text><polygon fill="#A80036" points="3228.5,620.0391,3238.5,624.0391,3228.5,628.0391,3232.5,624.0391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2029.5" x2="3234.5" y1="624.0391" y2="624.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="2036.5" y="618.9731">AUTHENTICATION-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="2179.5" y="618.9731">PATCH /consentRequests/6789</text><polygon fill="#A80036" points="2035.5,649.1719,2025.5,653.1719,2035.5,657.1719,2031.5,653.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2029.5" x2="3239.5" y1="653.1719" y2="653.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="2041.5" y="648.106">AUTHENTICATION-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2184.5" y="648.106">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3250.5" x2="3292.5" y1="682.3047" y2="682.3047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3292.5" x2="3292.5" y1="682.3047" y2="695.3047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3251.5" x2="3292.5" y1="695.3047" y2="695.3047"/><polygon fill="#A80036" points="3261.5,691.3047,3251.5,695.3047,3261.5,699.3047,3257.5,695.3047" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="139" x="3257.5" y="677.2388">AUTHENTICATION-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="3400.5" y="677.2388">const model = await loadFromKVS({key: 6789})</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="280" x="3255" y="708.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="3259" y="724.3716">state: consentRequestValidatedAndStored</text><polygon fill="#A80036" points="3744.5,753.5703,3754.5,757.5703,3744.5,761.5703,3748.5,757.5703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3245.5" x2="3750.5" y1="757.5703" y2="757.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3252.5" y="752.5044">AUTHENTICATION-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="3404.5" y="752.5044">model.validateAuthToken()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3766.5" x2="3808.5" y1="786.7031" y2="786.7031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3808.5" x2="3808.5" y1="786.7031" y2="799.7031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3767.5" x2="3808.5" y1="799.7031" y2="799.7031"/><polygon fill="#A80036" points="3777.5,795.7031,3767.5,799.7031,3777.5,803.7031,3773.5,799.7031" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3773.5" y="781.6372">AUTHENTICATION-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="3925.5" y="781.6372">DFSPBackendRequests.validateAuthToken()</text><rect fill="#ADD8E6" filter="url(#fg5x6ah2pljuy)" height="159" style="stroke:#A80036;stroke-width:1.0;" width="416" x="3771" y="812.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="3775" y="828.77">Do we need two backend endpoints for validating</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="408" x="3775" y="843.9028">web authTokens and OTP authTokens? Or is a DFSP expected to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="3775" y="859.0356">validate both cases with one endpoint?</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="3779" y="874.1685"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="3775" y="889.3013">POST /validateAuthToken</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3775" y="904.4341">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="3783" y="919.5669">consentRequestId: '6789'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="3783" y="934.6997">authChannel: model.data.authChannel,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="3783" y="949.8325">authToken: '124356'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3775" y="964.9653">}</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="176" x="3771" y="982.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="3775" y="998.0981">state: authTokenValidated</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3766.5" x2="3808.5" y1="1031.2969" y2="1031.2969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3808.5" x2="3808.5" y1="1031.2969" y2="1044.2969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3767.5" x2="3808.5" y1="1044.2969" y2="1044.2969"/><polygon fill="#A80036" points="3777.5,1040.2969,3767.5,1044.2969,3777.5,1048.2969,3773.5,1044.2969" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3773.5" y="1026.231">AUTHENTICATION-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="3925.5" y="1026.231">const consentId = uuid()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3766.5" x2="3808.5" y1="1073.4297" y2="1073.4297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3808.5" x2="3808.5" y1="1073.4297" y2="1086.4297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3767.5" x2="3808.5" y1="1086.4297" y2="1086.4297"/><polygon fill="#A80036" points="3777.5,1082.4297,3767.5,1086.4297,3777.5,1090.4297,3773.5,1086.4297" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3773.5" y="1068.3638">AUTHENTICATION-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="3925.5" y="1068.3638">model.grantConsent()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3766.5" x2="3808.5" y1="1115.5625" y2="1115.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3808.5" x2="3808.5" y1="1115.5625" y2="1128.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3767.5" x2="3808.5" y1="1128.5625" y2="1128.5625"/><polygon fill="#A80036" points="3777.5,1124.5625,3767.5,1128.5625,3777.5,1132.5625,3773.5,1128.5625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3773.5" y="1110.4966">AUTHENTICATION-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="3925.5" y="1110.4966">ThirdpartyRequests.postConsents()</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="152" x="3771" y="1141.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="3775" y="1157.6294">state: consentGranted</text><rect fill="#ADD8E6" filter="url(#fg5x6ah2pljuy)" height="68" style="stroke:#A80036;stroke-width:1.0;" width="495" x="3771" y="1174.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="484" x="3775" y="1190.7622">It's important to save the model with the consentId from this point onwards!</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="458" x="3775" y="1205.895">Requests will not contain a consentRequestId in the upcoming requests.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="487" x="3775" y="1221.0278">This may require changing `PersistentModel` to have a secondary key it can</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="3775" y="1236.1606">store the model with.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3766.5" x2="3808.5" y1="1269.3594" y2="1269.3594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3808.5" x2="3808.5" y1="1269.3594" y2="1282.3594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3767.5" x2="3808.5" y1="1282.3594" y2="1282.3594"/><polygon fill="#A80036" points="3777.5,1278.3594,3767.5,1282.3594,3777.5,1286.3594,3773.5,1282.3594" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3773.5" y="1264.2935">AUTHENTICATION-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="3925.5" y="1264.2935">this.saveToKVS({key: '1a2b3c4d'})</text><polygon fill="#A80036" points="2040.5,1307.4922,2030.5,1311.4922,2040.5,1315.4922,2036.5,1311.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2034.5" x2="3755.5" y1="1311.4922" y2="1311.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2046.5" y="1306.4263">AUTHENTICATION-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="2198.5" y="1306.4263">POST /consents</text><rect fill="#ADD8E6" filter="url(#fg5x6ah2pljuy)" height="129" style="stroke:#A80036;stroke-width:1.0;" width="191" x="3560" y="1324.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="3564" y="1340.5591">POST /consents</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="3564" y="1355.6919">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="3564" y="1370.8247">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3564" y="1385.9575">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="3572" y="1401.0903">consentId: 1a2b3c4d</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="3572" y="1416.2231">consentRequestId: 6789</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="3572" y="1431.356">scopes: model.data.scopes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3564" y="1446.4888">}</text><polygon fill="#A80036" points="3749.5,1475.6875,3759.5,1479.6875,3749.5,1483.6875,3753.5,1479.6875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2029.5" x2="3755.5" y1="1479.6875" y2="1479.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2036.5" y="1474.6216">AUTHENTICATION-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="2188.5" y="1474.6216">202 ACCEPTED</text><polygon fill="#A80036" points="1555.5,1504.8203,1545.5,1508.8203,1555.5,1512.8203,1551.5,1508.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1549.5" x2="2018.5" y1="1508.8203" y2="1508.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1561.5" y="1503.7544">AUTHENTICATION-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="1713.5" y="1503.7544">POST /consents</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1544.5" x2="1586.5" y1="1537.9531" y2="1537.9531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1586.5" x2="1586.5" y1="1537.9531" y2="1550.9531"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1545.5" x2="1586.5" y1="1550.9531" y2="1550.9531"/><polygon fill="#A80036" points="1555.5,1546.9531,1545.5,1550.9531,1555.5,1554.9531,1551.5,1550.9531" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1551.5" y="1532.8872">AUTHENTICATION-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309" x="1703.5" y="1532.8872">const model = await loadFromKVS({key: 6789})</text><polygon fill="#A80036" points="1045.5,1576.0859,1035.5,1580.0859,1045.5,1584.0859,1041.5,1580.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1039.5" x2="1533.5" y1="1580.0859" y2="1580.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1051.5" y="1575.02">AUTHENTICATION-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="1203.5" y="1575.02">model.registerCredential()</text><polygon fill="#A80036" points="2012.5,1605.2188,2022.5,1609.2188,2012.5,1613.2188,2016.5,1609.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1539.5" x2="2018.5" y1="1609.2188" y2="1609.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1546.5" y="1604.1528">AUTHENTICATION-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1698.5" y="1604.1528">202 Accepted</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="157" x="1039" y="1622.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="1043" y="1638.2856">state: consentRecieved</text><rect fill="#ADD8E6" filter="url(#fg5x6ah2pljuy)" height="68" style="stroke:#A80036;stroke-width:1.0;" width="495" x="1039" y="1655.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="484" x="1043" y="1671.4185">It's important to save the model with the consentId from this point onwards!</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="458" x="1043" y="1686.5513">Requests will not contain a consentRequestId in the upcoming requests.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="487" x="1043" y="1701.6841">This may require changing `PersistentModel` to have a secondary key it can</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="1043" y="1716.8169">store the model with.</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1034.5" x2="1076.5" y1="1750.0156" y2="1750.0156"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1076.5" x2="1076.5" y1="1750.0156" y2="1763.0156"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1035.5" x2="1076.5" y1="1763.0156" y2="1763.0156"/><polygon fill="#A80036" points="1045.5,1759.0156,1035.5,1763.0156,1045.5,1767.0156,1041.5,1763.0156" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1041.5" y="1744.9497">AUTHENTICATION-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="1193.5" y="1744.9497">const challenge = deriveChallenge(consentRequest)</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1034.5" x2="1076.5" y1="1792.1484" y2="1792.1484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1076.5" x2="1076.5" y1="1792.1484" y2="1805.1484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1035.5" x2="1076.5" y1="1805.1484" y2="1805.1484"/><polygon fill="#A80036" points="1045.5,1801.1484,1035.5,1805.1484,1045.5,1809.1484,1041.5,1805.1484" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1041.5" y="1787.0825">AUTHENTICATION-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="1193.5" y="1787.0825">this.saveToKVS({key: '1a2b3c4d'})</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1034.5" x2="1076.5" y1="1834.2813" y2="1834.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1076.5" x2="1076.5" y1="1834.2813" y2="1847.2813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1035.5" x2="1076.5" y1="1847.2813" y2="1847.2813"/><polygon fill="#A80036" points="1045.5,1843.2813,1035.5,1847.2813,1045.5,1851.2813,1041.5,1847.2813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1041.5" y="1829.2153">AUTHENTICATION-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="1193.5" y="1829.2153">ThirdpartyRequests.putConsents()</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="174" x="1039" y="1860.2813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="1043" y="1876.3481">state: signedConsentSent</text><polygon fill="#A80036" points="2007.5,1905.5469,2017.5,1909.5469,2007.5,1913.5469,2011.5,1909.5469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1034.5" x2="2013.5" y1="1909.5469" y2="1909.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1041.5" y="1904.481">AUTHENTICATION-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="1193.5" y="1904.481">PUT /consents/1a2b3c4d</text><rect fill="#ADD8E6" filter="url(#fg5x6ah2pljuy)" height="250" style="stroke:#A80036;stroke-width:1.0;" width="358" x="1039" y="1922.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="1043" y="1938.6138">PUT /consents/1a2b3c4d</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="1043" y="1953.7466">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="1043" y="1968.8794">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1043" y="1984.0122">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="1051" y="1999.145">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="1059" y="2014.2778">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="1059" y="2029.4106">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="1059" y="2044.5435">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="1059" y="2059.6763">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="1051" y="2074.8091">}],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="1051" y="2089.9419">credential: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="1059" y="2105.0747">credentialType: "FIDO",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="1059" y="2120.2075">status: "PENDING",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="1059" y="2135.3403">payload: PublicKeyCredential</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1051" y="2150.4731">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1043" y="2165.606">}</text><polygon fill="#A80036" points="1040.5,2194.8047,1030.5,2198.8047,1040.5,2202.8047,1036.5,2198.8047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1034.5" x2="2018.5" y1="2198.8047" y2="2198.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1046.5" y="2193.7388">AUTHENTICATION-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1198.5" y="2193.7388">202 Accepted</text><polygon fill="#A80036" points="3228.5,2223.9375,3238.5,2227.9375,3228.5,2231.9375,3232.5,2227.9375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2029.5" x2="3234.5" y1="2227.9375" y2="2227.9375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2036.5" y="2222.8716">AUTHENTICATION-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="2188.5" y="2222.8716">PUT /consents/1a2b3c4d</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3250.5" x2="3292.5" y1="2257.0703" y2="2257.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3292.5" x2="3292.5" y1="2257.0703" y2="2270.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3251.5" x2="3292.5" y1="2270.0703" y2="2270.0703"/><polygon fill="#A80036" points="3261.5,2266.0703,3251.5,2270.0703,3261.5,2274.0703,3257.5,2270.0703" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3257.5" y="2252.0044">AUTHENTICATION-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="3409.5" y="2252.0044">const model = await loadFromKVS({key: 1a2b3c4d})</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="201" x="3255" y="2283.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="3259" y="2299.1372">state: signedConsentRecieved</text><polygon fill="#A80036" points="3744.5,2328.3359,3754.5,2332.3359,3744.5,2336.3359,3748.5,2332.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3250.5" x2="3750.5" y1="2332.3359" y2="2332.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3257.5" y="2327.27">AUTHENTICATION-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="3409.5" y="2327.27">model.validateSignedConsent()</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="264" x="3255" y="2345.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="3259" y="2361.4028">state: pendingRegistrationAndValidation</text><polygon fill="#A80036" points="2035.5,2390.6016,2025.5,2394.6016,2035.5,2398.6016,2031.5,2394.6016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2029.5" x2="3244.5" y1="2394.6016" y2="2394.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2041.5" y="2389.5356">AUTHENTICATION-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2193.5" y="2389.5356">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3766.5" x2="3808.5" y1="2423.7344" y2="2423.7344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3808.5" x2="3808.5" y1="2423.7344" y2="2436.7344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3767.5" x2="3808.5" y1="2436.7344" y2="2436.7344"/><polygon fill="#A80036" points="3777.5,2432.7344,3767.5,2436.7344,3777.5,2440.7344,3773.5,2436.7344" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3773.5" y="2418.6685">AUTHENTICATION-31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="3925.5" y="2418.6685">Check signed consent.</text><rect fill="#ADD8E6" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="530" x="3771" y="2449.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="522" x="3775" y="2465.8013">Does this need a backend request or can the scheme adapter check the consent.</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="199" x="3771" y="2482.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="3775" y="2498.9341">state: signedConsentChecked</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3766.5" x2="3808.5" y1="2532.1328" y2="2532.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3808.5" x2="3808.5" y1="2532.1328" y2="2545.1328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3767.5" x2="3808.5" y1="2545.1328" y2="2545.1328"/><polygon fill="#A80036" points="3777.5,2541.1328,3767.5,2545.1328,3777.5,2549.1328,3773.5,2545.1328" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3773.5" y="2527.0669">AUTHENTICATION-32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="3925.5" y="2527.0669">model.validateWithAuthService()</text><polygon fill="#A80036" points="2040.5,2570.2656,2030.5,2574.2656,2040.5,2578.2656,2036.5,2574.2656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2034.5" x2="3755.5" y1="2574.2656" y2="2574.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2046.5" y="2569.1997">AUTHENTICATION-33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="2198.5" y="2569.1997">POST /consents/1a2b3c4d</text><rect fill="#ADD8E6" filter="url(#fg5x6ah2pljuy)" height="250" style="stroke:#A80036;stroke-width:1.0;" width="358" x="3393" y="2587.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="3397" y="2603.3325">POST /consents/1a2b3c4d</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="3397" y="2618.4653">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="3397" y="2633.5981">FSIOP-Destination: central-auth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3397" y="2648.731">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="3405" y="2663.8638">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="3413" y="2678.9966">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="3413" y="2694.1294">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="3413" y="2709.2622">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="3413" y="2724.395">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="3405" y="2739.5278">}],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="3405" y="2754.6606">credential: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="3413" y="2769.7935">credentialType: "FIDO",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="3413" y="2784.9263">status: "PENDING",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="3413" y="2800.0591">payload: PublicKeyCredential</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3405" y="2815.1919">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3397" y="2830.3247">}</text><polygon fill="#A80036" points="3744.5,2859.5234,3754.5,2863.5234,3744.5,2867.5234,3748.5,2863.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2029.5" x2="3750.5" y1="2863.5234" y2="2863.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2036.5" y="2858.4575">AUTHENTICATION-34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2188.5" y="2858.4575">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3766.5" x2="3808.5" y1="2897.6563" y2="2897.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3808.5" x2="3808.5" y1="2897.6563" y2="2910.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3761.5" x2="3808.5" y1="2910.6563" y2="2910.6563"/><polygon fill="#A80036" points="3771.5,2906.6563,3761.5,2910.6563,3771.5,2914.6563,3767.5,2910.6563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3773.5" y="2892.5903">AUTHENTICATION-35</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="108" x="3925.5" y="2892.5903">this.saveToKVS()</text><polygon fill="#A80036" points="2355.5,2930.7891,2365.5,2934.7891,2355.5,2938.7891,2359.5,2934.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2029.5" x2="2361.5" y1="2934.7891" y2="2934.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2036.5" y="2929.7231">AUTHENTICATION-36</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="2188.5" y="2929.7231">POST /consents/1a2b3c4d</text><polygon fill="#A80036" points="2040.5,2959.9219,2030.5,2963.9219,2040.5,2967.9219,2036.5,2963.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2034.5" x2="2366.5" y1="2963.9219" y2="2963.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2046.5" y="2958.856">AUTHENTICATION-37</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2198.5" y="2958.856">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2377.5" x2="2419.5" y1="2993.0547" y2="2993.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2419.5" x2="2419.5" y1="2993.0547" y2="3006.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2378.5" x2="2419.5" y1="3006.0547" y2="3006.0547"/><polygon fill="#A80036" points="2388.5,3002.0547,2378.5,3006.0547,2388.5,3010.0547,2384.5,3006.0547" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2384.5" y="2987.9888">AUTHENTICATION-38</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="2536.5" y="2987.9888">Check consent.</text><polygon fill="#A80036" points="2040.5,3031.1875,2030.5,3035.1875,2040.5,3039.1875,2036.5,3035.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2034.5" x2="2366.5" y1="3035.1875" y2="3035.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2046.5" y="3030.1216">AUTHENTICATION-39</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="2198.5" y="3030.1216">PUT /consents/1a2b3c4d</text><rect fill="#ADD8E6" filter="url(#fg5x6ah2pljuy)" height="250" style="stroke:#A80036;stroke-width:1.0;" width="358" x="2004" y="3048.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="2008" y="3064.2544">PUT /consents/1a2b3c4d</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="2008" y="3079.3872">FSIOP-Source: central-auth</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="2008" y="3094.52">FSIOP-Destination: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="2008" y="3109.6528">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66" x="2016" y="3124.7856">scopes: [{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="2024" y="3139.9185">accountId: 'dfspa.username.1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="2024" y="3155.0513">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="2024" y="3170.1841">accountId: 'dfspa.username.5678',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="2024" y="3185.3169">actions: ['accounts.getBalance', 'accounts.transfer'],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="2016" y="3200.4497">}],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="2016" y="3215.5825">credential: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="2024" y="3230.7153">credentialType: "FIDO",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="2024" y="3245.8481">status: "VERIFIED",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="2024" y="3260.981">payload: PublicKeyCredential</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="2016" y="3276.1138">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="2008" y="3291.2466">}</text><polygon fill="#A80036" points="2355.5,3320.4453,2365.5,3324.4453,2355.5,3328.4453,2359.5,3324.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2029.5" x2="2361.5" y1="3324.4453" y2="3324.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2036.5" y="3319.3794">AUTHENTICATION-40</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2188.5" y="3319.3794">200 OK</text><polygon fill="#A80036" points="3228.5,3349.5781,3238.5,3353.5781,3228.5,3357.5781,3232.5,3353.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2029.5" x2="3234.5" y1="3353.5781" y2="3353.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2036.5" y="3348.5122">AUTHENTICATION-41</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="2188.5" y="3348.5122">PUT /consents/1a2b3c4d</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3250.5" x2="3292.5" y1="3382.7109" y2="3382.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3292.5" x2="3292.5" y1="3382.7109" y2="3395.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3251.5" x2="3292.5" y1="3395.7109" y2="3395.7109"/><polygon fill="#A80036" points="3261.5,3391.7109,3251.5,3395.7109,3261.5,3399.7109,3257.5,3395.7109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3257.5" y="3377.645">AUTHENTICATION-42</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="3409.5" y="3377.645">const model = await loadFromKVS({key: 1a2b3c4d})</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3250.5" x2="3292.5" y1="3424.8438" y2="3424.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3292.5" x2="3292.5" y1="3424.8438" y2="3437.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3251.5" x2="3292.5" y1="3437.8438" y2="3437.8438"/><polygon fill="#A80036" points="3261.5,3433.8438,3251.5,3437.8438,3261.5,3441.8438,3257.5,3437.8438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3257.5" y="3419.7778">AUTHENTICATION-43</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="3409.5" y="3419.7778">consentResponseRecieved()</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="219" x="3255" y="3450.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="3259" y="3466.9106">state: consentResponseRecieved</text><polygon fill="#A80036" points="3744.5,3496.1094,3754.5,3500.1094,3744.5,3504.1094,3748.5,3500.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3250.5" x2="3750.5" y1="3500.1094" y2="3500.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3257.5" y="3495.0435">AUTHENTICATION-44</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="3409.5" y="3495.0435">Auth Service response recieved</text><polygon fill="#A80036" points="2035.5,3525.2422,2025.5,3529.2422,2035.5,3533.2422,2031.5,3529.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2029.5" x2="3244.5" y1="3529.2422" y2="3529.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2041.5" y="3524.1763">AUTHENTICATION-45</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2193.5" y="3524.1763">200 OK</text><polygon fill="#A80036" points="2796.5,3554.375,2806.5,3558.375,2796.5,3562.375,2800.5,3558.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2377.5" x2="2802.5" y1="3558.375" y2="3558.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2384.5" y="3553.3091">AUTHENTICATION-46</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="2536.5" y="3553.3091">POST /participants/CONSENTS/1a2b3c4d</text><polygon fill="#A80036" points="2383.5,3583.5078,2373.5,3587.5078,2383.5,3591.5078,2379.5,3587.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2377.5" x2="2807.5" y1="3587.5078" y2="3587.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2389.5" y="3582.4419">AUTHENTICATION-47</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2541.5" y="3582.4419">202 Accepted</text><polygon fill="#A80036" points="3228.5,3612.6406,3238.5,3616.6406,3228.5,3620.6406,3232.5,3616.6406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2818.5" x2="3234.5" y1="3616.6406" y2="3616.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2825.5" y="3611.5747">AUTHENTICATION-48</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="2977.5" y="3611.5747">PUT /participants/CONSENTS/1a2b3c4d</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3250.5" x2="3292.5" y1="3645.7734" y2="3645.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3292.5" x2="3292.5" y1="3645.7734" y2="3658.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3251.5" x2="3292.5" y1="3658.7734" y2="3658.7734"/><polygon fill="#A80036" points="3261.5,3654.7734,3251.5,3658.7734,3261.5,3662.7734,3257.5,3658.7734" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3257.5" y="3640.7075">AUTHENTICATION-49</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="3409.5" y="3640.7075">const model = await loadFromKVS({key: 1a2b3c4d})</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3250.5" x2="3292.5" y1="3687.9063" y2="3687.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3292.5" x2="3292.5" y1="3687.9063" y2="3700.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3251.5" x2="3292.5" y1="3700.9063" y2="3700.9063"/><polygon fill="#A80036" points="3261.5,3696.9063,3251.5,3700.9063,3261.5,3704.9063,3257.5,3700.9063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3257.5" y="3682.8403">AUTHENTICATION-50</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="3409.5" y="3682.8403">participantResponseRecieved()</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="243" x="3255" y="3713.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="3259" y="3729.9731">state: participantsResponseRecieved</text><polygon fill="#A80036" points="3744.5,3759.1719,3754.5,3763.1719,3744.5,3767.1719,3748.5,3763.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3250.5" x2="3750.5" y1="3763.1719" y2="3763.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3257.5" y="3758.106">AUTHENTICATION-51</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="3409.5" y="3758.106">Participant response recieved</text><polygon fill="#A80036" points="2824.5,3788.3047,2814.5,3792.3047,2824.5,3796.3047,2820.5,3792.3047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2818.5" x2="3244.5" y1="3792.3047" y2="3792.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2830.5" y="3787.2388">AUTHENTICATION-52</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2982.5" y="3787.2388">200 Accepted</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="253" x="3771" y="3805.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="245" x="3775" y="3821.3716">state: consentRegisteredAndValidated</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3766.5" x2="3808.5" y1="3854.5703" y2="3854.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3808.5" x2="3808.5" y1="3854.5703" y2="3867.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3767.5" x2="3808.5" y1="3867.5703" y2="3867.5703"/><polygon fill="#A80036" points="3777.5,3863.5703,3767.5,3867.5703,3777.5,3871.5703,3773.5,3867.5703" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3773.5" y="3849.5044">AUTHENTICATION-53</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="3925.5" y="3849.5044">model.finalizeConsent()</text><path d="M1983,3882.5703 L2060,3882.5703 L2060,3889.5703 L2050,3899.5703 L1983,3899.5703 L1983,3882.5703 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="279.3281" style="stroke:#000000;stroke-width:2.0;" width="1861" x="1983" y="3882.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="1998" y="3895.6372">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="116" x="2075" y="3894.7808">[for each scope in</text><text fill="#000000" font-family="monospace" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="105" x="2195" y="3894.7808">Consents.scopes</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="5" x="2300" y="3894.7808">]</text><polygon fill="#A80036" points="2035.5,3916.8359,2025.5,3920.8359,2035.5,3924.8359,2031.5,3920.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2029.5" x2="3755.5" y1="3920.8359" y2="3920.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2041.5" y="3915.77">AUTHENTICATION-54</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="376" x="2193.5" y="3915.77">POST /participants/THIRD_PARTY_LINK/dfsp.username.5678</text><polygon fill="#A80036" points="3744.5,3945.9688,3754.5,3949.9688,3744.5,3953.9688,3748.5,3949.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2024.5" x2="3750.5" y1="3949.9688" y2="3949.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2031.5" y="3944.9028">AUTHENTICATION-55</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2183.5" y="3944.9028">202 Accepted</text><polygon fill="#A80036" points="2801.5,3975.1016,2811.5,3979.1016,2801.5,3983.1016,2805.5,3979.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2024.5" x2="2807.5" y1="3979.1016" y2="3979.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2031.5" y="3974.0356">AUTHENTICATION-56</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="376" x="2183.5" y="3974.0356">POST /participants/THIRD_PARTY_LINK/dfsp.username.5678</text><polygon fill="#A80036" points="2035.5,4004.2344,2025.5,4008.2344,2035.5,4012.2344,2031.5,4008.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2029.5" x2="2812.5" y1="4008.2344" y2="4008.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2041.5" y="4003.1685">AUTHENTICATION-57</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="2193.5" y="4003.1685">202 Accepted</text><polygon fill="#A80036" points="2035.5,4033.3672,2025.5,4037.3672,2035.5,4041.3672,2031.5,4037.3672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2029.5" x2="2812.5" y1="4037.3672" y2="4037.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2041.5" y="4032.3013">AUTHENTICATION-58</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="402" x="2193.5" y="4032.3013">PUT /participants/THIRD_PARTY_LINK/dfsp.username.5678/error</text><polygon fill="#A80036" points="2801.5,4062.5,2811.5,4066.5,2801.5,4070.5,2805.5,4066.5" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2024.5" x2="2807.5" y1="4066.5" y2="4066.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2031.5" y="4061.4341">AUTHENTICATION-59</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2183.5" y="4061.4341">200 OK</text><polygon fill="#A80036" points="3233.5,4091.6328,3243.5,4095.6328,3233.5,4099.6328,3237.5,4095.6328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2024.5" x2="3239.5" y1="4095.6328" y2="4095.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2031.5" y="4090.5669">AUTHENTICATION-60</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="402" x="2183.5" y="4090.5669">PUT /participants/THIRD_PARTY_LINK/dfsp.username.5678/error</text><polygon fill="#A80036" points="2035.5,4120.7656,2025.5,4124.7656,2035.5,4128.7656,2031.5,4124.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2029.5" x2="3244.5" y1="4124.7656" y2="4124.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2041.5" y="4119.6997">AUTHENTICATION-61</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2193.5" y="4119.6997">200 OK</text><polygon fill="#A80036" points="3744.5,4149.8984,3754.5,4153.8984,3744.5,4157.8984,3748.5,4153.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3245.5" x2="3750.5" y1="4153.8984" y2="4153.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3252.5" y="4148.8325">AUTHENTICATION-62</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="3404.5" y="4148.8325">Participant response recieved</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3766.5" x2="3808.5" y1="4190.0313" y2="4190.0313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3808.5" x2="3808.5" y1="4190.0313" y2="4203.0313"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3767.5" x2="3808.5" y1="4203.0313" y2="4203.0313"/><polygon fill="#A80036" points="3777.5,4199.0313,3767.5,4203.0313,3777.5,4207.0313,3773.5,4203.0313" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="3773.5" y="4184.9653">AUTHENTICATION-63</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="3925.5" y="4184.9653">await Promise.all()</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="96" x="3771" y="4216.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="3775" y="4232.0981">state: errored</text><polygon fill="#A80036" points="2040.5,4261.2969,2030.5,4265.2969,2040.5,4269.2969,2036.5,4265.2969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2034.5" x2="3755.5" y1="4265.2969" y2="4265.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2046.5" y="4260.231">AUTHENTICATION-64</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="2198.5" y="4260.231">PUT /consents/1a2b3c4d/error</text><rect fill="#F08080" filter="url(#fg5x6ah2pljuy)" height="204" style="stroke:#A80036;stroke-width:1.0;" width="407" x="3344" y="4278.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="3348" y="4294.3638">PUT /consents/1a2b3c4d/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="3348" y="4309.4966">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="3348" y="4324.6294">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3348" y="4339.7622">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="3356" y="4354.895">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="3364" y="4370.0278">errorCode: '7200',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="368" x="3364" y="4385.1606">errorDescription: 'Generic Thirdparty account linking error'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="30" x="3356" y="4400.2935">} OR</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="3356" y="4415.4263">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="3364" y="4430.5591">errorCode: '7214',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="383" x="3364" y="4445.6919">errorDescription: 'Failed to register account links with oracle'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3356" y="4460.8247">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="3348" y="4475.9575">}</text><polygon fill="#A80036" points="3749.5,4505.1563,3759.5,4509.1563,3749.5,4513.1563,3753.5,4509.1563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="2029.5" x2="3755.5" y1="4509.1563" y2="4509.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="2036.5" y="4504.0903">AUTHENTICATION-65</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="2188.5" y="4504.0903">200 OK</text><polygon fill="#A80036" points="1555.5,4534.2891,1545.5,4538.2891,1555.5,4542.2891,1551.5,4538.2891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1549.5" x2="2018.5" y1="4538.2891" y2="4538.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1561.5" y="4533.2231">AUTHENTICATION-66</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="1713.5" y="4533.2231">PUT /consents/1a2b3c4d/error</text><polygon fill="#A80036" points="2012.5,4563.4219,2022.5,4567.4219,2012.5,4571.4219,2016.5,4567.4219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1544.5" x2="2018.5" y1="4567.4219" y2="4567.4219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1551.5" y="4562.356">AUTHENTICATION-67</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1703.5" y="4562.356">200 OK</text><polygon fill="#A80036" points="1045.5,4592.5547,1035.5,4596.5547,1045.5,4600.5547,1041.5,4596.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1039.5" x2="1538.5" y1="4596.5547" y2="4596.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="1051.5" y="4591.4888">AUTHENTICATION-68</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="1203.5" y="4591.4888">MojaloopFSPIOPError response recieved</text><rect fill="#FBFB77" filter="url(#fg5x6ah2pljuy)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="96" x="1039" y="4609.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1043" y="4625.6216">state: errored</text><polygon fill="#A80036" points="569.5,4654.8203,559.5,4658.8203,569.5,4662.8203,565.5,4658.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="563.5" x2="1028.5" y1="4658.8203" y2="4658.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="575.5" y="4653.7544">AUTHENTICATION-69</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="727.5" y="4653.7544">return MojaloopFSPIOPError</text><polygon fill="#A80036" points="72.5,4683.9531,62.5,4687.9531,72.5,4691.9531,68.5,4687.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="66.5" x2="552.5" y1="4687.9531" y2="4687.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="148" x="78.5" y="4682.8872">AUTHENTICATION-70</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="230.5" y="4682.8872">500 Internal Server Error ErrorInformationObject</text><!--MD5=[469fc4fae593b7cba42cb9acc29a0e64]
@startuml

title PISP Linking Error Scenarios Register Credential Phase

participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPLinkingModel" as PISP_LM
  participant "inbound-server" as PISP_TP_IN
end box
box "Mojaloop"
    participant Switch
    participant "Auth Service" as AUTH
    participant "Account Lookup Service" as ALS
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPLinkingModel" as DFSP_LM
end box
participant DFSPAuthorizeSimulator

== Authentication+Grant Consent+Register Credential ==
autonumber 1 "<b>AUTHENTICATION-#</b>"
rnote right of PISP
PISP has obtained authToken from end-user(OTP) or through a callback(Web).
end note
PISP -> PISP_TP_OUT: POST /linking/request-consent/6789/authenticate
rnote right of PISP #LightBlue
POST /linking/request-consent/6789/authenticate
{
  authToken: '123456'
}
end note

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await loadFromKVS({key: 6789})
rnote right of PISP_TP_OUT: state: webAuthenticationChannelResponseRecieved or OTPAuthenticationChannelResponseRecieved
PISP_TP_OUT -> PISP_LM: model.authenticate()

activate PISP_LM

PISP_LM -> PISP_LM: ThirdpartyRequests.patchConsentRequests()
PISP_LM -> Switch: PATCH /consentRequests/6789
rnote right of PISP_LM #LightBlue
PATCH /consentRequests/6789
FSIOP-Source: pispa
FSIOP-Destination: dfspa
{
  authToken: '124356'
}
end note

activate Switch
Switch - -> PISP_LM: 202 Accepted
deactivate PISP_LM
Switch -> DFSP_TP_IN: PATCH /consentRequests/6789
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
DFSP_TP_IN -> DFSP_TP_IN: const model = await loadFromKVS({key: 6789})
rnote right of DFSP_TP_IN: state: consentRequestValidatedAndStored
DFSP_TP_IN -> DFSP_LM: model.validateAuthToken()
deactivate DFSP_TP_IN
activate DFSP_LM

DFSP_LM -> DFSP_LM: DFSPBackendRequests.validateAuthToken()
rnote right of DFSP_LM #LightBlue
Do we need two backend endpoints for validating
web authTokens and OTP authTokens? Or is a DFSP expected to
validate both cases with one endpoint?

POST /validateAuthToken
{
  consentRequestId: '6789'
  authChannel: model.data.authChannel,
  authToken: '124356'
}
end note
rnote right of DFSP_LM: state: authTokenValidated

DFSP_LM -> DFSP_LM: const consentId = uuid()
DFSP_LM -> DFSP_LM: model.grantConsent()
DFSP_LM -> DFSP_LM: ThirdpartyRequests.postConsents()
rnote right of DFSP_LM: state: consentGranted
rnote right of DFSP_LM #LightBlue
It's important to save the model with the consentId from this point onwards!
Requests will not contain a consentRequestId in the upcoming requests.
This may require changing `PersistentModel` to have a secondary key it can
store the model with.
end note
DFSP_LM -> DFSP_LM: this.saveToKVS({key: '1a2b3c4d'})

DFSP_LM -> Switch: POST /consents
activate Switch

rnote left of DFSP_LM #LightBlue
POST /consents
FSIOP-Source: dfspa
FSIOP-Destination: pispa
{
  consentId: 1a2b3c4d
  consentRequestId: 6789
  scopes: model.data.scopes
}
end note
Switch - -> DFSP_LM: 202 ACCEPTED
deactivate DFSP_LM
Switch ->  PISP_TP_IN: POST /consents
activate PISP_TP_IN
PISP_TP_IN -> PISP_TP_IN: const model = await loadFromKVS({key: 6789})
PISP_TP_IN -> PISP_LM: model.registerCredential()
activate PISP_LM
PISP_TP_IN - -> Switch: 202 Accepted
deactivate PISP_TP_IN
deactivate Switch
rnote right of PISP_LM: state: consentRecieved
rnote right of PISP_LM #LightBlue
It's important to save the model with the consentId from this point onwards!
Requests will not contain a consentRequestId in the upcoming requests.
This may require changing `PersistentModel` to have a secondary key it can
store the model with.
end note
PISP_LM - -> PISP_LM: const challenge = deriveChallenge(consentRequest)
PISP_LM - -> PISP_LM: this.saveToKVS({key: '1a2b3c4d'})

PISP_LM -> PISP_LM: ThirdpartyRequests.putConsents()
rnote right of PISP_LM: state: signedConsentSent
PISP_LM -> Switch: PUT /consents/1a2b3c4d
activate Switch

rnote right of PISP_LM #LightBlue
PUT /consents/1a2b3c4d
FSIOP-Source: pispa
FSIOP-Destination: dfspa
{
  scopes: [{
    accountId: 'dfspa.username.1234',
    actions: ['accounts.getBalance', 'accounts.transfer'],
    accountId: 'dfspa.username.5678',
    actions: ['accounts.getBalance', 'accounts.transfer'],
  }],
  credential: {
    credentialType: "FIDO",
    status: "PENDING",
    payload: PublicKeyCredential
  }
}
end note

Switch - -> PISP_LM: 202 Accepted
deactivate PISP_LM
Switch -> DFSP_TP_IN: PUT /consents/1a2b3c4d
activate DFSP_TP_IN

DFSP_TP_IN -> DFSP_TP_IN: const model = await loadFromKVS({key: 1a2b3c4d})
rnote right of DFSP_TP_IN: state: signedConsentRecieved
DFSP_TP_IN -> DFSP_LM: model.validateSignedConsent()
activate DFSP_LM
rnote right of DFSP_TP_IN: state: pendingRegistrationAndValidation
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
deactivate DFSP_TP_IN
DFSP_LM -> DFSP_LM: Check signed consent.
rnote right of DFSP_LM #LightBlue
Does this need a backend request or can the scheme adapter check the consent.
end note
rnote right of DFSP_LM: state: signedConsentChecked
DFSP_LM-> DFSP_LM: model.validateWithAuthService()
DFSP_LM -> Switch: POST /consents/1a2b3c4d
activate Switch

rnote left of DFSP_LM #LightBlue
POST /consents/1a2b3c4d
FSIOP-Source: dfspa
FSIOP-Destination: central-auth
{
  scopes: [{
    accountId: 'dfspa.username.1234',
    actions: ['accounts.getBalance', 'accounts.transfer'],
    accountId: 'dfspa.username.5678',
    actions: ['accounts.getBalance', 'accounts.transfer'],
  }],
  credential: {
    credentialType: "FIDO",
    status: "PENDING",
    payload: PublicKeyCredential
  }
}
end note
Switch - -> DFSP_LM: 202 Accepted
DFSP_LM -> DFSP_LM: this.saveToKVS()
deactivate DFSP_LM

Switch -> AUTH: POST /consents/1a2b3c4d
activate AUTH
AUTH - -> Switch: 202 Accepted
AUTH -> AUTH: Check consent.
AUTH -> Switch: PUT /consents/1a2b3c4d

rnote left of AUTH #LightBlue
PUT /consents/1a2b3c4d
FSIOP-Source: central-auth
FSIOP-Destination: dfspa
{
  scopes: [{
    accountId: 'dfspa.username.1234',
    actions: ['accounts.getBalance', 'accounts.transfer'],
    accountId: 'dfspa.username.5678',
    actions: ['accounts.getBalance', 'accounts.transfer'],
  }],
  credential: {
    credentialType: "FIDO",
    status: "VERIFIED",
    payload: PublicKeyCredential
  }
}
end note

Switch - -> AUTH: 200 OK
Switch -> DFSP_TP_IN: PUT /consents/1a2b3c4d
activate DFSP_TP_IN
DFSP_TP_IN -> DFSP_TP_IN: const model = await loadFromKVS({key: 1a2b3c4d})
DFSP_TP_IN -> DFSP_TP_IN: consentResponseRecieved()
rnote right of DFSP_TP_IN: state: consentResponseRecieved
DFSP_TP_IN -> DFSP_LM: Auth Service response recieved
activate DFSP_LM
DFSP_TP_IN - -> Switch: 200 OK
deactivate Switch
deactivate DFSP_TP_IN

AUTH -> ALS: POST /participants/CONSENTS/1a2b3c4d
activate ALS
ALS - -> AUTH: 202 Accepted
deactivate AUTH

ALS -> DFSP_TP_IN: PUT /participants/CONSENTS/1a2b3c4d
activate DFSP_TP_IN
DFSP_TP_IN -> DFSP_TP_IN: const model = await loadFromKVS({key: 1a2b3c4d})
DFSP_TP_IN -> DFSP_TP_IN: participantResponseRecieved()
rnote right of DFSP_TP_IN: state: participantsResponseRecieved
DFSP_TP_IN -> DFSP_LM: Participant response recieved
DFSP_TP_IN - -> ALS: 200 Accepted
deactivate ALS
deactivate DFSP_TP_IN
rnote right of DFSP_LM: state: consentRegisteredAndValidated
DFSP_LM -> DFSP_LM: model.finalizeConsent()

loop for each scope in ""Consents.scopes""
DFSP_LM -> Switch: POST /participants/THIRD_PARTY_LINK/dfsp.username.5678
Switch - -> DFSP_LM: 202 Accepted
Switch -> ALS: POST /participants/THIRD_PARTY_LINK/dfsp.username.5678
ALS - -> Switch: 202 Accepted
ALS -> Switch: PUT /participants/THIRD_PARTY_LINK/dfsp.username.5678/error
Switch - -> ALS: 200 OK
Switch -> DFSP_TP_IN: PUT /participants/THIRD_PARTY_LINK/dfsp.username.5678/error
DFSP_TP_IN - -> Switch: 200 OK
DFSP_TP_IN -> DFSP_LM: Participant response recieved
end

DFSP_LM -> DFSP_LM: await Promise.all()
rnote right of DFSP_LM: state: errored
DFSP_LM -> Switch: PUT /consents/1a2b3c4d/error
activate Switch

rnote left of DFSP_LM #LightCoral
PUT /consents/1a2b3c4d/error
FSIOP-Source: dfspa
FSIOP-Destination: pispa
{
  errorInformation: {
    errorCode: '7200',
    errorDescription: 'Generic Thirdparty account linking error'
  } OR
  errorInformation: {
    errorCode: '7214',
    errorDescription: 'Failed to register account links with oracle'
  }
}
end note
Switch - -> DFSP_LM: 200 OK
deactivate DFSP_LM
Switch ->  PISP_TP_IN: PUT /consents/1a2b3c4d/error
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
PISP_TP_IN - -> PISP_LM: MojaloopFSPIOPError response recieved
deactivate PISP_TP_IN
activate PISP_LM
rnote right of PISP_LM: state: errored
PISP_LM -> PISP_TP_OUT: return MojaloopFSPIOPError
deactivate PISP_LM
PISP_TP_OUT - -> PISP: 500 Internal Server Error ErrorInformationObject
deactivate PISP_TP_OUT
deactivate PISP
@enduml

PlantUML version 1.2021.00(Sun Jan 10 05:25:05 EST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>