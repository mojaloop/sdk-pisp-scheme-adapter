<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="5434px" preserveAspectRatio="none" style="width:4318px;height:5434px;" version="1.1" viewBox="0 0 4318 5434" width="4318px" zoomAndPan="magnify"><defs><filter height="300%" id="fmh3e2hlgqzvt" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="142" x="2084.75" y="29.4023">PISP Transaction</text><rect fill="#DDDDDD" height="5387.3613" style="stroke:#A80036;stroke-width:1.0;" width="1015" x="471.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="166" x="896" y="53.7676">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="5387.3613" style="stroke:#A80036;stroke-width:1.0;" width="469" x="1488.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="176" x="1635" y="53.7676">PISP sdk-scheme-adapter</text><rect fill="#DDDDDD" height="5387.3613" style="stroke:#A80036;stroke-width:1.0;" width="70" x="1959.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="1964" y="53.7676">Mojaloop</text><rect fill="#DDDDDD" height="5387.3613" style="stroke:#A80036;stroke-width:1.0;" width="572" x="2279.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="181" x="2475" y="53.7676">DFSP sdk-scheme-adapter</text><rect fill="#DDDDDD" height="5387.3613" style="stroke:#A80036;stroke-width:1.0;" width="1106" x="3137.5" y="41.1992"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="171" x="3605" y="53.7676">DFSP tp-scheme-adapter</text><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="297.7949" style="stroke:#A80036;stroke-width:1.0;" width="10" x="67.5" y="341.7246"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="2225.6016" style="stroke:#A80036;stroke-width:1.0;" width="10" x="67.5" y="1077.3066"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="1848.0801" style="stroke:#A80036;stroke-width:1.0;" width="10" x="67.5" y="3523.9922"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="297.7949" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="341.7246"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="2225.6016" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="1077.3066"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="1848.0801" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="3523.9922"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="239.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="371.0352"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="134.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="1106.6172"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="68.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="2084.2441"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="125.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="3147.666"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="134.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="3553.3027"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="62.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="4423.377"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="62.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="5280.1406"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="127.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1414.5" y="2025.623"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="88.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1414.5" y="3089.0449"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="97.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1414.5" y="4325.4453"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="58.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1414.5" y="5221.5195"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1555.5" y="475.9668"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="160.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1989.5" y="1211.5488"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1989.5" y="1967.002"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="130.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1989.5" y="2988.1133"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="121.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1989.5" y="3658.2344"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="127.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1989.5" y="4227.5137"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="160.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1989.5" y="5090.2773"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2341.5" y="3750.166"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2774.5" y="2557.7656"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="179.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2774.5" y="2873.5605"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2774.5" y="3808.7871"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2774.5" y="4874.4141"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="97.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3199.5" y="1342.791"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="1870.1855" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3460.5" y="1440.7227"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3460.5" x2="3460.5" y1="1440.7227" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3470.5" y1="1440.7227" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3460.5" x2="3470.5" y1="1440.7227" y2="1440.7227"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="1754.7695" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3460.5" y="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3460.5" x2="3460.5" y1="3364.8184" y2="5119.5879"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3470.5" y1="3364.8184" y2="5119.5879"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3460.5" x2="3470.5" y1="5119.5879" y2="5119.5879"/><line style="stroke:#A80036;stroke-width:1.0;" x1="72" x2="72" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="72" x2="72" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="72" x2="72" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="72" x2="72" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="72" x2="72" y1="3364.8184" y2="5390.0723"/><line style="stroke:#A80036;stroke-width:1.0;" x1="543.5" x2="543.5" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="543.5" x2="543.5" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="543.5" x2="543.5" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="543.5" x2="543.5" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="543.5" x2="543.5" y1="3364.8184" y2="5390.0723"/><line style="stroke:#A80036;stroke-width:1.0;" x1="886" x2="886" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="886" x2="886" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="886" x2="886" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="886" x2="886" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="886" x2="886" y1="3364.8184" y2="5390.0723"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1419.5" x2="1419.5" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1419.5" x2="1419.5" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1419.5" x2="1419.5" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1419.5" x2="1419.5" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1419.5" x2="1419.5" y1="3364.8184" y2="5390.0723"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1560.5" x2="1560.5" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1560.5" x2="1560.5" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1560.5" x2="1560.5" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1560.5" x2="1560.5" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1560.5" x2="1560.5" y1="3364.8184" y2="5390.0723"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1890.5" x2="1890.5" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1890.5" x2="1890.5" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1890.5" x2="1890.5" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1890.5" x2="1890.5" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1890.5" x2="1890.5" y1="3364.8184" y2="5390.0723"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1994.5" x2="1994.5" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1994.5" x2="1994.5" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1994.5" x2="1994.5" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1994.5" x2="1994.5" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1994.5" x2="1994.5" y1="3364.8184" y2="5390.0723"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2346.5" x2="2346.5" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2346.5" x2="2346.5" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2346.5" x2="2346.5" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2346.5" x2="2346.5" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2346.5" x2="2346.5" y1="3364.8184" y2="5390.0723"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2779.5" x2="2779.5" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2779.5" x2="2779.5" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2779.5" x2="2779.5" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="2779.5" x2="2779.5" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2779.5" x2="2779.5" y1="3364.8184" y2="5390.0723"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3204.5" x2="3204.5" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3204.5" x2="3204.5" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3204.5" x2="3204.5" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3204.5" x2="3204.5" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3204.5" x2="3204.5" y1="3364.8184" y2="5390.0723"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3465" x2="3465" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3465" x2="3465" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3465" x2="3465" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="3465" x2="3465" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3465" x2="3465" y1="3364.8184" y2="5390.0723"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4171.5" x2="4171.5" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4171.5" x2="4171.5" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4171.5" x2="4171.5" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4171.5" x2="4171.5" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4171.5" x2="4171.5" y1="3364.8184" y2="5390.0723"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4277.5" x2="4277.5" y1="95.998" y2="647.5195"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4277.5" x2="4277.5" y1="647.5195" y2="688.4746"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4277.5" x2="4277.5" y1="688.4746" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="4277.5" x2="4277.5" y1="3310.9082" y2="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="4277.5" x2="4277.5" y1="3364.8184" y2="5390.0723"/><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="103" x="19" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="26" y="81.0449">PISP Backend</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="103" x="19" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="26" y="5409.6074">PISP Backend</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="475.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="482.5" y="81.0449">outbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="475.5" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="482.5" y="5409.6074">outbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="165" x="802" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151" x="809" y="81.0449">PISPTransactionModel</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="165" x="802" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151" x="809" y="5409.6074">PISPTransactionModel</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="1356.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1363.5" y="81.0449">inbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="1356.5" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1363.5" y="5409.6074">inbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="1492.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="1499.5" y="81.0449">outbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="1492.5" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="1499.5" y="5409.6074">outbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="1827.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1834.5" y="81.0449">inbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="1827.5" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="1834.5" y="5409.6074">inbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="58" x="1963.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="1970.5" y="81.0449">Switch</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="58" x="1963.5" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="1970.5" y="5409.6074">Switch</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="2283.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="2290.5" y="81.0449">inbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="2283.5" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="2290.5" y="5409.6074">inbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="2711.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="2718.5" y="81.0449">outbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="2711.5" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="2718.5" y="5409.6074">outbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="3141.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="3148.5" y="81.0449">inbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="122" x="3141.5" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="3148.5" y="5409.6074">inbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="171" x="3378" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="3385" y="81.0449">DFSPTransactionModel</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="171" x="3378" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="157" x="3385" y="5409.6074">DFSPTransactionModel</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="4103.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="4110.5" y="81.0449">outbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="132" x="4103.5" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="118" x="4110.5" y="5409.6074">outbound-server</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="53" x="4249.5" y="60.5098"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="4256.5" y="81.0449">Swich</text><rect fill="#FEFECE" filter="url(#fmh3e2hlgqzvt)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="53" x="4249.5" y="5389.0723"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39" x="4256.5" y="5409.6074">Swich</text><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="297.7949" style="stroke:#A80036;stroke-width:1.0;" width="10" x="67.5" y="341.7246"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="2225.6016" style="stroke:#A80036;stroke-width:1.0;" width="10" x="67.5" y="1077.3066"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="1848.0801" style="stroke:#A80036;stroke-width:1.0;" width="10" x="67.5" y="3523.9922"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="297.7949" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="341.7246"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="2225.6016" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="1077.3066"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="1848.0801" style="stroke:#A80036;stroke-width:1.0;" width="10" x="538.5" y="3523.9922"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="239.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="371.0352"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="134.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="1106.6172"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="68.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="2084.2441"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="125.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="3147.666"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="134.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="3553.3027"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="62.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="4423.377"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="62.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="881.5" y="5280.1406"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="127.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1414.5" y="2025.623"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="88.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1414.5" y="3089.0449"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="97.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1414.5" y="4325.4453"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="58.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1414.5" y="5221.5195"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1555.5" y="475.9668"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="160.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1989.5" y="1211.5488"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1989.5" y="1967.002"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="130.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1989.5" y="2988.1133"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="121.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1989.5" y="3658.2344"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="127.2422" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1989.5" y="4227.5137"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="160.5527" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1989.5" y="5090.2773"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="87.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2341.5" y="3750.166"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2774.5" y="2557.7656"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="179.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2774.5" y="2873.5605"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2774.5" y="3808.7871"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="71.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="2774.5" y="4874.4141"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="97.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="3199.5" y="1342.791"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="1870.1855" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3460.5" y="1440.7227"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3460.5" x2="3460.5" y1="1440.7227" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3470.5" y1="1440.7227" y2="3310.9082"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3460.5" x2="3470.5" y1="1440.7227" y2="1440.7227"/><rect fill="#FFFFFF" filter="url(#fmh3e2hlgqzvt)" height="1754.7695" style="stroke:#FFFFFF;stroke-width:1.0;" width="10" x="3460.5" y="3364.8184"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3460.5" x2="3460.5" y1="3364.8184" y2="5119.5879"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3470.5" y1="3364.8184" y2="5119.5879"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3460.5" x2="3470.5" y1="5119.5879" y2="5119.5879"/><rect fill="#EEEEEE" filter="url(#fmh3e2hlgqzvt)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4311.5" x="0" y="126.6533"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4311.5" y1="126.6533" y2="126.6533"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4311.5" y1="129.6533" y2="129.6533"/><rect fill="#EEEEEE" filter="url(#fmh3e2hlgqzvt)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="107" x="2102.25" y="115.998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="2108.25" y="132.5664">Party Lookup</text><rect fill="#ADD8E6" filter="url(#fmh3e2hlgqzvt)" height="161" style="stroke:#A80036;stroke-width:1.0;" width="221" x="77" y="154.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="81" y="170.877">POST /thirdpartyTransactions</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="81" y="186.1875">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="89" y="201.498">transactionRequestId: "12345",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="48" x="89" y="216.8086">payee: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="97" y="232.1191">partyIdInfo: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="105" y="247.4297">partyIdType: "MSISDN",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="105" y="262.7402">partyIdentifier: "+123456789"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="97" y="278.0508">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="89" y="293.3613">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="81" y="308.6719">}</text><polygon fill="#A80036" points="526.5,337.7246,536.5,341.7246,526.5,345.7246,530.5,341.7246" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="77.5" x2="532.5" y1="341.7246" y2="341.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="84.5" y="336.9824">LOOK-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="144.5" y="336.9824">POST /thirdpartyTransactions</text><polygon fill="#A80036" points="869.5,367.0352,879.5,371.0352,869.5,375.0352,873.5,371.0352" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="548.5" x2="875.5" y1="371.0352" y2="371.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="555.5" y="366.293">LOOK-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="615.5" y="366.293">partyLookup()</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="172" x="896" y="384.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="900" y="400.6035">state: requestPartyLookup</text><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="933.5" y1="433.6563" y2="433.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="933.5" x2="933.5" y1="433.6563" y2="446.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="892.5" x2="933.5" y1="446.6563" y2="446.6563"/><polygon fill="#A80036" points="902.5,442.6563,892.5,446.6563,902.5,450.6563,898.5,446.6563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="898.5" y="428.9141">LOOK-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="958.5" y="428.9141">SDKRequest.requestPartiesInformation</text><polygon fill="#A80036" points="1543.5,471.9668,1553.5,475.9668,1543.5,479.9668,1547.5,475.9668" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="1549.5" y1="475.9668" y2="475.9668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="898.5" y="471.2246">LOOK-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="958.5" y="471.2246">SYNC GET /parties/{type}/{id}</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1565.5" x2="1607.5" y1="505.2773" y2="505.2773"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1607.5" x2="1607.5" y1="505.2773" y2="518.2773"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1566.5" x2="1607.5" y1="518.2773" y2="518.2773"/><polygon fill="#A80036" points="1576.5,514.2773,1566.5,518.2773,1576.5,522.2773,1572.5,518.2773" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="1572.5" y="500.5352">LOOK-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="1632.5" y="500.5352">retrieve PartiesInformation from Switch</text><polygon fill="#A80036" points="902.5,543.5879,892.5,547.5879,902.5,551.5879,898.5,547.5879" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="896.5" x2="1559.5" y1="547.5879" y2="547.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="908.5" y="542.8457">LOOK-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="133" x="968.5" y="542.8457">200 PartyInformation</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="139" x="896" y="560.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="900" y="577.1563">state: payeeResolved</text><polygon fill="#A80036" points="559.5,606.209,549.5,610.209,559.5,614.209,555.5,610.209" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="553.5" x2="885.5" y1="610.209" y2="610.209"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="565.5" y="605.4668">LOOK-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="625.5" y="605.4668">partyInformation</text><polygon fill="#A80036" points="83.5,635.5195,73.5,639.5195,83.5,643.5195,79.5,639.5195" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="77.5" x2="542.5" y1="639.5195" y2="639.5195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="89.5" y="634.7773">LOOK-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="155" x="149.5" y="634.7773">200 OK PartyInformation</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="353" x="1998.75" y="672.1543">User checks the party name, and confirms transaction to continue</text><rect fill="#EEEEEE" filter="url(#fmh3e2hlgqzvt)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4311.5" x="0" y="709.1299"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4311.5" y1="709.1299" y2="709.1299"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4311.5" y1="712.1299" y2="712.1299"/><rect fill="#EEEEEE" filter="url(#fmh3e2hlgqzvt)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="145" x="2083.25" y="698.4746"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="127" x="2089.25" y="715.043">Initate Transaction</text><rect fill="#ADD8E6" filter="url(#fmh3e2hlgqzvt)" height="314" style="stroke:#A80036;stroke-width:1.0;" width="393" x="77" y="736.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="81" y="753.3535">POST /thirdpartyTransactions/{transactionRequestId}/initiate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="81" y="768.6641">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="60" x="89" y="783.9746">amount: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="97" y="799.2852">amount: "20.00",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="97" y="814.5957">currency: "USD"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="89" y="829.9063">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="89" y="845.2168">"amountType": "SEND",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="82" x="89" y="860.5273">"payee": {....},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="56" x="89" y="875.8379">"payer": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="229" x="97" y="891.1484">"partyIdType": "THIRD_PARTY_LINK",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="97" y="906.459">"partyIdentifier": "qwerty-56789",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="97" y="921.7695">"fspId": "dfspa"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="89" y="937.0801">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="89" y="952.3906">"transactionType": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="97" y="967.7012">"scenario": "TRANSFER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="97" y="983.0117">"initiator": 'PAYER",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179" x="97" y="998.3223">"initiatorType": "CONSUMER"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="89" y="1013.6328">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298" x="89" y="1028.9434">expiration: "2021-03-08T08:08:08.699-04:00"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="81" y="1044.2539">}</text><polygon fill="#A80036" points="526.5,1073.3066,536.5,1077.3066,526.5,1081.3066,530.5,1077.3066" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="77.5" x2="532.5" y1="1077.3066" y2="1077.3066"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="84.5" y="1072.5645">INIT-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="385" x="132.5" y="1072.5645">POST /thirdpartyTransactions/{transactionRequestId}/initiate</text><polygon fill="#A80036" points="869.5,1102.6172,879.5,1106.6172,869.5,1110.6172,873.5,1106.6172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="548.5" x2="875.5" y1="1106.6172" y2="1106.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="555.5" y="1101.875">INIT-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="603.5" y="1101.875">initiate()</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="233" x="896" y="1119.6172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="900" y="1136.1855">state: requestThirdpartyTransaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="933.5" y1="1169.2383" y2="1169.2383"/><line style="stroke:#A80036;stroke-width:1.0;" x1="933.5" x2="933.5" y1="1169.2383" y2="1182.2383"/><line style="stroke:#A80036;stroke-width:1.0;" x1="892.5" x2="933.5" y1="1182.2383" y2="1182.2383"/><polygon fill="#A80036" points="902.5,1178.2383,892.5,1182.2383,902.5,1186.2383,898.5,1182.2383" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="898.5" y="1164.4961">INIT-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="273" x="946.5" y="1164.4961">SDKRequest.requestThirdpartyTransaction()</text><polygon fill="#A80036" points="1977.5,1207.5488,1987.5,1211.5488,1977.5,1215.5488,1981.5,1211.5488" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="1983.5" y1="1211.5488" y2="1211.5488"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="898.5" y="1206.8066">INIT-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="946.5" y="1206.8066">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="897.5,1236.8594,887.5,1240.8594,897.5,1244.8594,893.5,1240.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="891.5" x2="1988.5" y1="1240.8594" y2="1240.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="903.5" y="1236.1172">INIT-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="951.5" y="1236.1172">202 Accepted</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="229" x="891" y="1253.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="895" y="1270.4277">state: pendingTransactionInitiation</text><path d="M3072,1287.1699 L3072,1312.1699 L3332,1312.1699 L3332,1297.1699 L3322,1287.1699 L3072,1287.1699 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3322,1287.1699 L3322,1297.1699 L3332,1297.1699 L3322,1287.1699 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="3078" y="1304.7383">DFSP handles PISP transaction request</text><polygon fill="#A80036" points="3187.5,1338.791,3197.5,1342.791,3187.5,1346.791,3191.5,1342.791" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1999.5" x2="3193.5" y1="1342.791" y2="1342.791"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="2006.5" y="1338.0488">INIT-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="2054.5" y="1338.0488">POST /thirdpartyRequests/transactions</text><polygon fill="#A80036" points="2005.5,1368.1016,1995.5,1372.1016,2005.5,1376.1016,2001.5,1372.1016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1999.5" x2="3198.5" y1="1372.1016" y2="1372.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="2011.5" y="1367.3594">INIT-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="2059.5" y="1367.3594">202 Accepted</text><path d="M3302,1385.1016 L3302,1410.1016 L3625,1410.1016 L3625,1395.1016 L3615,1385.1016 L3302,1385.1016 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3615,1385.1016 L3615,1395.1016 L3625,1395.1016 L3615,1385.1016 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="3308" y="1402.6699">DFSP starts workflow for DFSPTransactionModel</text><polygon fill="#A80036" points="3448.5,1436.7227,3458.5,1440.7227,3448.5,1444.7227,3452.5,1440.7227" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3204.5" x2="3454.5" y1="1440.7227" y2="1440.7227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="3211.5" y="1435.9805">INIT-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="3259.5" y="1435.9805">transactionRequestReceived()</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="256" x="3475" y="1453.7227"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="3479" y="1470.291">state: transactionRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="3479" y="1485.6016">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="11" x="3647" y="1485.6016">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="3662" y="1485.6016">RECEIVED</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="1518.6543" y2="1518.6543"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="1518.6543" y2="1531.6543"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="1531.6543" y2="1531.6543"/><polygon fill="#A80036" points="3481.5,1527.6543,3471.5,1531.6543,3481.5,1535.6543,3477.5,1531.6543" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="3477.5" y="1513.9121">INIT-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358" x="3525.5" y="1513.9121">persist transactionRequestState for transactionRequestId</text><path d="M3223,1544.6543 L3223,1569.6543 L3704,1569.6543 L3704,1554.6543 L3694,1544.6543 L3223,1544.6543 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3694,1544.6543 L3694,1554.6543 L3704,1554.6543 L3694,1544.6543 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="460" x="3229" y="1562.2227">DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="1600.2754" y2="1600.2754"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="1600.2754" y2="1613.2754"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="1613.2754" y2="1613.2754"/><polygon fill="#A80036" points="3481.5,1609.2754,3471.5,1613.2754,3481.5,1617.2754,3477.5,1613.2754" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3477.5" y="1595.5332">INIT-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="307" x="3534.5" y="1595.5332">PISPBackendRequest.verifyConsent(pispId, payer)</text><path d="M3365,1626.2754 L3365,1651.2754 L3561,1651.2754 L3561,1636.2754 L3551,1626.2754 L3365,1626.2754 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3551,1626.2754 L3551,1636.2754 L3561,1636.2754 L3551,1626.2754 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="3371" y="1643.8438">DFSP is happy with Consent</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="139" x="3475" y="1665.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="3479" y="1682.1543">state: consentIsValid</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="1715.207" y2="1715.207"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="1715.207" y2="1728.207"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="1728.207" y2="1728.207"/><polygon fill="#A80036" points="3481.5,1724.207,3471.5,1728.207,3481.5,1732.207,3477.5,1728.207" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3477.5" y="1710.4648">INIT-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="73" x="3534.5" y="1710.4648">so generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="3611.5" y="1710.4648">transactionId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="3700.5" y="1710.4648">: '1234-1234-1234-1234'</text><path d="M3275,1741.207 L3275,1766.207 L3652,1766.207 L3652,1751.207 L3642,1741.207 L3275,1741.207 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3642,1741.207 L3642,1751.207 L3652,1751.207 L3642,1741.207 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="3281" y="1758.7754">DFSP informs PISP that</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="3427" y="1758.7754">transactionId</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="3520" y="1758.7754">has been allocated</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="1796.8281" y2="1796.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="1796.8281" y2="1809.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="1809.8281" y2="1809.8281"/><polygon fill="#A80036" points="3481.5,1805.8281,3471.5,1809.8281,3481.5,1813.8281,3477.5,1809.8281" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3477.5" y="1792.0859">INIT-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="625" x="3534.5" y="1792.0859">SDKRequest.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="395" x="3475" y="1822.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="387" x="3479" y="1839.3965">state: pendingNotifyThirdpartyAboutTransactionRequestState</text><rect fill="#ADD8E6" filter="url(#fmh3e2hlgqzvt)" height="84" style="stroke:#A80036;stroke-width:1.0;" width="388" x="3475" y="1856.1387"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="380" x="3479" y="1872.707">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="3479" y="1888.0176">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="3487" y="1903.3281">transactionId: '1234-1234-1234-1234',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="3487" y="1918.6387">transactionRequestState: 'RECEIVED'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="3479" y="1933.9492">}</text><polygon fill="#A80036" points="2010.5,1963.002,2000.5,1967.002,2010.5,1971.002,2006.5,1967.002" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2004.5" x2="3459.5" y1="1967.002" y2="1967.002"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2016.5" y="1962.2598">INIT-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="380" x="2073.5" y="1962.2598">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><polygon fill="#A80036" points="3448.5,1992.3125,3458.5,1996.3125,3448.5,2000.3125,3452.5,1996.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1999.5" x2="3454.5" y1="1996.3125" y2="1996.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2006.5" y="1991.5703">INIT-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="2063.5" y="1991.5703">202 Accepted</text><polygon fill="#A80036" points="1435.5,2021.623,1425.5,2025.623,1435.5,2029.623,1431.5,2025.623" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1429.5" x2="1988.5" y1="2025.623" y2="2025.623"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="1441.5" y="2020.8809">INIT-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="380" x="1498.5" y="2020.8809">PUT /thirdpartyRequests/transaction/{transactionRequestId}</text><polygon fill="#A80036" points="1982.5,2050.9336,1992.5,2054.9336,1982.5,2058.9336,1986.5,2054.9336" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1424.5" x2="1988.5" y1="2054.9336" y2="2054.9336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="1431.5" y="2050.1914">INIT-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="1488.5" y="2050.1914">202 accepted</text><polygon fill="#A80036" points="902.5,2080.2441,892.5,2084.2441,902.5,2088.2441,898.5,2084.2441" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="896.5" x2="1413.5" y1="2084.2441" y2="2084.2441"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="908.5" y="2079.502">INIT-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="965.5" y="2079.502">transactionRequestReceived()</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="223" x="896" y="2097.2441"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="215" x="900" y="2113.8125">state: transactionRequestReceived</text><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="933.5" y1="2151.8652" y2="2151.8652"/><line style="stroke:#A80036;stroke-width:1.0;" x1="933.5" x2="933.5" y1="2151.8652" y2="2164.8652"/><line style="stroke:#A80036;stroke-width:1.0;" x1="886.5" x2="933.5" y1="2164.8652" y2="2164.8652"/><polygon fill="#A80036" points="896.5,2160.8652,886.5,2164.8652,896.5,2168.8652,892.5,2164.8652" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="898.5" y="2147.123">INIT-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="955.5" y="2147.123">store received</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="1047.5" y="2147.123">transactionId</text><path d="M633,2172.8652 L633,2411.8652 L1135,2411.8652 L1135,2182.8652 L1125,2172.8652 L633,2172.8652 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1125,2172.8652 L1125,2182.8652 L1135,2182.8652 L1125,2172.8652 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="325" x="639" y="2190.4336">There could be a race condition (time based hazard)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="639" y="2205.7441">between two incoming calls</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="643" y="2221.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="282" x="639" y="2236.3652">PUT /thirdpartyReqeusts/transaction/{id}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="639" y="2251.6758">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="137" x="639" y="2266.9863">POST /authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="643" y="2282.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="368" x="639" y="2297.6074">so we are mitigating it by alternative two-step transitions:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="643" y="2312.918"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238" x="639" y="2328.2285">pendingTransactionInitiation (START):</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="473" x="647" y="2343.5391">-&gt; (CASE-1) transactionRequestReceived -&gt; authorizationRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="473" x="647" y="2358.8496">-&gt; (CASE-2) authorizationRequestReceived -&gt; transactionRequestReceived</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="639" y="2374.1602">-&gt; transactionInitiationSuccess (END)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="643" y="2389.4707"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="639" y="2404.7813">CASE-1 is visualised here</text><path d="M3352,2426.5234 L3352,2451.5234 L3575,2451.5234 L3575,2436.5234 L3565,2426.5234 L3352,2426.5234 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3565,2426.5234 L3565,2436.5234 L3575,2436.5234 L3565,2426.5234 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="3358" y="2444.0918">DFSP requires QuoteInformation</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="2482.1445" y2="2482.1445"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="2482.1445" y2="2495.1445"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="2495.1445" y2="2495.1445"/><polygon fill="#A80036" points="3481.5,2491.1445,3471.5,2495.1445,3481.5,2499.1445,3477.5,2495.1445" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3477.5" y="2477.4023">INIT-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="3534.5" y="2477.4023">SDKRequest.requestQuote()</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="186" x="3475" y="2508.1445"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="3479" y="2524.7129">state: pendingRequestQuote</text><polygon fill="#A80036" points="2795.5,2553.7656,2785.5,2557.7656,2795.5,2561.7656,2791.5,2557.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2789.5" x2="3459.5" y1="2557.7656" y2="2557.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2801.5" y="2553.0234">INIT-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="2858.5" y="2553.0234">SYNC POST /quotes</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2784.5" x2="2826.5" y1="2587.0762" y2="2587.0762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2826.5" x2="2826.5" y1="2587.0762" y2="2600.0762"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2785.5" x2="2826.5" y1="2600.0762" y2="2600.0762"/><polygon fill="#A80036" points="2795.5,2596.0762,2785.5,2600.0762,2795.5,2604.0762,2791.5,2600.0762" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2791.5" y="2582.334">INIT-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="2848.5" y="2582.334">retrieve QuoteInformation from Switch</text><polygon fill="#A80036" points="3448.5,2625.3867,3458.5,2629.3867,3448.5,2633.3867,3452.5,2629.3867" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2779.5" x2="3454.5" y1="2629.3867" y2="2629.3867"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2786.5" y="2624.6445">INIT-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="2843.5" y="2624.6445">200 QuoteInformation</text><path d="M3214,2642.3867 L3214,2667.3867 L3712,2667.3867 L3712,2652.3867 L3702,2642.3867 L3214,2642.3867 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3702,2642.3867 L3702,2652.3867 L3712,2652.3867 L3702,2642.3867 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="477" x="3220" y="2659.9551">DFSP has the QuoteInformation, they can now ask the PISP for authorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="2698.0078" y2="2698.0078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="2698.0078" y2="2711.0078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="2711.0078" y2="2711.0078"/><polygon fill="#A80036" points="3481.5,2707.0078,3471.5,2711.0078,3481.5,2715.0078,3477.5,2711.0078" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3477.5" y="2693.2656">INIT-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="3534.5" y="2693.2656">requestAuthorization()</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="251" x="3475" y="2724.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="3479" y="2740.5762">state: pendingRequestAuthorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="3479" y="2755.8867">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="11" x="3647" y="2755.8867">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="60" x="3662" y="2755.8867">PENDING</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="2788.9395" y2="2788.9395"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="2788.9395" y2="2801.9395"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="2801.9395" y2="2801.9395"/><polygon fill="#A80036" points="3481.5,2797.9395,3471.5,2801.9395,3481.5,2805.9395,3477.5,2801.9395" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3477.5" y="2784.1973">INIT-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358" x="3534.5" y="2784.1973">persist transactionRequestState for transactionRequestId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="2831.25" y2="2831.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="2831.25" y2="2844.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="2844.25" y2="2844.25"/><polygon fill="#A80036" points="3481.5,2840.25,3471.5,2844.25,3481.5,2848.25,3477.5,2844.25" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="3477.5" y="2826.5078">INIT-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="332" x="3534.5" y="2826.5078">SDKRequest.requestAuthorization(QuoteInformation)</text><polygon fill="#A80036" points="2795.5,2869.5605,2785.5,2873.5605,2795.5,2877.5605,2791.5,2873.5605" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2789.5" x2="3459.5" y1="2873.5605" y2="2873.5605"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2801.5" y="2868.8184">INIT-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="2858.5" y="2868.8184">SYNC POST /authorization</text><path d="M3295,2886.5605 L3295,2957.5605 L3631,2957.5605 L3631,2896.5605 L3621,2886.5605 L3295,2886.5605 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3621,2886.5605 L3621,2896.5605 L3631,2896.5605 L3621,2886.5605 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="278" x="3301" y="2904.1289">From now DFSPTransactionModel is blocked</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282" x="3301" y="2919.4395">on synchronous call to POST /authorizations</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="3301" y="2934.75">until PISP initiate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="142" x="3411" y="2934.75">Approve Transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="3557" y="2934.75">phase.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="315" x="3301" y="2950.0605">Here timeout scenario should be handled properly</text><polygon fill="#A80036" points="2010.5,2984.1133,2000.5,2988.1133,2010.5,2992.1133,2006.5,2988.1133" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2004.5" x2="2773.5" y1="2988.1133" y2="2988.1133"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2016.5" y="2983.3711">INIT-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="2073.5" y="2983.3711">POST /authorizations</text><polygon fill="#A80036" points="2762.5,3013.4238,2772.5,3017.4238,2762.5,3021.4238,2766.5,3017.4238" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1999.5" x2="2768.5" y1="3017.4238" y2="3017.4238"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2006.5" y="3012.6816">INIT-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="2063.5" y="3012.6816">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2784.5" x2="2826.5" y1="3051.7344" y2="3051.7344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2826.5" x2="2826.5" y1="3051.7344" y2="3064.7344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2779.5" x2="2826.5" y1="3064.7344" y2="3064.7344"/><polygon fill="#A80036" points="2789.5,3060.7344,2779.5,3064.7344,2789.5,3068.7344,2785.5,3064.7344" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="2791.5" y="3046.9922">INIT-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="2848.5" y="3046.9922">waiting on PUT /authorizations/{transactionRequestId}</text><polygon fill="#A80036" points="1435.5,3085.0449,1425.5,3089.0449,1435.5,3093.0449,1431.5,3089.0449" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1429.5" x2="1988.5" y1="3089.0449" y2="3089.0449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="1441.5" y="3084.3027">INIT-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="1498.5" y="3084.3027">POST /authorizations</text><polygon fill="#A80036" points="1982.5,3114.3555,1992.5,3118.3555,1982.5,3122.3555,1986.5,3118.3555" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1424.5" x2="1988.5" y1="3118.3555" y2="3118.3555"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="1431.5" y="3113.6133">INIT-31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1488.5" y="3113.6133">200 OK</text><polygon fill="#A80036" points="902.5,3143.666,892.5,3147.666,902.5,3151.666,898.5,3147.666" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="896.5" x2="1413.5" y1="3147.666" y2="3147.666"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="908.5" y="3142.9238">INIT-32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="965.5" y="3142.9238">authorizationRequestReceived()</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="236" x="896" y="3190.666"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="900" y="3207.2344">state: authorizationRequestReceived</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="225" x="896" y="3223.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="900" y="3240.5449">state: transactionInitiationSuccess</text><polygon fill="#A80036" points="559.5,3269.5977,549.5,3273.5977,559.5,3277.5977,555.5,3273.5977" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="553.5" x2="885.5" y1="3273.5977" y2="3273.5977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="565.5" y="3268.8555">INIT-33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="622.5" y="3268.8555">QuoteInformation, transactionId</text><polygon fill="#A80036" points="83.5,3298.9082,73.5,3302.9082,83.5,3306.9082,79.5,3302.9082" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="77.5" x2="542.5" y1="3302.9082" y2="3302.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="53" x="89.5" y="3298.166">INIT-34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="146.5" y="3298.166">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="158" x="2096.25" y="3335.543">Present quote to be approved</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="131" x="2109.75" y="3348.498">User signs the challenge</text><rect fill="#EEEEEE" filter="url(#fmh3e2hlgqzvt)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="4311.5" x="0" y="3385.4736"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4311.5" y1="3385.4736" y2="3385.4736"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="4311.5" y1="3388.4736" y2="3388.4736"/><rect fill="#EEEEEE" filter="url(#fmh3e2hlgqzvt)" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="160" x="2075.75" y="3374.8184"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="142" x="2081.75" y="3391.3867">Approve Transaction</text><rect fill="#ADD8E6" filter="url(#fmh3e2hlgqzvt)" height="84" style="stroke:#A80036;stroke-width:1.0;" width="399" x="77" y="3413.1289"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="81" y="3429.6973">rnote right of PISP #Light</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="81" y="3445.0078">POST /thirdpartyTransactions/{transactionRequestId}/approve</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="81" y="3460.3184">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="199" x="89" y="3475.6289">signedChallenge: "base64(xxx)"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="81" y="3490.9395">}</text><polygon fill="#A80036" points="526.5,3519.9922,536.5,3523.9922,526.5,3527.9922,530.5,3523.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="77.5" x2="532.5" y1="3523.9922" y2="3523.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="84.5" y="3519.25">APPR-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="391" x="140.5" y="3519.25">POST /thirdpartyTransactions/{transactionRequestId}/approve</text><polygon fill="#A80036" points="869.5,3549.3027,879.5,3553.3027,869.5,3557.3027,873.5,3553.3027" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="548.5" x2="875.5" y1="3553.3027" y2="3553.3027"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="555.5" y="3548.5605">APPR-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58" x="611.5" y="3548.5605">approve()</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="156" x="896" y="3566.3027"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="148" x="900" y="3582.8711">state: approvalReceived</text><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="933.5" y1="3615.9238" y2="3615.9238"/><line style="stroke:#A80036;stroke-width:1.0;" x1="933.5" x2="933.5" y1="3615.9238" y2="3628.9238"/><line style="stroke:#A80036;stroke-width:1.0;" x1="892.5" x2="933.5" y1="3628.9238" y2="3628.9238"/><polygon fill="#A80036" points="902.5,3624.9238,892.5,3628.9238,902.5,3632.9238,898.5,3628.9238" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="898.5" y="3611.1816">APPR-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="453" x="954.5" y="3611.1816">SDKRequest.verifyAuthorization(transactionRequestId, signedChallenge)</text><polygon fill="#A80036" points="1977.5,3654.2344,1987.5,3658.2344,1977.5,3662.2344,1981.5,3658.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="891.5" x2="1983.5" y1="3658.2344" y2="3658.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="898.5" y="3653.4922">APPR-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="954.5" y="3653.4922">PUT /authorizations/{transactionRequestId}</text><polygon fill="#A80036" points="897.5,3683.5449,887.5,3687.5449,897.5,3691.5449,893.5,3687.5449" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="891.5" x2="1988.5" y1="3687.5449" y2="3687.5449"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="903.5" y="3682.8027">APPR-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="959.5" y="3682.8027">202 Accepted</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="220" x="891" y="3700.5449"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="895" y="3717.1133">state: pendingVerifyAuthorization</text><polygon fill="#A80036" points="2329.5,3746.166,2339.5,3750.166,2329.5,3754.166,2333.5,3750.166" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1999.5" x2="2335.5" y1="3750.166" y2="3750.166"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="2006.5" y="3745.4238">APPR-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="267" x="2062.5" y="3745.4238">PUT /authorization/{transactionRequestId}</text><polygon fill="#A80036" points="2005.5,3775.4766,1995.5,3779.4766,2005.5,3783.4766,2001.5,3779.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1999.5" x2="2340.5" y1="3779.4766" y2="3779.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="2011.5" y="3774.7344">APPR-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="2067.5" y="3774.7344">202 Accept</text><polygon fill="#A80036" points="2762.5,3804.7871,2772.5,3808.7871,2762.5,3812.7871,2766.5,3808.7871" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2351.5" x2="2768.5" y1="3808.7871" y2="3808.7871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="2358.5" y="3804.0449">APPR-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="348" x="2414.5" y="3804.0449">notify about PUT /authorization/{transactionRequestId}</text><polygon fill="#A80036" points="3448.5,3834.0977,3458.5,3838.0977,3448.5,3842.0977,3452.5,3838.0977" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2779.5" x2="3454.5" y1="3838.0977" y2="3838.0977"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="52" x="2786.5" y="3833.3555">APPR-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="2842.5" y="3833.3555">200: AuthorizationInformation</text><path d="M3306,3851.0977 L3306,3876.0977 L3621,3876.0977 L3621,3861.0977 L3611,3851.0977 L3306,3851.0977 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3611,3851.0977 L3611,3861.0977 L3621,3861.0977 L3611,3851.0977 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="3312" y="3868.666">From now DFSPTransactionModel is unblocked</text><path d="M3245,3890.4082 L3245,3915.4082 L3681,3915.4082 L3681,3900.4082 L3671,3890.4082 L3245,3890.4082 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3671,3890.4082 L3671,3900.4082 L3681,3900.4082 L3671,3890.4082 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="415" x="3251" y="3907.9766">DFSP checks the received AuthorizationInformation with backend.</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="220" x="3475" y="3929.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212" x="3479" y="3946.2871">state: pendingVerifyAuthorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="3979.3398" y2="3979.3398"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="3979.3398" y2="3992.3398"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="3992.3398" y2="3992.3398"/><polygon fill="#A80036" points="3481.5,3988.3398,3471.5,3992.3398,3481.5,3996.3398,3477.5,3992.3398" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3477.5" y="3974.5977">APPR-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420" x="3542.5" y="3974.5977">PISPBackendRequest.verifyAuthorization(AuthorizationInformation)</text><path d="M5,4005.3398 L5,4030.3398 L3534,4030.3398 L3534,4015.3398 L3524,4005.3398 L5,4005.3398 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3524,4005.3398 L3524,4015.3398 L3534,4015.3398 L3524,4005.3398 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="602" x="1462" y="4022.9082">ERROR_SCENARIO: DFSP notifies PISP about Authorization error and then ends its workflow here</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="257" x="3475" y="4044.6504"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="225" x="3479" y="4061.2188">DFSP is unhappy with Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="3479" y="4076.5293">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="11" x="3647" y="4076.5293">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="66" x="3662" y="4076.5293">REJECTED</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="209" x="3475" y="4093.2715"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="3479" y="4109.8398">state: failureVerifyAuthorization</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="4142.8926" y2="4142.8926"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="4142.8926" y2="4155.8926"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="4155.8926" y2="4155.8926"/><polygon fill="#A80036" points="3481.5,4151.8926,3471.5,4155.8926,3481.5,4159.8926,3477.5,4155.8926" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3477.5" y="4138.1504">APPR-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358" x="3542.5" y="4138.1504">persist transactionRequestState for transactionRequestId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="4185.2031" y2="4185.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="4185.2031" y2="4198.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="4198.2031" y2="4198.2031"/><polygon fill="#A80036" points="3481.5,4194.2031,3471.5,4198.2031,3481.5,4202.2031,3477.5,4198.2031" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3477.5" y="4180.4609">APPR-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="499" x="3542.5" y="4180.4609">SDKRequest.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)</text><polygon fill="#A80036" points="2010.5,4223.5137,2000.5,4227.5137,2010.5,4231.5137,2006.5,4227.5137" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2004.5" x2="3459.5" y1="4227.5137" y2="4227.5137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2016.5" y="4222.7715">APPR-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="417" x="2081.5" y="4222.7715">PUT /thirdpartyRequests/transaction/{transactionRequestId}/error</text><polygon fill="#A80036" points="3448.5,4252.8242,3458.5,4256.8242,3448.5,4260.8242,3452.5,4256.8242" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1999.5" x2="3454.5" y1="4256.8242" y2="4256.8242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2006.5" y="4252.082">APPR-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="2071.5" y="4252.082">202 Accept</text><path d="M3238,4269.8242 L3238,4294.8242 L3689,4294.8242 L3689,4279.8242 L3679,4269.8242 L3238,4269.8242 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3679,4269.8242 L3679,4279.8242 L3689,4279.8242 L3679,4269.8242 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="3244" y="4287.3926">ERROR_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="310" x="3364" y="4287.3926">DFSPTransactionModel ends its workflow here</text><polygon fill="#A80036" points="1435.5,4321.4453,1425.5,4325.4453,1435.5,4329.4453,1431.5,4325.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1429.5" x2="4277" y1="4325.4453" y2="4325.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="1441.5" y="4320.7031">APPR-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="417" x="1506.5" y="4320.7031">PUT /thirdpartyRequests/transaction/{transactionRequestId}/error</text><polygon fill="#A80036" points="1982.5,4350.7559,1992.5,4354.7559,1982.5,4358.7559,1986.5,4354.7559" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1424.5" x2="1988.5" y1="4354.7559" y2="4354.7559"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="1431.5" y="4350.0137">APPR-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="1496.5" y="4350.0137">202 Accept</text><path d="M651,4367.7559 L651,4392.7559 L1117,4392.7559 L1117,4377.7559 L1107,4367.7559 L651,4367.7559 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1107,4367.7559 L1107,4377.7559 L1117,4377.7559 L1107,4367.7559 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="657" y="4385.3242">ERROR_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="325" x="777" y="4385.3242">PISPTransactionModel will end its workflow here</text><polygon fill="#A80036" points="902.5,4419.377,892.5,4423.377,902.5,4427.377,898.5,4423.377" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="896.5" x2="1418.5" y1="4423.377" y2="4423.377"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="908.5" y="4418.6348">APPR-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="973.5" y="4418.6348">authorizationRejected()</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="183" x="896" y="4436.377"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="900" y="4452.9453">state: rejectedAuthorization</text><polygon fill="#A80036" points="559.5,4481.998,549.5,4485.998,559.5,4489.998,555.5,4485.998" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="553.5" x2="885.5" y1="4485.998" y2="4485.998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="565.5" y="4481.2559">APPR-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="630.5" y="4481.2559">not approved: authorization is rejected</text><polygon fill="#A80036" points="88.5,4511.3086,78.5,4515.3086,88.5,4519.3086,84.5,4515.3086" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="82.5" x2="537.5" y1="4515.3086" y2="4515.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="94.5" y="4510.5664">APPR-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="159.5" y="4510.5664">500: authorization is rejected</text><path d="M5,4528.3086 L5,4553.3086 L3534,4553.3086 L3534,4538.3086 L3524,4528.3086 L5,4528.3086 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3524,4528.3086 L3524,4538.3086 L3534,4538.3086 L3524,4528.3086 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="1559" y="4545.877">HAPPY_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="288" x="1679" y="4545.877">DFSPTransactionModel continues workflow</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="262" x="3475" y="4567.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="3479" y="4584.1875">DFSP is happy with Authorization</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="164" x="3479" y="4599.498">transactionRequestState</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="11" x="3647" y="4599.498">is</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="3662" y="4599.498">ACCEPTED</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="4632.5508" y2="4632.5508"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="4632.5508" y2="4645.5508"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="4645.5508" y2="4645.5508"/><polygon fill="#A80036" points="3481.5,4641.5508,3471.5,4645.5508,3481.5,4649.5508,3477.5,4645.5508" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3477.5" y="4627.8086">APPR-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358" x="3542.5" y="4627.8086">persist transactionRequestState for transactionRequestId</text><path d="M3286,4658.5508 L3286,4683.5508 L3640,4683.5508 L3640,4668.5508 L3630,4658.5508 L3286,4658.5508 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3630,4658.5508 L3630,4668.5508 L3640,4668.5508 L3630,4658.5508 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="333" x="3292" y="4676.1191">DFSP is happy, so initiates the Transfer for transferId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="4714.1719" y2="4714.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="4714.1719" y2="4727.1719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="4727.1719" y2="4727.1719"/><polygon fill="#A80036" points="3481.5,4723.1719,3471.5,4727.1719,3481.5,4731.1719,3477.5,4727.1719" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3477.5" y="4709.4297">APPR-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="3542.5" y="4709.4297">generate</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="3600.5" y="4709.4297">transferId</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="4756.4824" y2="4756.4824"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="4756.4824" y2="4769.4824"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="4769.4824" y2="4769.4824"/><polygon fill="#A80036" points="3481.5,4765.4824,3471.5,4769.4824,3481.5,4773.4824,3477.5,4769.4824" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3477.5" y="4751.7402">APPR-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="3542.5" y="4751.7402">transfer(transferId)</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="150" x="3475" y="4782.4824"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="3479" y="4799.0508">state: pendingTransfer</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="4832.1035" y2="4832.1035"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="4832.1035" y2="4845.1035"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="4845.1035" y2="4845.1035"/><polygon fill="#A80036" points="3481.5,4841.1035,3471.5,4845.1035,3481.5,4849.1035,3477.5,4845.1035" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3477.5" y="4827.3613">APPR-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="3542.5" y="4827.3613">SDKRequest.transfer(transferId, transferPayload)</text><polygon fill="#A80036" points="2795.5,4870.4141,2785.5,4874.4141,2795.5,4878.4141,2791.5,4874.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2789.5" x2="3459.5" y1="4874.4141" y2="4874.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2801.5" y="4869.6719">APPR-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="2866.5" y="4869.6719">SYNC POST /simpleTransfer</text><line style="stroke:#A80036;stroke-width:1.0;" x1="2784.5" x2="2826.5" y1="4903.7246" y2="4903.7246"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2826.5" x2="2826.5" y1="4903.7246" y2="4916.7246"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2785.5" x2="2826.5" y1="4916.7246" y2="4916.7246"/><polygon fill="#A80036" points="2795.5,4912.7246,2785.5,4916.7246,2795.5,4920.7246,2791.5,4916.7246" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2791.5" y="4898.9824">APPR-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="2856.5" y="4898.9824">request Switch to realize simple transfer</text><polygon fill="#A80036" points="3448.5,4942.0352,3458.5,4946.0352,3448.5,4950.0352,3452.5,4946.0352" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2779.5" x2="3454.5" y1="4946.0352" y2="4946.0352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2786.5" y="4941.293">APPR-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="2851.5" y="4941.293">202: Transfer done</text><path d="M3329,4959.0352 L3329,4984.0352 L3597,4984.0352 L3597,4969.0352 L3587,4959.0352 L3329,4959.0352 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M3587,4959.0352 L3587,4969.0352 L3597,4969.0352 L3587,4959.0352 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="3335" y="4976.6035">DFSP notifies PISP that Transfer is done</text><line style="stroke:#A80036;stroke-width:1.0;" x1="3470.5" x2="3512.5" y1="5014.6563" y2="5014.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3512.5" x2="3512.5" y1="5014.6563" y2="5027.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="3471.5" x2="3512.5" y1="5027.6563" y2="5027.6563"/><polygon fill="#A80036" points="3481.5,5023.6563,3471.5,5027.6563,3481.5,5031.6563,3477.5,5027.6563" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="3477.5" y="5009.9141">APPR-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="340" x="3542.5" y="5009.9141">SDKRequest.notifyThirdpartyAboutTransfer(transferId)</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="292" x="3475" y="5040.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="284" x="3479" y="5057.2246">state: pendingNotifyThirdpartyAboutTransfer</text><polygon fill="#A80036" points="2010.5,5086.2773,2000.5,5090.2773,2010.5,5094.2773,2006.5,5090.2773" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2004.5" x2="3459.5" y1="5090.2773" y2="5090.2773"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2016.5" y="5085.5352">APPR-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="406" x="2081.5" y="5085.5352">PATCH /thirdpartyRequests/transactions/{transactionRequestId}</text><polygon fill="#A80036" points="3453.5,5115.5879,3463.5,5119.5879,3453.5,5123.5879,3457.5,5119.5879" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1999.5" x2="3459.5" y1="5119.5879" y2="5119.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="2006.5" y="5114.8457">APPR-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="2071.5" y="5114.8457">202 Accepted</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="218" x="3470" y="5132.5879"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210" x="3474" y="5149.1563">state: transactionRequestSuccess</text><path d="M672,5165.8984 L672,5190.8984 L1096,5190.8984 L1096,5175.8984 L1086,5165.8984 L672,5165.8984 " fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1086,5165.8984 L1086,5175.8984 L1096,5175.8984 L1086,5165.8984 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="678" y="5183.4668">HAPPY_SCENARIO:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="283" x="798" y="5183.4668">PISPTransactionModel continues workflow</text><polygon fill="#A80036" points="1435.5,5217.5195,1425.5,5221.5195,1435.5,5225.5195,1431.5,5221.5195" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1429.5" x2="1988.5" y1="5221.5195" y2="5221.5195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="1441.5" y="5216.7773">APPR-30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="406" x="1506.5" y="5216.7773">PATCH /thirdpartyRequests/transactions/{transactionRequestId}</text><polygon fill="#A80036" points="1982.5,5246.8301,1992.5,5250.8301,1982.5,5254.8301,1986.5,5250.8301" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1424.5" x2="1988.5" y1="5250.8301" y2="5250.8301"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="1431.5" y="5246.0879">APPR-31</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1496.5" y="5246.0879">200 OK</text><polygon fill="#A80036" points="902.5,5276.1406,892.5,5280.1406,902.5,5284.1406,898.5,5280.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="896.5" x2="1418.5" y1="5280.1406" y2="5280.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="908.5" y="5275.3984">APPR-32</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="973.5" y="5275.3984">transactionSuccess(transactionRequestId)</text><rect fill="#FBFB77" filter="url(#fmh3e2hlgqzvt)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="168" x="896" y="5293.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="900" y="5309.709">state: transactionSuccess</text><polygon fill="#A80036" points="559.5,5338.7617,549.5,5342.7617,559.5,5346.7617,555.5,5342.7617" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="553.5" x2="885.5" y1="5342.7617" y2="5342.7617"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="565.5" y="5338.0195">APPR-33</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="630.5" y="5338.0195">Transaction &amp; Transfer are done</text><polygon fill="#A80036" points="83.5,5368.0723,73.5,5372.0723,83.5,5376.0723,79.5,5372.0723" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="77.5" x2="542.5" y1="5372.0723" y2="5372.0723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="61" x="89.5" y="5367.3301">APPR-34</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="154.5" y="5367.3301">200 OK</text><!--MD5=[b4a00cb2ee42c0a20b1e90bcdf38d29d]
@startuml

title PISP Transaction


participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPTransactionModel" as PISP_TM
  participant "inbound-server" as PISP_TP_IN
end box
box "PISP sdk-scheme-adapter"
  participant "outbound-server" as PISP_SDK_OUT
  participant "inbound-server" as PISP_SDK_IN
end box
box "Mojaloop"
    participant Switch
end box
box "DFSP sdk-scheme-adapter"
  participant "inbound-server" as DFSP_SDK_IN
  participant "outbound-server" as DFSP_SDK_OUT
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPTransactionModel" as DFSP_TM
  participant "outbound-server" as DFSP_TP_OUT
end box


== Party Lookup ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransactions
{
  transactionRequestId: "12345",
  payee: {
    partyIdInfo: {
      partyIdType: "MSISDN",
      partyIdentifier: "+123456789"
    }
  }
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions
activate PISP
activate PISP_TP_OUT
' TODO: line up with state-models.md doc
PISP_TP_OUT -> PISP_TM: partyLookup()
rnote right of PISP_TM: state: requestPartyLookup
activate PISP_TM
PISP_TM -> PISP_TM: SDKRequest.requestPartiesInformation
PISP_TM -> PISP_SDK_OUT: SYNC GET /parties/{type}/{id}
activate PISP_SDK_OUT
PISP_SDK_OUT -> PISP_SDK_OUT: retrieve PartiesInformation from Switch
PISP_SDK_OUT -> PISP_TM: 200 PartyInformation
deactivate PISP_SDK_OUT
rnote right of PISP_TM: state: payeeResolved

PISP_TM -> PISP_TP_OUT: partyInformation
deactivate PISP_TM

' TODO: party lookup details
PISP_TP_OUT - -> PISP: 200 OK PartyInformation
deactivate PISP_TP_OUT
deactivate PISP

...User checks the party name, and confirms transaction to continue...



== Initate Transaction ==
autonumber 1 "<b>INIT-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransactions/{transactionRequestId}/initiate
{
  amount: {
    amount: "20.00",
    currency: "USD"
  },
  "amountType": "SEND",
  "payee": {....},
  "payer": {
    "partyIdType": "THIRD_PARTY_LINK",
    "partyIdentifier": "qwerty-56789",
    "fspId": "dfspa"
  },
  "transactionType": {
    "scenario": "TRANSFER",
    "initiator": 'PAYER",
    "initiatorType": "CONSUMER"
  },
  expiration: "2021-03-08T08:08:08.699-04:00"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/initiate
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: initiate()
activate PISP_TM
rnote right of PISP_TM: state: requestThirdpartyTransaction
PISP_TM -> PISP_TM: SDKRequest.requestThirdpartyTransaction()
PISP_TM -> Switch: POST /thirdpartyRequests/transactions
activate Switch
Switch - -> PISP_TM: 202 Accepted
deactivate PISP_TM
rnote right of PISP_TM: state: pendingTransactionInitiation

note over DFSP_TP_IN
  DFSP handles PISP transaction request
end note
Switch -> DFSP_TP_IN: POST /thirdpartyRequests/transactions
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
note over DFSP_TM
  DFSP starts workflow for DFSPTransactionModel
end note
DFSP_TP_IN -> DFSP_TM: transactionRequestReceived()
deactivate DFSP_TP_IN
activate DFSP_TM
rnote right of DFSP_TM: state: transactionRequestReceived\n**transactionRequestState** is **RECEIVED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
note over DFSP_TM
  DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK
end note
DFSP_TM -> DFSP_TM: PISPBackendRequest.verifyConsent(pispId, payer)
note over DFSP_TM
  DFSP is happy with Consent
end note
rnote right of DFSP_TM: state: consentIsValid
DFSP_TM -> DFSP_TM: so generate **transactionId**: '1234-1234-1234-1234'
note over DFSP_TM
  DFSP informs PISP that **transactionId** has been allocated
end note
DFSP_TM -> DFSP_TM: SDKRequest.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransactionRequestState
rnote right of DFSP_TM #LightBlue
PUT /thirdpartyRequests/transaction/{transactionRequestId}
{
  transactionId: '1234-1234-1234-1234',
  transactionRequestState: 'RECEIVED'
}
end note
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
Switch -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 202 accepted
deactivate Switch
PISP_TP_IN -> PISP_TM: transactionRequestReceived()
activate PISP_TM
rnote right of PISP_TM: state: transactionRequestReceived
PISP_TM -> PISP_TM: store received **transactionId**
deactivate PISP_TM
deactivate PISP_TP_IN
note over PISP_TM
  There could be a race condition (time based hazard)
  between two incoming calls 
  
  **PUT /thirdpartyReqeusts/transaction/{id}**
  and
  **POST /authorization**
  
  so we are mitigating it by alternative two-step transitions:

  pendingTransactionInitiation (START): 
    -> (CASE-1) transactionRequestReceived -> authorizationRequestReceived
    -> (CASE-2) authorizationRequestReceived -> transactionRequestReceived
  -> transactionInitiationSuccess (END)

  CASE-1 is visualised here
end note

note over DFSP_TM
  DFSP requires QuoteInformation
end note
DFSP_TM -> DFSP_TM: SDKRequest.requestQuote()
rnote right of DFSP_TM: state: pendingRequestQuote
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /quotes
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: retrieve QuoteInformation from Switch
DFSP_SDK_OUT -> DFSP_TM: 200 QuoteInformation
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP has the QuoteInformation, they can now ask the PISP for authorization
end note
DFSP_TM -> DFSP_TM: requestAuthorization()
rnote right of DFSP_TM: state: pendingRequestAuthorization\n**transactionRequestState** is **PENDING**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequest.requestAuthorization(QuoteInformation)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /authorization
note over DFSP_TM
  From now DFSPTransactionModel is blocked
  on synchronous call to POST /authorizations
  until PISP initiate **Approve Transaction** phase.
  Here timeout scenario should be handled properly
end note
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> Switch: POST /authorizations
activate Switch
Switch - -> DFSP_SDK_OUT: 202 Accepted
DFSP_SDK_OUT -> DFSP_SDK_OUT: waiting on PUT /authorizations/{transactionRequestId}
deactivate DFSP_SDK_OUT
Switch -> PISP_TP_IN: POST /authorizations
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
PISP_TP_IN -> PISP_TM: authorizationRequestReceived()
rnote right of PISP_TM: state: authorizationRequestReceived
activate PISP_TM

rnote right of PISP_TM: state: transactionInitiationSuccess

deactivate PISP_TP_IN


PISP_TM -> PISP_TP_OUT: QuoteInformation, transactionId
deactivate PISP_TM
deactivate PISP_TP_IN

'TODO: add authorization details
PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

...Present quote to be approved\nUser signs the challenge...


== Approve Transaction ==
autonumber 1 "<b>APPR-#</b>"
rnote right of PISP #LightBlue
rnote right of PISP #Light
POST /thirdpartyTransactions/{transactionRequestId}/approve
{
  signedChallenge: "base64(xxx)"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/approve
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: approve()
activate PISP_TM
rnote right of PISP_TM: state: approvalReceived
PISP_TM -> PISP_TM: SDKRequest.verifyAuthorization(transactionRequestId, signedChallenge)

PISP_TM -> Switch: PUT /authorizations/{transactionRequestId}
activate Switch
Switch - -> PISP_TM: 202 Accepted
rnote right of PISP_TM: state: pendingVerifyAuthorization
deactivate PISP_TM
Switch -> DFSP_SDK_IN: PUT /authorization/{transactionRequestId}
activate DFSP_SDK_IN
DFSP_SDK_IN - -> Switch: 202 Accept
deactivate Switch
DFSP_SDK_IN -> DFSP_SDK_OUT: notify about PUT /authorization/{transactionRequestId}
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_TM: 200: AuthorizationInformation
note over DFSP_TM
  From now DFSPTransactionModel is unblocked
end note
deactivate DFSP_SDK_IN
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP checks the received AuthorizationInformation with backend.
end note
rnote right of DFSP_TM: state: pendingVerifyAuthorization
DFSP_TM -> DFSP_TM: PISPBackendRequest.verifyAuthorization(AuthorizationInformation)

note over PISP, DFSP_TM
  ERROR_SCENARIO: DFSP notifies PISP about Authorization error and then ends its workflow here
end note
rnote right of DFSP_TM: DFSP is unhappy with Authorization\n**transactionRequestState** is **REJECTED**
rnote right of DFSP_TM: state: failureVerifyAuthorization
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequest.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate Switch
Switch -> DFSP_TM: 202 Accept
note over DFSP_TM
  ERROR_SCENARIO: **DFSPTransactionModel ends its workflow here**
end note
Swich -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate PISP_TP_IN
PISP_TP_IN -> Switch: 202 Accept
deactivate Switch

note over PISP_TM
  ERROR_SCENARIO: **PISPTransactionModel will end its workflow here**
end note
PISP_TP_IN -> PISP_TM: authorizationRejected()
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: rejectedAuthorization
PISP_TM -> PISP_TP_OUT: not approved: authorization is rejected
deactivate PISP_TM
PISP_TP_OUT -> PISP: 500: authorization is rejected



note over PISP, DFSP_TM
  HAPPY_SCENARIO: **DFSPTransactionModel continues workflow**
end note

rnote right of DFSP_TM: DFSP is happy with Authorization\n**transactionRequestState** is **ACCEPTED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId

note over DFSP_TM
  DFSP is happy, so initiates the Transfer for transferId
end note
DFSP_TM -> DFSP_TM: generate **transferId**
DFSP_TM -> DFSP_TM: transfer(transferId)
rnote right of DFSP_TM: state: pendingTransfer
DFSP_TM -> DFSP_TM: SDKRequest.transfer(transferId, transferPayload)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /simpleTransfer
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: request Switch to realize simple transfer
DFSP_SDK_OUT -> DFSP_TM: 202: Transfer done
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP notifies PISP that Transfer is done
end note
DFSP_TM -> DFSP_TM: SDKRequest.notifyThirdpartyAboutTransfer(transferId)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransfer

DFSP_TM -> Switch: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
rnote right of DFSP_TM: state: transactionRequestSuccess
deactivate DFSP_TM


note over PISP_TM
  HAPPY_SCENARIO: **PISPTransactionModel continues workflow**
end note

Switch -> PISP_TP_IN: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_TM: transactionSuccess(transactionRequestId)
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: transactionSuccess


PISP_TM -> PISP_TP_OUT: Transaction & Transfer are done
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

@enduml

@startuml

title PISP Transaction


participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPTransactionModel" as PISP_TM
  participant "inbound-server" as PISP_TP_IN
end box
box "PISP sdk-scheme-adapter"
  participant "outbound-server" as PISP_SDK_OUT
  participant "inbound-server" as PISP_SDK_IN
end box
box "Mojaloop"
    participant Switch
end box
box "DFSP sdk-scheme-adapter"
  participant "inbound-server" as DFSP_SDK_IN
  participant "outbound-server" as DFSP_SDK_OUT
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPTransactionModel" as DFSP_TM
  participant "outbound-server" as DFSP_TP_OUT
end box


== Party Lookup ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransactions
{
  transactionRequestId: "12345",
  payee: {
    partyIdInfo: {
      partyIdType: "MSISDN",
      partyIdentifier: "+123456789"
    }
  }
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions
activate PISP
activate PISP_TP_OUT
PISP_TP_OUT -> PISP_TM: partyLookup()
rnote right of PISP_TM: state: requestPartyLookup
activate PISP_TM
PISP_TM -> PISP_TM: SDKRequest.requestPartiesInformation
PISP_TM -> PISP_SDK_OUT: SYNC GET /parties/{type}/{id}
activate PISP_SDK_OUT
PISP_SDK_OUT -> PISP_SDK_OUT: retrieve PartiesInformation from Switch
PISP_SDK_OUT -> PISP_TM: 200 PartyInformation
deactivate PISP_SDK_OUT
rnote right of PISP_TM: state: payeeResolved

PISP_TM -> PISP_TP_OUT: partyInformation
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK PartyInformation
deactivate PISP_TP_OUT
deactivate PISP

...User checks the party name, and confirms transaction to continue...



== Initate Transaction ==
autonumber 1 "<b>INIT-#</b>"
rnote right of PISP #LightBlue
POST /thirdpartyTransactions/{transactionRequestId}/initiate
{
  amount: {
    amount: "20.00",
    currency: "USD"
  },
  "amountType": "SEND",
  "payee": {....},
  "payer": {
    "partyIdType": "THIRD_PARTY_LINK",
    "partyIdentifier": "qwerty-56789",
    "fspId": "dfspa"
  },
  "transactionType": {
    "scenario": "TRANSFER",
    "initiator": 'PAYER",
    "initiatorType": "CONSUMER"
  },
  expiration: "2021-03-08T08:08:08.699-04:00"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/initiate
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: initiate()
activate PISP_TM
rnote right of PISP_TM: state: requestThirdpartyTransaction
PISP_TM -> PISP_TM: SDKRequest.requestThirdpartyTransaction()
PISP_TM -> Switch: POST /thirdpartyRequests/transactions
activate Switch
Switch - -> PISP_TM: 202 Accepted
deactivate PISP_TM
rnote right of PISP_TM: state: pendingTransactionInitiation

note over DFSP_TP_IN
  DFSP handles PISP transaction request
end note
Switch -> DFSP_TP_IN: POST /thirdpartyRequests/transactions
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch
note over DFSP_TM
  DFSP starts workflow for DFSPTransactionModel
end note
DFSP_TP_IN -> DFSP_TM: transactionRequestReceived()
deactivate DFSP_TP_IN
activate DFSP_TM
rnote right of DFSP_TM: state: transactionRequestReceived\n**transactionRequestState** is **RECEIVED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
note over DFSP_TM
  DFSP asks its backend to verify consent for payer via THIRD_PARTY_LINK
end note
DFSP_TM -> DFSP_TM: PISPBackendRequest.verifyConsent(pispId, payer)
note over DFSP_TM
  DFSP is happy with Consent
end note
rnote right of DFSP_TM: state: consentIsValid
DFSP_TM -> DFSP_TM: so generate **transactionId**: '1234-1234-1234-1234'
note over DFSP_TM
  DFSP informs PISP that **transactionId** has been allocated
end note
DFSP_TM -> DFSP_TM: SDKRequest.notifyThirdpartyAboutTransactionRequestState(transactionId, transactionRequestState)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransactionRequestState
rnote right of DFSP_TM #LightBlue
PUT /thirdpartyRequests/transaction/{transactionRequestId}
{
  transactionId: '1234-1234-1234-1234',
  transactionRequestState: 'RECEIVED'
}
end note
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
Switch -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 202 accepted
deactivate Switch
PISP_TP_IN -> PISP_TM: transactionRequestReceived()
activate PISP_TM
rnote right of PISP_TM: state: transactionRequestReceived
PISP_TM -> PISP_TM: store received **transactionId**
deactivate PISP_TM
deactivate PISP_TP_IN
note over PISP_TM
  There could be a race condition (time based hazard)
  between two incoming calls 
  
  **PUT /thirdpartyReqeusts/transaction/{id}**
  and
  **POST /authorization**
  
  so we are mitigating it by alternative two-step transitions:

  pendingTransactionInitiation (START): 
    -> (CASE-1) transactionRequestReceived -> authorizationRequestReceived
    -> (CASE-2) authorizationRequestReceived -> transactionRequestReceived
  -> transactionInitiationSuccess (END)

  CASE-1 is visualised here
end note

note over DFSP_TM
  DFSP requires QuoteInformation
end note
DFSP_TM -> DFSP_TM: SDKRequest.requestQuote()
rnote right of DFSP_TM: state: pendingRequestQuote
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /quotes
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: retrieve QuoteInformation from Switch
DFSP_SDK_OUT -> DFSP_TM: 200 QuoteInformation
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP has the QuoteInformation, they can now ask the PISP for authorization
end note
DFSP_TM -> DFSP_TM: requestAuthorization()
rnote right of DFSP_TM: state: pendingRequestAuthorization\n**transactionRequestState** is **PENDING**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequest.requestAuthorization(QuoteInformation)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /authorization
note over DFSP_TM
  From now DFSPTransactionModel is blocked
  on synchronous call to POST /authorizations
  until PISP initiate **Approve Transaction** phase.
  Here timeout scenario should be handled properly
end note
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> Switch: POST /authorizations
activate Switch
Switch - -> DFSP_SDK_OUT: 202 Accepted
DFSP_SDK_OUT -> DFSP_SDK_OUT: waiting on PUT /authorizations/{transactionRequestId}
deactivate DFSP_SDK_OUT
Switch -> PISP_TP_IN: POST /authorizations
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch
PISP_TP_IN -> PISP_TM: authorizationRequestReceived()
rnote right of PISP_TM: state: authorizationRequestReceived
activate PISP_TM

rnote right of PISP_TM: state: transactionInitiationSuccess

deactivate PISP_TP_IN


PISP_TM -> PISP_TP_OUT: QuoteInformation, transactionId
deactivate PISP_TM
deactivate PISP_TP_IN

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

...Present quote to be approved\nUser signs the challenge...


== Approve Transaction ==
autonumber 1 "<b>APPR-#</b>"
rnote right of PISP #LightBlue
rnote right of PISP #Light
POST /thirdpartyTransactions/{transactionRequestId}/approve
{
  signedChallenge: "base64(xxx)"
}
end note
PISP -> PISP_TP_OUT: POST /thirdpartyTransactions/{transactionRequestId}/approve
activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TM: approve()
activate PISP_TM
rnote right of PISP_TM: state: approvalReceived
PISP_TM -> PISP_TM: SDKRequest.verifyAuthorization(transactionRequestId, signedChallenge)

PISP_TM -> Switch: PUT /authorizations/{transactionRequestId}
activate Switch
Switch - -> PISP_TM: 202 Accepted
rnote right of PISP_TM: state: pendingVerifyAuthorization
deactivate PISP_TM
Switch -> DFSP_SDK_IN: PUT /authorization/{transactionRequestId}
activate DFSP_SDK_IN
DFSP_SDK_IN - -> Switch: 202 Accept
deactivate Switch
DFSP_SDK_IN -> DFSP_SDK_OUT: notify about PUT /authorization/{transactionRequestId}
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_TM: 200: AuthorizationInformation
note over DFSP_TM
  From now DFSPTransactionModel is unblocked
end note
deactivate DFSP_SDK_IN
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP checks the received AuthorizationInformation with backend.
end note
rnote right of DFSP_TM: state: pendingVerifyAuthorization
DFSP_TM -> DFSP_TM: PISPBackendRequest.verifyAuthorization(AuthorizationInformation)

note over PISP, DFSP_TM
  ERROR_SCENARIO: DFSP notifies PISP about Authorization error and then ends its workflow here
end note
rnote right of DFSP_TM: DFSP is unhappy with Authorization\n**transactionRequestState** is **REJECTED**
rnote right of DFSP_TM: state: failureVerifyAuthorization
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId
DFSP_TM -> DFSP_TM: SDKRequest.notifyThirdpartyAboutRejectedAuthorization(transactionRequestId)
DFSP_TM -> Switch: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate Switch
Switch -> DFSP_TM: 202 Accept
note over DFSP_TM
  ERROR_SCENARIO: **DFSPTransactionModel ends its workflow here**
end note
Swich -> PISP_TP_IN: PUT /thirdpartyRequests/transaction/{transactionRequestId}/error
activate PISP_TP_IN
PISP_TP_IN -> Switch: 202 Accept
deactivate Switch

note over PISP_TM
  ERROR_SCENARIO: **PISPTransactionModel will end its workflow here**
end note
PISP_TP_IN -> PISP_TM: authorizationRejected()
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: rejectedAuthorization
PISP_TM -> PISP_TP_OUT: not approved: authorization is rejected
deactivate PISP_TM
PISP_TP_OUT -> PISP: 500: authorization is rejected



note over PISP, DFSP_TM
  HAPPY_SCENARIO: **DFSPTransactionModel continues workflow**
end note

rnote right of DFSP_TM: DFSP is happy with Authorization\n**transactionRequestState** is **ACCEPTED**
DFSP_TM -> DFSP_TM: persist transactionRequestState for transactionRequestId

note over DFSP_TM
  DFSP is happy, so initiates the Transfer for transferId
end note
DFSP_TM -> DFSP_TM: generate **transferId**
DFSP_TM -> DFSP_TM: transfer(transferId)
rnote right of DFSP_TM: state: pendingTransfer
DFSP_TM -> DFSP_TM: SDKRequest.transfer(transferId, transferPayload)
DFSP_TM -> DFSP_SDK_OUT: SYNC POST /simpleTransfer
activate DFSP_SDK_OUT
DFSP_SDK_OUT -> DFSP_SDK_OUT: request Switch to realize simple transfer
DFSP_SDK_OUT -> DFSP_TM: 202: Transfer done
deactivate DFSP_SDK_OUT
note over DFSP_TM
  DFSP notifies PISP that Transfer is done
end note
DFSP_TM -> DFSP_TM: SDKRequest.notifyThirdpartyAboutTransfer(transferId)
rnote right of DFSP_TM: state: pendingNotifyThirdpartyAboutTransfer

DFSP_TM -> Switch: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate Switch
Switch - -> DFSP_TM: 202 Accepted
rnote right of DFSP_TM: state: transactionRequestSuccess
deactivate DFSP_TM


note over PISP_TM
  HAPPY_SCENARIO: **PISPTransactionModel continues workflow**
end note

Switch -> PISP_TP_IN: PATCH /thirdpartyRequests/transactions/{transactionRequestId}
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_TM: transactionSuccess(transactionRequestId)
deactivate PISP_TP_IN
activate PISP_TM
rnote right of PISP_TM: state: transactionSuccess


PISP_TM -> PISP_TP_OUT: Transaction & Transfer are done
deactivate PISP_TM

PISP_TP_OUT - -> PISP: 200 OK
deactivate PISP_TP_OUT
deactivate PISP

@enduml

PlantUML version 1.2021.00(Sun Jan 10 11:25:05 CET 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: pl
Country: PL
--></g></svg>